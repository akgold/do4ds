<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 Private Networking Configuration | DevOps for Data Science (working title)</title>
<meta name="author" content="Alex Gold">
<meta name="description" content="In the previous chapter, we talked about the first level of upgrades for your data science server – getting a real URL and configuring https for security. So now, the internet is knocking on the...">
<meta name="generator" content="bookdown 0.24.4 with bs4_book()">
<meta property="og:title" content="Chapter 8 Private Networking Configuration | DevOps for Data Science (working title)">
<meta property="og:type" content="book">
<meta property="og:description" content="In the previous chapter, we talked about the first level of upgrades for your data science server – getting a real URL and configuring https for security. So now, the internet is knocking on the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Private Networking Configuration | DevOps for Data Science (working title)">
<meta name="twitter:description" content="In the previous chapter, we talked about the first level of upgrades for your data science server – getting a real URL and configuring https for security. So now, the internet is knocking on the...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/accessible-code-block/empty-anchor.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">DevOps for Data Science (working title)</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="about-the-author.html">About the Author</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="command-line.html"><span class="header-section-number">2</span> The Command Line</a></li>
<li><a class="" href="ssh.html"><span class="header-section-number">3</span> Accessing Servers via SSH</a></li>
<li><a class="" href="computers-computing-and-servers.html"><span class="header-section-number">4</span> Computers, Computing, and Servers</a></li>
<li><a class="" href="lab-1-get-your-own-server.html"><span class="header-section-number">5</span> Lab 1: Get your own server</a></li>
<li><a class="" href="url.html"><span class="header-section-number">6</span> Computer Networks and the Internet</a></li>
<li><a class="" href="getting-a-real-url.html"><span class="header-section-number">7</span> Getting a real URL</a></li>
<li><a class="active" href="private-networking-configuration.html"><span class="header-section-number">8</span> Private Networking Configuration</a></li>
<li><a class="" href="auth.html"><span class="header-section-number">9</span> How login works</a></li>
<li><a class="" href="choosing-and-using-a-data-architecture.html"><span class="header-section-number">10</span> Choosing and Using A Data Architecture</a></li>
<li><a class="" href="environments-and-reproducibility.html"><span class="header-section-number">11</span> Environments and Reproducibility</a></li>
<li><a class="" href="the-cloud-and-cloud-providers.html"><span class="header-section-number">12</span> The Cloud and Cloud Providers</a></li>
<li><a class="" href="it-and-data-science-workflows.html"><span class="header-section-number">13</span> IT and Data Science Workflows</a></li>
<li><a class="" href="scaling.html"><span class="header-section-number">14</span> Scaling</a></li>
<li><a class="" href="docker.html"><span class="header-section-number">15</span> Docker</a></li>
<li><a class="" href="offline.html"><span class="header-section-number">16</span> Offline</a></li>
<li><a class="" href="infrastructure-as-code-tooling.html"><span class="header-section-number">17</span> Infrastructure As Code Tooling</a></li>
<li><a class="" href="things-to-add-additional-topics.html"><span class="header-section-number">18</span> Things To Add (Additional Topics)</a></li>
<li><a class="" href="determining-what-you-need.html"><span class="header-section-number">19</span> Determining What You Need</a></li>
<li><a class="" href="getting-started-with-terminal.html"><span class="header-section-number">20</span> Getting Started with Terminal</a></li>
<li><a class="" href="useful-shell-commands.html"><span class="header-section-number">21</span> Useful Shell Commands</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="more-to-say.html"><span class="header-section-number">A</span> More to Say</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="private-networking-configuration" class="section level1">
<h1>
<span class="header-section-number">8</span> Private Networking Configuration<a class="anchor" aria-label="anchor" href="#private-networking-configuration"><i class="fas fa-link"></i></a>
</h1>
<p>In the previous chapter, we talked about the first level of upgrades for your data science server – getting a real URL and configuring <code>https</code> for security. So now, the internet is knocking on the front gate of your server.</p>
<p>This chapter will be all about how to configure networking on the private siIn this chapter, we’ll talk about how to get traffic from the front door to the right apartment.</p>
<p>It wasn’t obvious, but when you set up the server in the first chapter, you also actually created a private network for the server to live in called a <em>virtual private cloud (VPC)</em>.</p>
<p>As your server configuration gets more complicated, you’re going to put more different servers inside the virtual private cloud. So instead of thinking of your traffic as coming to the front door of your little server/cottage, I think it’s a more helpful analogy to think of coming to the guard box at the front gate of a gated community of apartment buildings.</p>
<p>You’re at the front gate, but still need to find your way to the right building and then to the right apartment inside that building.</p>
<p>Up until now, we’ve been pretending like the server you put up in the first chapter was actually just on the public internet – so it makes sense to ask why we wouldn’t actually just do that.</p>
<p>The two reasons are security and reducing administrative headaches.</p>
<p>The other reason to make extensive use of private networks has to do with ease-of-configuration. Inside a private network, it’s generally ok to say “accept connections from any server inside the network”, and take care of security at the front gate of the network. Otherwise, you’ve got to be much more careful about how you configure each individual server, which is both more work and a potential security vulnerability if you don’t do it right.</p>
<p>In the case of a data science environment you may have a number of different servers you’re setting up – a server for doing data science work, a database, a package repository mirror, and a server for deploying your apps to others.</p>
<p>Similarly, because there are single points of ingress and egress (sometimes), security is heightened by having only one way in or out, as opposed to opening the entire network or each server individually to the internet.</p>
<p>Using public and private subnets is also really nice for server resiliency. Say your network was attacked with a DDOS attack, where someone tries to overwhelm your servers with junk attacks to take down your servers. It’s way better if they manage to succeed at taking down your server, but it’s just a proxy as opposed to your analytics workhorse server or a mission-critical database.</p>
<p>When configuring servers this way, it’s very common to configure an additional server called a bastion host or jumpbox that is used solely to pass SSH traffic from server administrators through to the hosts in the private network.</p>
<div id="finding-the-right-server-with-hostnames" class="section level2">
<h2>
<span class="header-section-number">8.1</span> Finding the right server with hostnames<a class="anchor" aria-label="anchor" href="#finding-the-right-server-with-hostnames"><i class="fas fa-link"></i></a>
</h2>
<p>Like we configured a URL to have an abstraction layer between our IP address and our server, we also will usually configure a <em>hostname</em> rather than using IP addresses.</p>
</div>
<div id="the-role-of-forward-and-reverse-proxies" class="section level2">
<h2>
<span class="header-section-number">8.2</span> The role of forward and reverse proxies<a class="anchor" aria-label="anchor" href="#the-role-of-forward-and-reverse-proxies"><i class="fas fa-link"></i></a>
</h2>
</div>
<div id="using-ports-to-get-to-the-right-service" class="section level2">
<h2>
<span class="header-section-number">8.3</span> Using ports to get to the right service<a class="anchor" aria-label="anchor" href="#using-ports-to-get-to-the-right-service"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s say you want to run software on a server. One of the big differences between server software, and software on your laptop is that server software needs to be able to interact with the outside world to be useful.</p>
<p>For example, when you want to use Microsoft Word on your computer, you just click on the button and then it’s ready to go. But say I want to use RStudio Server. I don’t have a desktop where I click to open RStudio Server. Instead, I go to a particular URL and I expect that RStudio will be there, ready to listen.</p>
</div>
<div id="configuring-the-private-network" class="section level2">
<h2>
<span class="header-section-number">8.4</span> Configuring the private network<a class="anchor" aria-label="anchor" href="#configuring-the-private-network"><i class="fas fa-link"></i></a>
</h2>
<p>A private network is defined by a range of IP addresses, called CIDR blocks. A CIDR block defines the sub-addresses available inside an IP address using a /n notation. So the CIDR block 10.0.0.0/16 is the largest possible CIDR block and includes all IP addresses from 10.0.0.0 to 10.255.255.255.</p>
<p>The numbers after the / are related to powers of 2 (binary something blah), so you can fit 2 /x+1 CIDR blocks in a single /x block.</p>
<p>So, for example, there are 128 IP addresses in a /25 CIDR block, and 256 in a /24 CIDR block, so 10.0.0.0/24 could have two subnets, 10.0.0.0/25 and 10.0.0.128/25.</p>
<div id="restricting-outbound-connections" class="section level3">
<h3>
<span class="header-section-number">8.4.1</span> Restricting Outbound Connections<a class="anchor" aria-label="anchor" href="#restricting-outbound-connections"><i class="fas fa-link"></i></a>
</h3>
<p>In AWS, you’ll configure egress from private subnets using a NAT Gateway. Egress from the public subnets goes through the Internet Gateway. Egress is actually needed less than you might think - in our current setup, it’s needed for package updates to RSPM (the RSPM service, not RSP to RSPM), to do google OAuth to the google servers (rstudioservices only), get stuff from github, update products, and get content from apt/yum repos.</p>
<p>In Colorado, it’s not needed for RSC because the SAML token is in the browser. It is needed for RSP because Onelogin is outside the VPC. This is generally not the case for customers, who are mostly using on-prem AD servers.</p>
</div>
</div>
<div id="bastion-hosts" class="section level2">
<h2>
<span class="header-section-number">8.5</span> Bastion Hosts<a class="anchor" aria-label="anchor" href="#bastion-hosts"><i class="fas fa-link"></i></a>
</h2>
</div>
<div id="special-ip-addresses-and-ports" class="section level2">
<h2>
<span class="header-section-number">8.6</span> Special IP Addresses and Ports<a class="anchor" aria-label="anchor" href="#special-ip-addresses-and-ports"><i class="fas fa-link"></i></a>
</h2>
<p>All ports below 1024 reserved.</p>
<p>80 - HTTP default</p>
<p>443 - HTTPS default</p>
<p>22 - SSH default</p>
</div>
<div id="exercises-5" class="section level2">
<h2>
<span class="header-section-number">8.7</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-5"><i class="fas fa-link"></i></a>
</h2>
<p>Consider going to the website google.com. Draw a diagram of how the following are incorporated: TCP/IP, DNS, HTTP, HTTPS.</p>
<p>Set up a free-tier EC2 instance and put an NGINX server up. Figure out how to allow your computer to access the server, but not your phone. Try accessing it on a non-default port.</p>
<p>Try to HTTP into a fresh EC2 with the default security group. Take a look at the inbound security group rules. Hint: is there an inbound rule on a default HTTP port?</p>
<p>SSH into your EC2 instance and try to reach out to something on the internet (curl…). See if you can change security group rules to shut down access.</p>
<p>Can you do it by changing the IP address range it’s accepting connections from?</p>
<p>Can you do it by changing the listening ports?</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="getting-a-real-url.html"><span class="header-section-number">7</span> Getting a real URL</a></div>
<div class="next"><a href="auth.html"><span class="header-section-number">9</span> How login works</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#private-networking-configuration"><span class="header-section-number">8</span> Private Networking Configuration</a></li>
<li><a class="nav-link" href="#finding-the-right-server-with-hostnames"><span class="header-section-number">8.1</span> Finding the right server with hostnames</a></li>
<li><a class="nav-link" href="#the-role-of-forward-and-reverse-proxies"><span class="header-section-number">8.2</span> The role of forward and reverse proxies</a></li>
<li><a class="nav-link" href="#using-ports-to-get-to-the-right-service"><span class="header-section-number">8.3</span> Using ports to get to the right service</a></li>
<li>
<a class="nav-link" href="#configuring-the-private-network"><span class="header-section-number">8.4</span> Configuring the private network</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#restricting-outbound-connections"><span class="header-section-number">8.4.1</span> Restricting Outbound Connections</a></li></ul>
</li>
<li><a class="nav-link" href="#bastion-hosts"><span class="header-section-number">8.5</span> Bastion Hosts</a></li>
<li><a class="nav-link" href="#special-ip-addresses-and-ports"><span class="header-section-number">8.6</span> Special IP Addresses and Ports</a></li>
<li><a class="nav-link" href="#exercises-5"><span class="header-section-number">8.7</span> Exercises</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>DevOps for Data Science (working title)</strong>" was written by Alex Gold. It was last built on 2021-12-27.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
