<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DevOps for Data Science - 11&nbsp; Server Resources and Scaling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/sec2/2-6-networking.html" rel="next">
<link href="../../chapters/sec2/2-4-app-admin.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EQR1RYSHQK"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EQR1RYSHQK', { 'anonymize_ip': true});
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/sec2/2-0-sec-intro.html">IT/Admin for Data Science</a></li><li class="breadcrumb-item"><a href="../../chapters/sec2/2-5-scale.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Server Resources and Scaling</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">DevOps for Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/akgold/do4ds" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec1/1-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DevOps Lessons for Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-1-env-as-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Environments as Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-2-proj-arch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Project Architecture</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-3-data-access.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Using databases and data APIs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-4-monitor-log.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Logging and Monitoring</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-5-deployments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Deployments and code promotion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-6-docker.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Demystifying Docker</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec2/2-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IT/Admin for Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-1-cloud.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Cloud</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-2-cmd-line.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Using the command line</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-3-linux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Intro to Linux Administration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-4-app-admin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Application administration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-5-scale.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Server Resources and Scaling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-6-networking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Computer Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-7-dns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">DNS is for human-readable addresses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-8-ssl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">You should use SSL/HTTPS</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec3/3-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Enterprise-grade data science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-1-ent-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Enterprise Networking</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-2-auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Auth in Enterprise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-3-ent-scale.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Compute at enterprise scale</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-4-ent-pm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Package Management in the Enterprise</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Auth Technologies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/lb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Technical Detail: Load balancers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/lab-map.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Lab Map</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/cheatsheets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Cheatsheets</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-briefest-intro-to-computational-theory" id="toc-the-briefest-intro-to-computational-theory" class="nav-link active" data-scroll-target="#the-briefest-intro-to-computational-theory"><span class="header-section-number">11.1</span> The briefest intro to computational theory</a></li>
  <li><a href="#how-computers-compute" id="toc-how-computers-compute" class="nav-link" data-scroll-target="#how-computers-compute"><span class="header-section-number">11.2</span> How computers compute</a></li>
  <li><a href="#recommendation-1-fewer-faster-cpu-cores" id="toc-recommendation-1-fewer-faster-cpu-cores" class="nav-link" data-scroll-target="#recommendation-1-fewer-faster-cpu-cores"><span class="header-section-number">11.3</span> Recommendation 1: Fewer, faster CPU cores</a></li>
  <li><a href="#how-memory-works" id="toc-how-memory-works" class="nav-link" data-scroll-target="#how-memory-works"><span class="header-section-number">11.4</span> How memory works</a></li>
  <li><a href="#recommendation-2-get-as-much-ram-as-feasible" id="toc-recommendation-2-get-as-much-ram-as-feasible" class="nav-link" data-scroll-target="#recommendation-2-get-as-much-ram-as-feasible"><span class="header-section-number">11.5</span> Recommendation 2: Get as much RAM as feasible</a></li>
  <li><a href="#understanding-storage" id="toc-understanding-storage" class="nav-link" data-scroll-target="#understanding-storage"><span class="header-section-number">11.6</span> Understanding storage</a></li>
  <li><a href="#recommendation-3-get-lots-of-storage-its-cheap" id="toc-recommendation-3-get-lots-of-storage-its-cheap" class="nav-link" data-scroll-target="#recommendation-3-get-lots-of-storage-its-cheap"><span class="header-section-number">11.7</span> Recommendation 3: Get lots of storage, it’s cheap</a></li>
  <li><a href="#gpus-are-special-purpose-compute" id="toc-gpus-are-special-purpose-compute" class="nav-link" data-scroll-target="#gpus-are-special-purpose-compute"><span class="header-section-number">11.8</span> GPUs are special-purpose compute</a></li>
  <li><a href="#recommendation-4-get-a-gpu-maybe" id="toc-recommendation-4-get-a-gpu-maybe" class="nav-link" data-scroll-target="#recommendation-4-get-a-gpu-maybe"><span class="header-section-number">11.9</span> Recommendation 4: Get a GPU, maybe</a></li>
  <li><a href="#assessing-ram-cpu-usage" id="toc-assessing-ram-cpu-usage" class="nav-link" data-scroll-target="#assessing-ram-cpu-usage"><span class="header-section-number">11.10</span> Assessing RAM + CPU usage</a></li>
  <li><a href="#examining-at-storage-usage" id="toc-examining-at-storage-usage" class="nav-link" data-scroll-target="#examining-at-storage-usage"><span class="header-section-number">11.11</span> Examining at storage usage</a></li>
  <li><a href="#running-out-of-resources" id="toc-running-out-of-resources" class="nav-link" data-scroll-target="#running-out-of-resources"><span class="header-section-number">11.12</span> Running out of Resources</a>
  <ul class="collapse">
  <li><a href="#aws-instances-for-data-science" id="toc-aws-instances-for-data-science" class="nav-link" data-scroll-target="#aws-instances-for-data-science"><span class="header-section-number">11.12.1</span> AWS Instances for data science</a></li>
  </ul></li>
  <li><a href="#comprehension-questions" id="toc-comprehension-questions" class="nav-link" data-scroll-target="#comprehension-questions"><span class="header-section-number">11.13</span> Comprehension Questions</a></li>
  <li><a href="#lab-changing-instance-size" id="toc-lab-changing-instance-size" class="nav-link" data-scroll-target="#lab-changing-instance-size"><span class="header-section-number">11.14</span> Lab: Changing Instance Size</a>
  <ul class="collapse">
  <li><a href="#step-1-confirm-current-server-size" id="toc-step-1-confirm-current-server-size" class="nav-link" data-scroll-target="#step-1-confirm-current-server-size"><span class="header-section-number">11.14.1</span> Step 1: Confirm current server size</a></li>
  <li><a href="#step-2-change-the-instance-type-and-bring-it-back" id="toc-step-2-change-the-instance-type-and-bring-it-back" class="nav-link" data-scroll-target="#step-2-change-the-instance-type-and-bring-it-back"><span class="header-section-number">11.14.2</span> Step 2: Change the instance type and bring it back</a></li>
  <li><a href="#step-3-confirm-new-server-size" id="toc-step-3-confirm-new-server-size" class="nav-link" data-scroll-target="#step-3-confirm-new-server-size"><span class="header-section-number">11.14.3</span> Step 3: Confirm new server size</a></li>
  <li><a href="#step-4-upgrade-storage-maybe" id="toc-step-4-upgrade-storage-maybe" class="nav-link" data-scroll-target="#step-4-upgrade-storage-maybe"><span class="header-section-number">11.14.4</span> Step 4: Upgrade storage (maybe)</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/akgold/do4ds/edit/main/chapters/sec2/2-5-scale.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-scale" class="quarto-section-identifier"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Server Resources and Scaling</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>If your server is for more than just playing, you will need to make sure you’ve got sufficient computational resources. That means appropriately sizing and scaling your server to accommodate your work.</p>
<p>This chapter is going to help you develop a mental model of what a server’s computational resources are, teach you about the command line tools to assess resource usage, and provide recommendations on how to scale and size a server for data science.</p>
<section id="the-briefest-intro-to-computational-theory" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="the-briefest-intro-to-computational-theory"><span class="header-section-number">11.1</span> The briefest intro to computational theory</h2>
<p>You’re probably aware that everything you’ve ever seen on a computer – from this book to your work in R or Python, your favorite internet cat videos, and Minecraft – is just 1s and 0s.</p>
<p>But the 1s and 0s aren’t actually the interesting part. They are just binary representations of integers (whole numbers). The mind bending part is that the integers represent something meaningful and <strong>the only</strong> thing the computer does is add these integers.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>That means that a helpful mental model for a computer is factory for doing addition problems. Everything you ask your computer to do is turned into an addition problem, then processed and returned, with the results interpreted as meaningful.</p>
<p>Since a computer is like an addition factory, decisions about server sizing and scaling are akin to questions of how to optimally design the conveyor belts in a factory. In this computer as factory analogy, there are three main resources you should consider – compute, memory, and storage.</p>
</section>
<section id="how-computers-compute" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="how-computers-compute"><span class="header-section-number">11.2</span> How computers compute</h2>
<p>The addition assembly line itself – where the work gets done – is referred to as <em>compute</em>. It’s where <span class="math inline">\(2+2\)</span> gets turned into <span class="math inline">\(4\)</span>, and where <span class="math inline">\(345619912 + 182347910\)</span> gets turned into <span class="math inline">\(527967822\)</span>.</p>
<p>All computers do their main compute in their central processing unit (CPU), which completes addition problems in one or more <em>cores</em>.</p>
<p>The speed of the CPU is largely determined by the number of cores and the speed of those cores.</p>
<p>The <em>number of cores</em> is like the number of lines in the factory. These days, most consumer-grade laptops have between 4 and 16 physical cores. Many have software capabilities that effectively double that number, so they can do between 4 and 32 addition problems simultaneously.</p>
<p><em>Single core clock speed</em>, how quickly a single addition problem is completed by a single core, is the baseline speed of an individual core. You can think of this as how fast the conveyor belt moves. Clock speeds are measured in operations per second or <em>hertz (hz)</em>. The cores in your laptop probably max out between two and five <em>gigahertz (GHz)</em>, which means between two billion and five billion operations per second.</p>
<p>For decades, many of the innovations in computing came from increases in single core clock speed, but those have fallen off in the last few decades. The clock speeds of consumer-grade chips increased by approximately 10x during the 90s, by 2-3x in the 2000s, and somewhere between not at all and 1.5x in the 2010s.</p>
<p>But computers have continued getting a lot faster even as the increase in clock speeds has slowed. The increase has mostly come from increases in the number of cores, better software usage of parallelization, and faster loading and unloading of the CPU (called the <em>bus</em>).</p>
</section>
<section id="recommendation-1-fewer-faster-cpu-cores" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="recommendation-1-fewer-faster-cpu-cores"><span class="header-section-number">11.3</span> Recommendation 1: Fewer, faster CPU cores</h2>
<p>R and Python are single-threaded. This means that unless you’re using special libraries for parallel processing, you’ll end up redlining a single CPU core while the others sit unused.</p>
<p>Therefore, for most R and Python work, single core clock speed matters more than the number of cores, and fewer, faster cores are usually preferable to many slower ones.</p>
<p>You’re probably not used to thinking about this tradeoff from buying a laptop or phone. The reality is that modern CPUs are pretty darn good and you should just buy the one that fits your budget.</p>
<p>If you’re standing up a cloud server, you often do have an explicit choice between more slower cores and fewer faster ones, determined by the instance family.</p>
<p>If you’re running a multi-user server, the number of cores you need can be hard to estimate. If you’re doing non-ML tasks like counts and dashboarding or relatively light-duty machine learning, I might advise the following:</p>
<p><span class="math display">\[
\text{n cores} = \text{1 core per user} + 1
\]</span></p>
<p>The spare core is for the server to do its own operations apart from the data science usage. On the other hand, if you’re doing heavy-duty machine learning or parallelizing jobs across the CPU, you may need more cores than this rule of thumb.</p>
</section>
<section id="how-memory-works" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="how-memory-works"><span class="header-section-number">11.4</span> How memory works</h2>
<p>Your computer’s random access memory (RAM) is its short term storage. You can think of RAM as the area adjacent to the assembly line where work to be done sits waiting and completed work is temporarily placed before it gets sent somewhere else.</p>
<p>Your computer can access things in RAM very quickly, so things stored in RAM are ready to go. The downside is that RAM is temporary. When your computer turns off, the RAM gets wiped.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Memory and storage are measured in <em>bytes</em> with metric prefixes.</p>
<p>Common sizes for memory these days are in <em>gigabytes</em> (billion bytes) and <em>terrabytes</em> (trillion bytes). Some enterprise data stores run on the scales of thousands of terrabytes (<em>pettabytes</em>) or even thousands of pettabytes (<em>yottabytes</em>).</p>
</div>
</div>
<p>Modern consumer-grade laptops come with somewhere between 4 and 16 Gb of memory.</p>
</section>
<section id="recommendation-2-get-as-much-ram-as-feasible" class="level2" data-number="11.5">
<h2 data-number="11.5" class="anchored" data-anchor-id="recommendation-2-get-as-much-ram-as-feasible"><span class="header-section-number">11.5</span> Recommendation 2: Get as much RAM as feasible</h2>
<p>In most cases, R and Python have to load all of your data into memory. Thus, the size of the data you can use is limited to the size of your machine’s RAM.</p>
<p>Most other machine limits will result in work completing slower than you might like, but trying to load too much data into memory will make your session crash.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’re running into this limitation, go back and think about your project architecture as discussed in <a href="../sec1/1-2-proj-arch.html">Chapter&nbsp;<span>2</span></a>. Maybe you can load less data into memory.</p>
</div>
</div>
<p>Because your computer needs memory for things other than R and Python, and because you’ll often be doing transformations that temporarily increase the size of your data, you need more memory than your largest data set.</p>
<p>Nobody has ever complained about having too much RAM, but a good rule of thumb is that you’ll be happy if:</p>
<p><span class="math display">\[\text{Amount of RAM} \ge 3 * \text{max amount of data}\]</span></p>
<p>If you’re thinking about running a multi-user server, you’ll need to take a step back to think about how many concurrent users you expect and how much data you anticipate each one to load.</p>
</section>
<section id="understanding-storage" class="level2" data-number="11.6">
<h2 data-number="11.6" class="anchored" data-anchor-id="understanding-storage"><span class="header-section-number">11.6</span> Understanding storage</h2>
<p><em>Storage</em>, or <em>hard disk/drive</em>, is where your computer stores things for the long term. It’s where applications are installed and where you save things you want to keep.</p>
<p>Relative to the RAM that’s right next to the factory floor, your computer’s storage is like the warehouse in the next building. Storage is much slower than RAM, often somewhere between 10x to 100x, but storage allows you to save things permanently.</p>
<p>Storage was even slower until a few years ago when <em>solid-state drives (SSDs)</em> became common. SSDs are collections of flash memory chips that are up to 15x faster than the <em>hard disk drives (HDDs)</em> that preceded them.</p>
<p>HDDs consist of spinning magnetic disks with magnetized read/write heads that save and read data from the disks. While HDDs spin very fast – 5,400 and 7,200 RPM are common speeds – SSDs with no moving parts are much faster.</p>
</section>
<section id="recommendation-3-get-lots-of-storage-its-cheap" class="level2" data-number="11.7">
<h2 data-number="11.7" class="anchored" data-anchor-id="recommendation-3-get-lots-of-storage-its-cheap"><span class="header-section-number">11.7</span> Recommendation 3: Get lots of storage, it’s cheap</h2>
<p>When it comes to configuring storage on your server, you should get a lot, but don’t spend a lot of time looking for the perfect solution since it’s cheap and easy to upgrade. In fact, it’s almost always more cost effective to buy additional storage when needed rather than have an expensive professional spend their time trying to figuring out how to move things around.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If the IT/Admins at your organization want you to spend a lot of time deleting things from storage, that’s usually a red flag that they aren’t thinking much about how to make the overall organization work more smoothly.</p>
</div>
</div>
<p>If you’re running a multi-user server, the amount of storage you need depends a lot on your data and your workflows. If you’re not saving large data files, the amount of space each person needs on the server is small. Code is very small and it’s rare to see R and Python packages take up more than a few dozen Mb per data scientist. A reasonable rule of thumb is to choose</p>
<p><span class="math display">\[
\text{Amount of Storage} = \text{1Gb} * \text{n users}
\]</span></p>
<p>On the other hand, if you will be saving a lot of data, you’ve got to take that into account. In some organizations, each data scientist will save dozens of flat files of a Gb or more for each of their projects.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’re working with a professional IT admin, they may be concerned about the storage implications of having package copies for each person on their team, a best practice for using environments as code as discussed in <a href="../sec1/1-1-env-as-code.html">Chapter&nbsp;<span>1</span></a>. I’ve heard this concern a lot from IT/Admins thinking ahead about running their server and almost never of a case where it’s actually been a problem in the end.</p>
</div>
</div>
<p>If you’re operating in the cloud, this really isn’t an important choice. As you’ll see in the lab, upgrading the amount of storage you have is a trivial operation, requiring at most a few minutes of downtime. Choose a size you estimate will be adequate and add more if needed.</p>
</section>
<section id="gpus-are-special-purpose-compute" class="level2" data-number="11.8">
<h2 data-number="11.8" class="anchored" data-anchor-id="gpus-are-special-purpose-compute"><span class="header-section-number">11.8</span> GPUs are special-purpose compute</h2>
<p>All computers have a CPU. Some computers have specialized chips where the CPU can offload particular tasks – the most common being the graphical processing unit (GPU). GPUs are architected for tasks like editing photos or videos, rendering video game graphics, some kinds of machine learning, and, yes, Bitcoin mining.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p>A GPU is an addition factory just like a CPU, but with the opposite architecture. CPUs have only a handful of cores, but those cores are fast. A GPU takes the opposite approach with many (relatively) slow cores.</p>
<p>Where a consumer-grade CPU has 4-16 cores, mid-range GPUs have 700-4,000 cores, with each one running at only about 1% to 10% the single core clock speed of a CPU core. For the tasks GPUs are good at, the overwhelming parallelism ends up being more important than the speed of any individual core, and GPU computation can be dramatically faster.</p>
<p>The choice of whether you need a GPU to do your work will really depend on what you’re doing and your budget.</p>
</section>
<section id="recommendation-4-get-a-gpu-maybe" class="level2" data-number="11.9">
<h2 data-number="11.9" class="anchored" data-anchor-id="recommendation-4-get-a-gpu-maybe"><span class="header-section-number">11.9</span> Recommendation 4: Get a GPU, maybe</h2>
<p>The tasks that most benefit from GPU computing include training highly parallel machine learning models like deep learning or tree-based models. If you do have one of these use cases, GPU computing can massively speed up your computation – making models trainable in hours instead of days.</p>
<p>If you are planning to use cloud resources for your computing, GPU-backed instances are quite pricey (hundreds of dollars an hour as of this writing). You’ll want to be careful about only putting those machines up when you’re using them.</p>
<p>Because GPUs are expensive, I generally wouldn’t bother with GPU-backed computing unless you’ve already tried without and find that it takes too long to be feasible.</p>
<p>It’s also worth noting that using a GPU won’t happen automatically. The tooling has gotten good enough that it’s usually easy to set up, but your computer won’t train your XGBoost models on your GPU unless you tell it to do so.</p>
<p>Now that you’re equipped with some general recommendations about choosing the right amount of resources, let’s get into how to tell whether it might be time to upgrade a system you already have.</p>
</section>
<section id="assessing-ram-cpu-usage" class="level2" data-number="11.10">
<h2 data-number="11.10" class="anchored" data-anchor-id="assessing-ram-cpu-usage"><span class="header-section-number">11.10</span> Assessing RAM + CPU usage</h2>
<p>Once you’ve chosen your server size and gotten up and running, you’ll want to be able to monitor RAM and CPU for problems.</p>
<p>A running program is running is called a <em>process</em>. For example, when you type <code>python</code> on the command line to open a REPL, that starts a single Python process. If you were to start a second terminal session and run <code>python</code> again, you’d have a second Python process.</p>
<p>Complicated programs often involve multiple interlocking processes. For example, running the RStudio IDE involves (at minimum) one process for the IDE itself and one for the R session that it uses in the background. The relationships between these different processes are mostly hidden from you – the end user.</p>
<p>As an admin, you may want to inspect the processes running on your system at any given time. The <code>top</code> command is a good first stop. <code>top</code> shows the top CPU-consuming processes in real time along with a number of other facts about them.</p>
<p>Here’s the <code>top</code> output from my machine as I write this sentence.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">PID</span>    COMMAND      %CPU TIME     <span class="co">#TH    #WQ  #PORT MEM    PURG   CMPRS PGRP</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>      kernel_task  16.1 03:56:53 530/10 0    0     2272K  0B     0B    0</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">16329</span>  WindowServer 16.0 01:53:20 23     6    3717  941M-  16M+   124M  16329</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">24484</span>  iTerm2       11.3 00:38.20 5      2    266-  71M-   128K   18M-  24484</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">29519</span>  top          9.7  00:04.30 1/1    0    36    9729K  0B     0B    29519</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">16795</span>  Magnet       3.1  00:39.16 3      1    206   82M    0B     39M   16795</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">16934</span>  Arc          1.8  18:18.49 45     6    938   310M   144K   61M   16934</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In most instances, the first three columns are the most useful. The first column is the unique process id (<code>pid</code>) for that process. You’ve got the name of the process (<code>COMMAND</code>) and how much CPU it’s using. You’ve also got the amount of memory used a few columns over. Right now, nothing is using a lot of CPU.</p>
<p>The <code>top</code> command takes over your whole terminal. You can exit with <code>Ctrl + c</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
So much CPU?
</div>
</div>
<div class="callout-body-container callout-body">
<p>For <code>top</code> (and most other commands), CPU is expressed as a percent of <em>single core</em> availability. On a modern machine with multiple cores, it’s very common to see CPU totals well over 100%. Seeing a single process using over 100% of CPU is rare.</p>
</div>
</div>
<p>Another useful command for finding runaway processes is <code>ps aux</code>. It lists a snapshot of all processes running on the system, along with how much CPU or RAM they’re using. You can sort the output with the <code>--sort</code> flag and specify sorting by cpu with <code>--sort -%cpu</code> or by memory with <code>--sort -%mem</code>.</p>
<p>Because <code>ps aux</code> returns <em>every</em> running process on the system, you’ll probably want to pipe the output into <code>head</code>. In addition to CPU and Memory usage, <code>ps aux</code> tells you who launched the command and the PID.</p>
<p>One of the times you’ll be most interested in the output of <code>top</code> or <code>ps aux</code> is when something is going rogue on your system and using more resources than you intended. If you have some sense of the name or who started it, you may want to pipe the output of <code>ps aux</code> into <code>grep</code> to find the <code>pid</code>.</p>
<p>For example, I might run <code>ps aux | grep RStudio</code> to get<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> ps <span class="ex">aux</span> <span class="kw">|</span> <span class="fu">grep</span> RStudio</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">USER</span>      PID   %CPU %MEM STARTED TIME     COMMAND</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">alexkgold</span> 23583 0.9  1.7  Sat09AM 17:15.27 /Applications/RStudio.app/RStudio</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">alexkgold</span> 23605 0.5  0.4  Sat09AM  1:58.16 /Applications/RStudio.app/rsession</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>RStudio is behaving nicely on my machine, but if it were not responsive, I could make note of its <code>pid</code> and end the process immediately by calling the <code>kill</code> command with the <code>pid</code>.</p>
</section>
<section id="examining-at-storage-usage" class="level2" data-number="11.11">
<h2 data-number="11.11" class="anchored" data-anchor-id="examining-at-storage-usage"><span class="header-section-number">11.11</span> Examining at storage usage</h2>
<p>A common culprit for weird server behavior is running out of storage space. There are two handy commands for monitoring the amount of storage you’ve got: <code>du</code> and <code>df</code>. These commands are almost always used with the <code>-h</code> flag to put file sizes in human-readable formats.</p>
<p><code>df</code> (disk free) shows the capacity left on the device where the directory sits. For example, here’s the result of running the <code>df</code> command on the chapters directory on my laptop that includes this chapter.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> df <span class="ex">-h</span> chapters</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Filesystem</span>     Size   Used  Avail Capacity iused      ifree %iused  Mounted on</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/disk3s5</span>  926Gi  227Gi  686Gi    25% 1496100 7188673280    0%   /System/Volumes/Data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can see that the <code>chapters</code> folder lives on a disk called <code>/dev/disk3s5</code> that’s a little less than 1Tb and is 25% full – no problem. On a server, this can be really useful to know because it’s quite easy to switch a disk out for a bigger one in the same spot.</p>
<p>If you’ve figured out that a disk is full, it’s usually most cost effective to just buy a bigger disk. But sometimes something weird happens. Maybe there are a few exceptionally big files, or you think unnecessary copies are being made.</p>
<p>If so, the <code>du</code> command (disk usage) gives you the size of individual files inside a directory. It’s particularly useful in combination with the sort command. For example, here’s the result of running <code>du</code> on the chapters directory where the text files for this book live.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> du <span class="ex">-h</span> chapters <span class="kw">|</span> <span class="fu">sort</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">12M</span> chapters</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1.7M</span>    chapters/sec1/images</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1.8M</span>    chapters/sec1</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">236K</span>    chapters/images</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="ex">488K</span>    chapters/sec2/images-traffic</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5.3M</span>    chapters/sec2/images-networking</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="ex">552K</span>    chapters/sec2/images</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="ex">6.6M</span>    chapters/sec2</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="ex">892K</span>    chapters/append/images</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="ex">948K</span>    chapters/append</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If I were thinking about cleaning up this directory, I could see that my <code>sec1/images</code> directory is my biggest single directory. If you find yourself needing to find big files on your Linux server, it’s worth spending some time looking through the useful options in the help pages for <code>du</code>.</p>
</section>
<section id="running-out-of-resources" class="level2" data-number="11.12">
<h2 data-number="11.12" class="anchored" data-anchor-id="running-out-of-resources"><span class="header-section-number">11.12</span> Running out of Resources</h2>
<p>If you recognize that you’re running out of resources on your current server, you may want to move to something bigger. There are two primary reasons servers run out of room.</p>
<p>The first is because people are running big jobs. This can happen at any scale of organization. There are data science teams of one who have use cases that necessitate terrabytes of data.</p>
<p>The second reason is because you have a lot of people using your server. This is generally a feature of big data science teams, irrespective of workload size.</p>
<p>Either way, there are two options for how to scale your data science workbench. The first is <em>vertical scaling</em>, which is just a fancy way of saying get a bigger server. The second option is <em>horizontal scaling</em>, which means running a whole fleet of servers in parallel and spreading the workload across them.</p>
<p>As a data scientist, you shouldn’t be shy about vertically scaling if your budget allows it. The complexity of managing a <code>t3.nano</code> with 2 cores and 0.5 Gb of memory is exactly the same as a <code>C5.24xlarge</code> with 96 cores and 192 Gb of memory. In fact, the bigger one may well be easier to manage since you won’t have to worry about running low on resources.</p>
<p>There are limits to the capacity of vertical scaling. As of this writing, AWS’s general-use instance types max out at 96-128 cores. That can quickly get eaten up by 50 data scientists with reasonably heavy computational demands.</p>
<p>Once you’re thinking about horizontal scaling, you’ve got a distributed service problem on your hands, which is inherently difficult. You should almost certainly get an IT/Admin professional involved. See <a href="../sec3/3-3-ent-scale.html">Chapter&nbsp;<span>17</span></a> for more on how to talk to them about it.</p>
<section id="aws-instances-for-data-science" class="level3" data-number="11.12.1">
<h3 data-number="11.12.1" class="anchored" data-anchor-id="aws-instances-for-data-science"><span class="header-section-number">11.12.1</span> AWS Instances for data science</h3>
<p>AWS offers a variety of different EC2 instance types split up by <em>family</em> and <em>size</em>. The family is the category of EC2 instance. Different families of instances are optimized for different kinds of workloads.</p>
<p>Here’s a table of common instance types for data science purposes:</p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 73%">
</colgroup>
<thead>
<tr class="header">
<th>Instance Type</th>
<th>What it is</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>t3</code></td>
<td>The “standard” configuration. Relatively cheap. Sizes may be limited.</td>
</tr>
<tr class="even">
<td><code>C</code></td>
<td>CPU-optimized instances, aka faster CPUs.</td>
</tr>
<tr class="odd">
<td><code>R</code></td>
<td>Higher ratio of RAM to CPU relative to <code>t3</code>.</td>
</tr>
<tr class="even">
<td><code>P</code></td>
<td>GPU instances, very expensive.</td>
</tr>
</tbody>
</table>
<p>Within each family, there are different sizes available, ranging from <em>nano</em> to multiples of <em>xl</em>. Instances are denoted by <em>&lt;family&gt;.&lt;size&gt;</em>. For example, when we put our instance originally on a free tier machine, we put it on a <code>t2.micro</code>.</p>
<p>In most cases, going up a size doubles the amount of RAM, the number of cores, and the hourly cost. You should do some quick math before you stand up a <code>C5.24xlarge</code> or a GPU-based <code>P</code> instance. If your instance won’t be up for very long, it may be fine, but make sure you take it down when you’re done, lest you rack up a huge bill.</p>
</section>
</section>
<section id="comprehension-questions" class="level2" data-number="11.13">
<h2 data-number="11.13" class="anchored" data-anchor-id="comprehension-questions"><span class="header-section-number">11.13</span> Comprehension Questions</h2>
<ol type="1">
<li><p>Think about the scenarios below. Which part of your computer would you want to upgrade to solve the problem?</p>
<ol type="1">
<li><p>You try csv file into pandas in Python. It churns for a while and then crashes.</p></li>
<li><p>You go to build a new ML model on your data. You’d like to re-train the model once a day, but it turns out training this model takes 26 hours on your laptop.</p></li>
<li><p>You design a visualization using the <code>{matplotlib}</code> package and want to create one version of the visualization for each US State. You could do it in a loop, but it would be faster to parallelize the plot creation. Right now you’re running on a <code>t2.small</code> with 1 CPU.</p></li>
</ol></li>
<li><p>Draw a mind map of the following: CPU, RAM, Storage, Operations Per Second, Parallel Operations, GPU, Machine Learning</p></li>
<li><p>What are the architectural differences between a CPU and a GPU? Why does this make a GPU particularly good for Machine Learning?</p></li>
<li><p>How would you do the following:</p>
<ol type="1">
<li><p>Find all running Jupyter processes that belong to the user <code>alexkgold</code>.</p></li>
<li><p>Find the different disks attached to your server and see how full each one is.</p></li>
<li><p>Find the biggest files in each user’s home directory.</p></li>
</ol></li>
</ol>
</section>
<section id="lab-changing-instance-size" class="level2" data-number="11.14">
<h2 data-number="11.14" class="anchored" data-anchor-id="lab-changing-instance-size"><span class="header-section-number">11.14</span> Lab: Changing Instance Size</h2>
<p>In this lab, we’re going to upgrade the size of our server. And the best part is that we’re in the cloud so it will only take a few minutes.</p>
<section id="step-1-confirm-current-server-size" class="level3" data-number="11.14.1">
<h3 data-number="11.14.1" class="anchored" data-anchor-id="step-1-confirm-current-server-size"><span class="header-section-number">11.14.1</span> Step 1: Confirm current server size</h3>
<p>First, let’s confirm what we’ve got available. Once you <code>ssh</code> into the server, you can check the number of CPUs you’ve got with <code>lscpu</code> in a terminal. Similarly, you can check the amount of RAM with <code>free -h</code>. This is just so you can prove to yourself later that the instance really changed.</p>
</section>
<section id="step-2-change-the-instance-type-and-bring-it-back" class="level3" data-number="11.14.2">
<h3 data-number="11.14.2" class="anchored" data-anchor-id="step-2-change-the-instance-type-and-bring-it-back"><span class="header-section-number">11.14.2</span> Step 2: Change the instance type and bring it back</h3>
<p>Now, you can go to the instance page in the AWS console. The first step is to stop (not terminate!) the instance. This means that changing instance type <em>does</em> require some downtime, but it’s quite limited.</p>
<p>Once the instance has stopped, you can change the instance type under Actions &gt; Instance Settings. Then start the instance. It’ll take a few seconds to start the instance.</p>
</section>
<section id="step-3-confirm-new-server-size" class="level3" data-number="11.14.3">
<h3 data-number="11.14.3" class="anchored" data-anchor-id="step-3-confirm-new-server-size"><span class="header-section-number">11.14.3</span> Step 3: Confirm new server size</h3>
<p>For example, I changed from a <code>t2.micro</code> to a <code>t2.small</code>. Both only have 1 CPU, so I won’t see any difference in <code>lscpu</code>, but running <code>free -h</code> before and after the switch reveals that I’ve got more RAM:</p>
<pre><code>test-user@ip-172-31-53-181:~$ free -h
               total        used        free      shared  buff/cache   available
Mem:           966Mi       412Mi       215Mi       0.0Ki       338Mi       404Mi
Swap:             0B          0B          0B
test-user@ip-172-31-53-181:~$ free -h
               total        used        free      shared  buff/cache   available
Mem:           1.9Gi       225Mi       1.3Gi       0.0Ki       447Mi       1.6Gi
Swap:             0B          0B          0B</code></pre>
<p>There’s twice as much after the change!</p>
<p>There are some rules around being able to change from one instance type to another, but this is a superpower if you’ve got variable workloads or a team that’s growing. Once you’re done with your larger server, it’s just as easy to scale it back down.</p>
</section>
<section id="step-4-upgrade-storage-maybe" class="level3" data-number="11.14.4">
<h3 data-number="11.14.4" class="anchored" data-anchor-id="step-4-upgrade-storage-maybe"><span class="header-section-number">11.14.4</span> Step 4: Upgrade storage (maybe)</h3>
<p>If you want more storage, it’s similarly easy to resize the EBS volume attached to your server.</p>
<p>I wouldn’t recommend doing it for this lab because you can only automatically adjust volume sizes up. That means you’d have to manually transfer all of your data if you ever wanted to scale back down.</p>
<p>If you do resize the volume, you’ll have to let Linux know so it can resize the filesystem with the new space available. AWS has a great walkthrough called <em>Extend a Linux filesystem after resizing the volume</em> that I recommend you follow.</p>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>This was proved in Alan Turing’s 1936 paper on computability. If you’re interested in learning more, I recommend <a href="https://www.goodreads.com/en/book/show/2333956.The_Annotated_Turing">The Annotated Turing: A Guided Tour Through Alan Turing’s Historic Paper on Computability and the Turing Machine</a> by Charles Petzold for a surprisingly readable walkthrough.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>You probably don’t experience this. Modern computers are pretty smart about dumping RAM onto the hard disk before shutting down and bringing it back on startup, so you usually won’t notice this happening.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Purpose-built chips are becoming more common for AI/ML tasks, especially doing local inference on large models. These include Tensor Processing Units (TPUs) and Intelligence Processing Units (IPUs).<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>I’ve done a bunch of doctoring to the output to make it easier to read.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/sec2/2-4-app-admin.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Application administration</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/sec2/2-6-networking.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Computer Networks</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, Alex K Gold</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/akgold/do4ds" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/alexkgold">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>