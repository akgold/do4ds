<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DevOps for Data Science - 9&nbsp; Demystifying Docker</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/sec3/3-0-sec-intro.html" rel="next">
<link href="../../chapters/sec2/2-3-cmd-line.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EQR1RYSHQK"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EQR1RYSHQK', { 'anonymize_ip': true});
</script>


</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/sec2/2-0-sec-intro.html">IT/Admin Tools</a></li><li class="breadcrumb-item"><a href="../../chapters/sec2/2-4-docker.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Demystifying Docker</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">DevOps for Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/akgold/do4ds" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec1/1-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DevOps Lessons for Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-1-env-as-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Environments as Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-2-proj-arch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Project Architecture Guidelines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-3-data-access.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Using databases and data APIs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-4-monitor-log.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Logging and Monitoring</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-5-deployments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Deployments and code promotion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec2/2-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IT/Admin Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-1-terminal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Terminal</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-2-ssh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Connecting Securely with SSH</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-3-cmd-line.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Getting comfortable on the Command Line</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-4-docker.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Demystifying Docker</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec3/3-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IT/Admin for Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-1-cloud.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Getting Started with the Cloud</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-2-linux-admin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Basic Linux SysAdmin</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-3-networking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Intro to Computer Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-4-dns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">DNS allows for human-readable addresses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-5-ssl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">You should use SSL/HTTPS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-6-servers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Choosing the right server for you</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec4/4-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making it Enterprise-Grade</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-1-os-ds-in-ent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Open Source Data Science in the Enterprise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-2-ent-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Enterprise Networking</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-3-auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Auth in Enterprise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-4-ent-servers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Enterprise Server Management</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Auth Technologies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/lab-map.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Lab Map</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#container-lifecycle" id="toc-container-lifecycle" class="nav-link active" data-scroll-target="#container-lifecycle"><span class="header-section-number">9.1</span> Container Lifecycle</a>
  <ul class="collapse">
  <li><a href="#flags-for-docker-run" id="toc-flags-for-docker-run" class="nav-link" data-scroll-target="#flags-for-docker-run"><span class="header-section-number">9.1.1</span> Flags for <code>docker run</code></a></li>
  </ul></li>
  <li><a href="#building-from-dockerfiles" id="toc-building-from-dockerfiles" class="nav-link" data-scroll-target="#building-from-dockerfiles"><span class="header-section-number">9.2</span> Building from Dockerfiles</a>
  <ul class="collapse">
  <li><a href="#dockerfile-commands" id="toc-dockerfile-commands" class="nav-link" data-scroll-target="#dockerfile-commands"><span class="header-section-number">9.2.1</span> Dockerfile Commands</a></li>
  </ul></li>
  <li><a href="#comprehension-questions" id="toc-comprehension-questions" class="nav-link" data-scroll-target="#comprehension-questions"><span class="header-section-number">9.3</span> Comprehension Questions</a></li>
  <li><a href="#lab-putting-an-api-in-a-container" id="toc-lab-putting-an-api-in-a-container" class="nav-link" data-scroll-target="#lab-putting-an-api-in-a-container"><span class="header-section-number">9.4</span> Lab: Putting an API in a Container</a>
  <ul class="collapse">
  <li><a href="#lab-extension" id="toc-lab-extension" class="nav-link" data-scroll-target="#lab-extension"><span class="header-section-number">9.4.1</span> Lab Extension</a></li>
  </ul></li>
  <li><a href="#cheat-docker" id="toc-cheat-docker" class="nav-link" data-scroll-target="#cheat-docker"><span class="header-section-number">9.5</span> Cheatsheet: Docker</a>
  <ul class="collapse">
  <li><a href="#docker-cli-commands" id="toc-docker-cli-commands" class="nav-link" data-scroll-target="#docker-cli-commands"><span class="header-section-number">9.5.1</span> Docker CLI Commands</a></li>
  <li><a href="#flags-for-docker-run-1" id="toc-flags-for-docker-run-1" class="nav-link" data-scroll-target="#flags-for-docker-run-1"><span class="header-section-number">9.5.2</span> <strong>Flags for <code>docker run</code></strong></a></li>
  <li><a href="#dockerfile-commands-1" id="toc-dockerfile-commands-1" class="nav-link" data-scroll-target="#dockerfile-commands-1"><span class="header-section-number">9.5.3</span> Dockerfile Commands</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/akgold/do4ds/edit/main/chapters/sec2/2-4-docker.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-docker" class="quarto-section-identifier"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Demystifying Docker</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Docker is an incredible tool for reproducing a finished analysis somewhere else or sometime else, especially in concert with creating R and Python environments as code like we discussed in <a href="../sec1/1-1-env-as-code.html">Chapter&nbsp;<span>1</span></a>. In a data science context, my recommendation is to treat Docker as a tool for enhancing reproducibility by putting finished analyses into a Docker container for deployment or archiving.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Before you start, make sure to install <a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a> on your laptop.</p>
</div>
</div>
<p>This chapter is designed to give you an introduction to how to use Docker containers other people have created and how to create your own.</p>
<section id="container-lifecycle" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="container-lifecycle"><span class="header-section-number">9.1</span> Container Lifecycle</h2>
<p>Let’s spend just a minute digging into the the lifecycle of a Docker container.</p>
<p>This image explains the different states a Docker container can be in, and the commands you’ll need to move them around.</p>
<p>TODO: change Docker Container to Docker Container Instance, add 3 vertical stages: build, move, run</p>
<p><img src="images-docker/docker-lifecycle.png" class="img-fluid" width="561"></p>
<p>The most pure distillation of a Docker Container is the <em>Docker Image</em>. An image is an immutable snapshot of a container, suspended in time. It is totally possible to have multiple similar images, but images are immutable by definition. Any changes would make it a different image.</p>
<p>The most common place to store images is in a <em>Docker Registry</em>, but they can also be moved around like regular files.</p>
<p>Docker Registries are quite similar to git repositories. Some organizations run their own registries, most often using offerings from cloud providers.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> The Docker company also runs <a href="https://hub.docker.com/">Docker Hub</a>, which allows public hosting and private hosting of images in free and paid tiers.</p>
<p>Images have names that consist of an <em>id</em> and a <em>tag</em>. If you’re using the public Docker Hub registry, container ids take the form <code>&lt;user&gt;/&lt;name&gt;</code>, so my penguin model container is <code>alexkgold/penguin-model</code>.</p>
<p>Tags are used to specify versions – sometimes of the container itself, but also sometimes of the software it contains. If you don’t specify a tag, it defaults to <code>latest</code>. For example, the <code>rocker/r-ver</code> container, which is a container pre-built with a version of R in it uses tags for the version of R.</p>
<p>Before the Docker Image exists, it has to get built somehow. It is possible, but not recommended, to interactively build a Docker Container. Instead, containers are usually built from a <em>Dockerfile</em>. Dockerfiles are just code, so they’re often stored in a git repository and it’s common to build and store them with CI/CD.</p>
<p>A <em>Docker Container Instance</em> is the Docker Container running somewhere at a given point in time. It’s the thing you’ll actually interact with as a running service.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I’ve included <code>docker pull</code> on the graphic for completeness, but you’ll almost never run it. <code>docker run</code> auto-pulls the container(s) it needs.</p>
</div>
</div>
<p>You can control Docker Containers from the Docker Desktop app. But if you’re going to be using Docker on a server, you’ll mostly be interacting via the CLI. There’s a <a href="#cheat-docker">cheatsheet</a> for Docker CLI commands at the end of this chapter.</p>
<section id="flags-for-docker-run" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1" class="anchored" data-anchor-id="flags-for-docker-run"><span class="header-section-number">9.1.1</span> Flags for <code>docker run</code></h3>
<p>You run a container by using the <code>docker run</code> command on the command line.</p>
<p>At its most basic, <code>docker run &lt;image name&gt;</code> will give you a running container. However, Docker commands usually use <em>a lot</em> of command line flags – so many that it’s easy to miss what the command actually is.</p>
<p>One of the things to consider about running a Docker container is how restricted its access is. By default, the container can’t access anything from the host where it’s running. This is a great security feature, but if you want to make data or code available from your host inside the container – or you want to run the container to host an app or API, you’ll need to include those permissions in your <code>docker run</code> command.</p>
<p>One of the important things to include in your mental model is that the container has its own networking and file system. For example, the <code>-v</code> flag makes a volume (directory) from outside the container available inside.</p>
<p>So let’s say you’ve got some data in your <code>~/Documents/my-project/data</code> directory. You might just want to make it available to the container at <code>/data</code> or <code>/mnt/data</code>. That’s easy to do with the <code>-v</code> command: <code>-v ~/Documents/my-project/data:/data</code>.</p>
<p>TODO: slashes are wrong.</p>
<p><img src="images-docker/docker-on-host.png" class="img-fluid" width="593"></p>
</section>
</section>
<section id="building-from-dockerfiles" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="building-from-dockerfiles"><span class="header-section-number">9.2</span> Building from Dockerfiles</h2>
<p>A Dockerfile is a set of instructions that you use to build a Docker Image. Dockerfiles have a particular syntax, but it’s quite readable and if you know how to accomplish something on a running machine, you shouldn’t have too much trouble building a Dockerfile to do the same.</p>
<p>The basic notion to have in mind is building up <em>layers</em> – each one being a usable container.</p>
<p>Your first layer is always the container you’re starting from – sometimes a barebones operating system-only container like <code>ubuntu:latest</code> and sometimes a much richer starting point like <code>rocker/shiny</code> or <code>python/3.10</code>.</p>
<p>Then you’ll take action on top of that layer, installing some software, copying in files or directories, or telling the container what to do when it starts.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>One of the nicest conveniences of building Docker Containers is that Docker understands your container’s layers and will only rebuild changed layers and subsequent ones.</p>
<p>For example, let’s say you have a Dockerfile with 3 layers – a starting container, copy in some files, and setting the run time command. If you change the run time command in your Dockerfile and rebuild, the build process will start from the container after everything’s been copied in. This drastically speeds up the container development process.</p>
</div>
</div>
<p>As you design your Dockerfile, you’ll have to think about what should get put into the container at <em>build</em> time. Your container gets frozen in time during the build, so that’s when you want to put everything the container needs into the container. Moreover, the building script has pretty much free-regin over your system, so that’s when you’ll do things like setting up the versions of R and Python, copying in your project code, and installing system requirements.</p>
<section id="dockerfile-commands" class="level3" data-number="9.2.1">
<h3 data-number="9.2.1" class="anchored" data-anchor-id="dockerfile-commands"><span class="header-section-number">9.2.1</span> Dockerfile Commands</h3>
<p>The <a href="https://docs.docker.com/engine/reference/builder/">Dockerfile documentation</a> provides many different commands you can use during build, but here are the handful that are enough to build most images you might need.</p>
<ul>
<li><p><code>FROM</code> – specify the base image.</p></li>
<li><p><code>RUN</code> – run any command as if you were sitting at the command line inside the container. Just remember, if you’re starting from a very basic container, you may need to make a command available before you can run it (like <code>wget</code> in my container below).</p></li>
<li><p><code>COPY</code> – copy a file from the host filesystem into the container.</p></li>
<li><p><code>CMD</code> - Specifies what command to run on the container’s shell when it runs. This would be the same command you’d use to run your data science project from the command line.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p></li>
</ul>
<p>Once you’ve created your Dockerfile, you build it into an image using <code>docker build -t &lt;image name&gt; &lt;build directory&gt;</code>. If you don’t provide a tag, the default tag is <code>latest</code>.</p>
<p>You can then push that to DockerHub or another registry using <code>docker push &lt;image name&gt;</code>.</p>
</section>
</section>
<section id="comprehension-questions" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="comprehension-questions"><span class="header-section-number">9.3</span> Comprehension Questions</h2>
<ol type="1">
<li>What does using a Docker container for a data science project make easier? What does it make harder?</li>
<li>Draw a mental map of the relationship between the following: Dockerfile, Docker Image, Docker Registry, Docker Container</li>
<li>When would you want to use each of the following flags for <code>docker run</code>? When wouldn’t you?
<ul>
<li><code>-p</code>, <code>--name</code>, <code>-d</code>, <code>--rm</code>, <code>-v</code></li>
</ul></li>
<li>What are the most important Dockerfile commands?</li>
</ol>
</section>
<section id="lab-putting-an-api-in-a-container" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="lab-putting-an-api-in-a-container"><span class="header-section-number">9.4</span> Lab: Putting an API in a Container</h2>
<p>Let’s put our Penguin model prediction API from <a href="../sec1/1-2-proj-arch.html">Chapter&nbsp;<span>2</span></a> into a container.</p>
<p>Again, Vetiver has some nice tooling to make this very easy to do. You should follow the instructions on the <code>{vetiver}</code> website for how to generate your Dockerfile.</p>
<p>One thing to note about this container – it follows best practices for how to put data (in this case the machine-learning model) into the container. That means the model <em>isn’t</em> built into the container. Instead, the container knows how to fetch the model.</p>
<p>I’m using this code to generate my Dockerfile</p>
<div class="sourceCode" id="cb1" data-startfrom="9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python" style="counter-reset: source-line 8;"><span id="cb1-9"><a href="#cb1-9"></a><span class="im">from</span> pins <span class="im">import</span> board_folder</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="im">from</span> vetiver <span class="im">import</span> prepare_docker</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a>board <span class="op">=</span> board_folder(<span class="st">"/data/model"</span>, allow_pickle_read<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-13"><a href="#cb1-13"></a>prepare_docker(board, <span class="st">"penguin_model"</span>, <span class="st">"docker"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once you’ve generated your Dockerfile, take a look at it. Here’s the one for my model:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Dockerfile</strong></pre>
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource dockerfile number-lines code-with-copy"><code class="sourceCode dockerfile"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># # Generated by the vetiver package; edit with care</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co"># start with python base image</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">FROM</span> python:3.9</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co"># create directory in container for vetiver files</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="kw">WORKDIR</span> /vetiver</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co"># copy  and install requirements</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="kw">COPY</span> vetiver_requirements.txt /vetiver/requirements.txt</span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="kw">RUN</span> <span class="ex">pip</span> install <span class="at">--no-cache-dir</span> <span class="at">--upgrade</span> <span class="at">-r</span> /vetiver/requirements.txt</span>
<span id="cb2-13"><a href="#cb2-13"></a></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co"># copy app file</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="kw">COPY</span> app.py /vetiver/app/app.py</span>
<span id="cb2-16"><a href="#cb2-16"></a></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co"># expose port</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="kw">EXPOSE</span> 8080</span>
<span id="cb2-19"><a href="#cb2-19"></a></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co"># run vetiver API</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="kw">CMD</span> [<span class="st">"uvicorn"</span>, <span class="st">"app.app:api"</span>, <span class="st">"--host"</span>, <span class="st">"0.0.0.0"</span>, <span class="st">"--port"</span>, <span class="st">"8080"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This auto-generated Dockerfile is very nicely commented, so its easy to follow.</p>
<p>Now build the container using <code>docker build -t penguin-model .</code>.</p>
<p>Ok, now let’s run the container using</p>
<div class="sourceCode" id="cb3" data-eval="false"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-d</span> <span class="dt">\</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="at">-p</span> 8080:8080 <span class="dt">\</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="at">--name</span> penguin-model <span class="dt">\</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  penguin-model-local</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you go to <code>http://localhost:8080</code> you’ll find that…it doesn’t work? Why? If you run the container attached (remove the <code>-d</code> from the run command) you’ll get some feedback that might be helpful.</p>
<p>In line 15 of the Dockerfile, we copied the <code>app.py</code> in to the container. Let’s take a look at that file to see if we can find any hints.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>app.py</strong></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="im">from</span> vetiver <span class="im">import</span> VetiverModel</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="im">import</span> vetiver</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="im">import</span> pins</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a>b <span class="op">=</span> pins.board_folder(<span class="st">'./model'</span>, allow_pickle_read<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-7"><a href="#cb4-7"></a>v <span class="op">=</span> VetiverModel.from_pin(b, <span class="st">'penguin_model'</span>, version <span class="op">=</span> <span class="st">'20230422T102952Z-cb1f9'</span>)</span>
<span id="cb4-8"><a href="#cb4-8"></a></span>
<span id="cb4-9"><a href="#cb4-9"></a>vetiver_api <span class="op">=</span> vetiver.VetiverAPI(v)</span>
<span id="cb4-10"><a href="#cb4-10"></a>api <span class="op">=</span> vetiver_api.app</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Look at that (very long) line 6. The API is connecting to a local directory to pull the model. Is your spidey sense tingling? Something about container filesystem vs host filesystem?</p>
<p>That’s right – we put our model at <code>/data/model</code> on our <em>host</em> machine. But the API inside the container is looking for <code>/data/model</code> <em>inside</em> the container, which doesn’t exist!</p>
<p>This is a case where we need to mount a volume into the container like so</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-d</span> <span class="dt">\</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="at">-p</span> 8080:8080 <span class="dt">\</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="at">--name</span> penguin-model <span class="dt">\</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="at">-v</span> /data/model:/data/model <span class="dt">\</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  penguin-model-local</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And NOW you should be able to get your model up in no time.</p>
<p>It’s worth noting that it’s somewhat rare that you want to put the volume at the same location inside the container as it is outside. But because of the <code>{vetiver}</code> tooling, it expects it to be at the same place.</p>
<p>Now, thinking back to <a href="../sec1/1-3-data-access.html">Chapter&nbsp;<span>3</span></a>, we’re going to run into some trouble when when and if we move the API off of our laptop and onto a server. We’ll address that in <a href="../sec3/3-1-cloud.html">Chapter&nbsp;<span>10</span></a>.</p>
<section id="lab-extension" class="level3" data-number="9.4.1">
<h3 data-number="9.4.1" class="anchored" data-anchor-id="lab-extension"><span class="header-section-number">9.4.1</span> Lab Extension</h3>
<p>Right now, logs from the API just stay inside the app. But that means that the logs go away when the container does. That’s obviously bad if the container dies because something goes wrong. How might you make sure that the container’s logs get written somewhere more permanent?</p>
</section>
</section>
<section id="cheat-docker" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="cheat-docker"><span class="header-section-number">9.5</span> Cheatsheet: Docker</h2>
<section id="docker-cli-commands" class="level3" data-number="9.5.1">
<h3 data-number="9.5.1" class="anchored" data-anchor-id="docker-cli-commands"><span class="header-section-number">9.5.1</span> Docker CLI Commands</h3>
<table class="table">
<colgroup>
<col style="width: 3%">
<col style="width: 18%">
<col style="width: 29%">
<col style="width: 49%">
</colgroup>
<thead>
<tr class="header">
<th>Stage</th>
<th>Command</th>
<th>What it does</th>
<th>Notes and helpful options</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Build</td>
<td><code>docker build &lt;directory&gt;</code></td>
<td>Builds a directory containing a Dockerfile into an image.</td>
<td><code>-t &lt;name:tag&gt;</code> provide a name to the container. <code>tag</code> is optional, defaults to <code>latest</code>.</td>
</tr>
<tr class="even">
<td>Move</td>
<td><code>docker push &lt;image&gt;</code></td>
<td>Push a container to a registry.</td>
<td></td>
</tr>
<tr class="odd">
<td>Run</td>
<td><code>docker run &lt;image&gt;</code></td>
<td>Run a container.</td>
<td>See section below.</td>
</tr>
<tr class="even">
<td>Run</td>
<td><code>docker stop &lt;container&gt;</code></td>
<td>Stop a running container.</td>
<td><code>docker kill</code> can be used if <code>stop</code> fails.</td>
</tr>
<tr class="odd">
<td>Run</td>
<td><code>docker ps</code></td>
<td>List containers.</td>
<td>Useful to get running container id to do things to it.</td>
</tr>
<tr class="even">
<td>Run</td>
<td><code>docker exec &lt;container&gt; &lt;command&gt;</code></td>
<td>Run a command inside a running container.</td>
<td>Basically always used to open a shell in a container with <code>docker exec -it &lt;container&gt; /bin/bash</code></td>
</tr>
<tr class="odd">
<td>Run</td>
<td><code>docker logs &lt;container&gt;</code></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="flags-for-docker-run-1" class="level3" data-number="9.5.2">
<h3 data-number="9.5.2" class="anchored" data-anchor-id="flags-for-docker-run-1"><span class="header-section-number">9.5.2</span> <strong>Flags for <code>docker run</code></strong></h3>
<table class="table">
<caption><em>Reminder: Order for <code>-p</code> and <code>-v</code> is <code>&lt;host&gt;:&lt;container&gt;</code></em></caption>
<colgroup>
<col style="width: 8%">
<col style="width: 20%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th>Flag</th>
<th>Effect</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>--name &lt;name&gt;</code></td>
<td>Give a name to the running container.</td>
<td>Optional. Will be auto-assigned if not provided. Then you’ll need to discover name with <code>docker ps</code>.</td>
</tr>
<tr class="even">
<td><code>--rm</code></td>
<td>Remove container when its stopped.</td>
<td>Very useful when playing around because it cleans things up. Almost never used in prod, because you usually want to be able to inspect logs from old containers.</td>
</tr>
<tr class="odd">
<td><code>-d</code></td>
<td>Detach container (don’t block the terminal).</td>
<td>Almost always used in production. Sometimes useful to stay attached when troubleshooting.</td>
</tr>
<tr class="even">
<td><code>-p &lt;port&gt;:&lt;port&gt;</code></td>
<td>Publish port from inside container to outside.</td>
<td>Needed if you want to access anything inside the container with HTTP.</td>
</tr>
<tr class="odd">
<td><code>-v &lt;dir&gt;:&lt;dir&gt;</code></td>
<td>Mount volume into the container.</td>
<td>Make a directory (volume) on the host available to the container for reading and writing.</td>
</tr>
</tbody>
</table>
</section>
<section id="dockerfile-commands-1" class="level3" data-number="9.5.3">
<h3 data-number="9.5.3" class="anchored" data-anchor-id="dockerfile-commands-1"><span class="header-section-number">9.5.3</span> Dockerfile Commands</h3>
<p>These are the commands that go in a Dockerfile when you’re building it.</p>
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 60%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>Purpose</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>FROM</code></td>
<td>Indicate base container</td>
<td><code>FROM rocker/r-ver:4.1.0</code></td>
</tr>
<tr class="even">
<td><code>RUN</code></td>
<td>Run a command when building</td>
<td><code>RUN apt-get update</code></td>
</tr>
<tr class="odd">
<td><code>COPY</code></td>
<td>Copy from build directory into the container</td>
<td><code>COPY . /app/</code></td>
</tr>
<tr class="even">
<td><code>CMD</code></td>
<td>Specify the command to run when the container starts</td>
<td><code>CMD quarto render .</code></td>
</tr>
</tbody>
</table>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>The big three container registries are AWS Elastic Container Registry (ECR), Azure Container Registry, and Google Container Registry.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>You may also see <code>ENTRYPOINT</code>, which sets the command <code>CMD</code> runs against. Usually the default <code>/bin/sh -c</code> to run <code>CMD</code> in the shell will be the right choice.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>

<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/sec2/2-3-cmd-line.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Getting comfortable on the Command Line</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/sec3/3-0-sec-intro.html" class="pagination-link">
        <span class="nav-page-text">IT/Admin for Data Science</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, Alex K Gold</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/akgold/do4ds" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/alexkgold">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>