<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.339">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DevOps for Data Science - 4&nbsp; Docker for Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<link href="../../chapters/sec1/data.html" rel="next">
<link href="../../chapters/sec1/repro-pkgs.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link id="quarto-text-highlighting-styles" href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Docker for Data Science</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">DevOps for Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/akgold/do4ds" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">DevOps Lessons for Data Science</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/cmd-line.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Command Line + SSH</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/code-promotion.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Code Promotion Workflows</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/repro-pkgs.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Environments and Reproducibility</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/docker.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Docker for Data Science</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Taking Data to Production</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/cloud.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Cloud and Cloud Providers</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Your Own Data Science Workbench</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/servers.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Computers, Computing, and Servers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/aws-walkthrough.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Lab 1: Get your own server</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/understanding-traffic.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Computer Networks and the Internet</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/using-urls.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Getting a real URL</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/private-network-config.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Private Networking Configuration</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Working with Enterprise IT</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/auth.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">How login works</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/offline.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Offline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/scaling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Scaling</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Appendices</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/env-req.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Determining What You Need</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/terminal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Getting Started with Terminal</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/linux-cmd.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Useful Shell Commands</span></a>
  </div>
</li>
    </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#what-is-docker-anyway" id="toc-what-is-docker-anyway" class="nav-link active" data-scroll-target="#what-is-docker-anyway"> <span class="header-section-number">4.1</span> What is Docker anyway?</a>
  <ul class="collapse">
  <li><a href="#container-lifecycle" id="toc-container-lifecycle" class="nav-link" data-scroll-target="#container-lifecycle"> <span class="header-section-number">4.1.1</span> Container Lifecycle</a></li>
  </ul></li>
  <li><a href="#docker-for-the-data-scientist" id="toc-docker-for-the-data-scientist" class="nav-link" data-scroll-target="#docker-for-the-data-scientist"> <span class="header-section-number">4.2</span> Docker for the Data Scientist</a></li>
  <li><a href="#hands-on-with-docker" id="toc-hands-on-with-docker" class="nav-link" data-scroll-target="#hands-on-with-docker"> <span class="header-section-number">4.3</span> Hands on with Docker</a>
  <ul class="collapse">
  <li><a href="#getting-prepped" id="toc-getting-prepped" class="nav-link" data-scroll-target="#getting-prepped"> <span class="header-section-number">4.3.1</span> Getting prepped</a></li>
  <li><a href="#running-an-app-from-docker" id="toc-running-an-app-from-docker" class="nav-link" data-scroll-target="#running-an-app-from-docker"> <span class="header-section-number">4.3.2</span> Running an app from Docker</a></li>
  <li><a href="#running-a-batch-job" id="toc-running-a-batch-job" class="nav-link" data-scroll-target="#running-a-batch-job"> <span class="header-section-number">4.3.3</span> Running a batch job</a></li>
  <li><a href="#using-dockerfiles" id="toc-using-dockerfiles" class="nav-link" data-scroll-target="#using-dockerfiles"> <span class="header-section-number">4.3.4</span> Using Dockerfiles</a></li>
  <li><a href="#docker-cheatsheet" id="toc-docker-cheatsheet" class="nav-link" data-scroll-target="#docker-cheatsheet"> <span class="header-section-number">4.3.5</span> Docker Cheatsheet</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"> <span class="header-section-number">4.4</span> Exercises</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/akgold/do4ds/edit/main/chapters/sec1/docker.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Docker for Data Science</span></h1>
</div>





<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>If you’re in the data science world, especially the world of “production data science”, you’ve probably heard of Docker – but you might not really be sure what it is or whether you need it.</p>
<p>This chapter is designed to clarify what Docker is and how it might help you. We’ll start with a general intro to Docker, proceed with some discussion of data science-relevant Docker workflows, and then dive in to a hands-on lab that will be just the thing to get you started if you’re not sure where to go.</p>
<section id="what-is-docker-anyway" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="what-is-docker-anyway"><span class="header-section-number">4.1</span> What is Docker anyway?</h2>
<p>Here’s an unhelpful definition – Docker is an open-source containerization platform.</p>
<p>To get away from unhelpful definitions, let’s talk a little about why you might want to use Docker.</p>
<p>Let’s say you’ve got a Shiny app you want to share with your colleagues. Before you can share that app, you’ve got to make sure that your colleagues have the right set of R packages, a compatible version of R, and a compatible operating system. In contrast to the difficulty of making sure all those things match, a container allows you to simply share the entire container and go!</p>
<p>Let’s say you’re developing an app. If you read the <a href="#repro">chapter on reproducibility</a>, you understand that there are layers of dependencies you’re accumulating, including your code, the R and Python packages your code needs, the versions of the langauges themselves, and right down to the operating system.</p>
<p><img src="images-repro/stack-layers.png" class="img-fluid"></p>
<p>It would be very useful to be able to take all these things, package them up, and ship them off somewhere – maybe you want to share all of this with a collaborator or ship your app to production and be pretty confident the app will run without a lot of work to re-create the environment.</p>
<p>In the last 5-10 years, containers have become the primary way people package up their apps with their dependencies to share them like this.</p>
<p>When you pull and load this image, you’ll find it takes a long time. The real power of Docker becomes apparent the <em>second</em> time you start this image. Once you’ve got the image downloaded locally, the container comes alive in a fraction of a second. This is in stark contrast to other sorts of local segregated environments that allow you to have a computer in a computer like VirtualBox – there are real benefits to having a full reproduction of another computer, rather than just a hypervisor-based container – but they also take seconds or minutes to stand up.</p>
<p>Relative to earlier technologies like virtual machines, containers are much more lightweight. In fact, Docker containers can start up in a fraction of a second and be ready to go. This means that putting your app in a container adds very little overhead in terms of performance, which is great!</p>
<p>IT/Admins tend to love Docker because apps show up pre-packaged, because Docker makes it really easy to scale up apps in a “microservices architecture”, and because you can tightly control the resources available to a Docker container, making it more secure and easier to ensure system stability.</p>
<p>To a first approximation, discussions about containers are discussions about Docker. There are other containers that exist, and some people use them for particular use cases. But for general purpose, if you’re using containers, they’re Docker conatiners.</p>
<p>The key word in that sentence is containerization. For most purposes these days, Docker and containers are synonymous since Docker was the first containerization platform to hit the mainstream, and is still by far the most popular.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>[Graphic: Docker on underlying host]</p>
<p>Let’s talk through a simple example to make this clearer.</p>
<p>In the <a href="#repro">reproducibility chapter</a>, you learned about the layers of reproducibility for an app. Docker takes care of everything at or above the operating system level. It doesn’t completely negate the need for other sorts of IT tooling, because you still have to provision the physical hardware somehow, but it does make everything much more self-contained.</p>
<p>You can think of containers in two different ways – as encapsulations of a development environment, or as a mobile encapsulation of an app that can be deployed. In fact, the same container can be this for different people. Assume for a second, you’re an IT/Admin responsibile for making JupyterHub available to your organization. You can pull and run the JupyterHub Docker image and have an initial installation of JupyterHub up and running in seconds. From the Data Scientist’s perspective, this is now a development environment for them.</p>
<pre><code>docker run --rm -p 8787:8787 -e PASSWORD=rs_pass rocker/rstudio</code></pre>
<p>The last few years have seen the rise of containerization as a strategy for managing applications in enterprise software deployments. The main benefit of containerization is it allows you to create a container that includes both an application you want to run, as well as all its dependencies.</p>
<section id="container-lifecycle" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="container-lifecycle"><span class="header-section-number">4.1.1</span> Container Lifecycle</h3>
<p>One of the hardest parts of understanding Docker is the language around how you are interacting with Docker and <em>what exactly it is</em> you’ve got.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I’m glossing over the many capabilities of Docker and the things you can do to discuss Docker in the way I generally find most useful to Data Scientists.</p>
</div>
</div>
<p><img src="images-docker/docker-lifecycle.jpeg" class="img-fluid"></p>
<p>A container starts its life as a Dockerfile. A Dockerfile is a set of instructions for how to build a container. For example, here’s the Dockerfile for the example above:</p>
<p>[TODO: DOCKERFILE + EXPLANATION]</p>
<p>Once you’ve got a working Dockerfile, you build it into an <em>image</em> – the image is an immutable point-in-time snapshot of the container. In general, the image is going to be the thing that you share with other people, as it’s the version of the container that’s compiled and ready to go.</p>
<p>Docker images can be shared directly like any other file, or via pushing and pulling to a Docker image registry. You can create and use private registries or the public Docker Hub. It’s worth noting that relativey few people actually run their own container registry. Many take advantge of cloud offerings for <em>container registries as a service</em> offerings. The big 3’s are Amazon’s Elastic Container Registry (ECR), Azure Container Registry, and Google Container Registry.</p>
<p>It is possible to interactively build a container as you go and create an image, but for the purposes of reproducibility, it’s generally preferable to build the image from a Dockerfile, and adjust the Dockerfile if you need to adjust the image.</p>
</section>
</section>
<section id="docker-for-the-data-scientist" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="docker-for-the-data-scientist"><span class="header-section-number">4.2</span> Docker for the Data Scientist</h2>
<p>If you’ve read this far into the chapter, you might be about ready to go put every project you’ve got into a docker container, ask your colleagues to do the same, and plan to share Shiny apps by making everyone download Docker Desktop and give them a <code>docker run</code> command.</p>
<p>Slow down.</p>
<p>Docker is a great solution for some problems, but it’s not a perfect fit for many of the issues data scientists face, and there are better tools for many of them. In particular, one pattern that feels appealing, but I would describe as an anti-pattern is the temptation to just take a Docker container, start installing packages, and then save the image. Even in some cases, you’ll see a Dockerfile that looks like</p>
<pre class="{...}"><code>install.packages("shiny")
install.packages("dplyr")
...</code></pre>
<p>Building a Dockerfile like this into an image provides a reasonable level of reproducibility, but it still is quite fragile if you ever find reason to rebuild this Dockerfile. For that reason, the best move is to combine the ability of R and Python-specific libraries for capturing package state – like <code>renv</code> and <code>virtualenv</code> with Docker’s ability to save the state of the underlying operating system and any system packages you’ve got.</p>
<p>There are a few particularities of Docker containers that can make operating inside them a little difficult. The first is the tradeoff of Docker’s strength – a container only gets access to the resources it has specifically been allowed to access. This is a great feature for security and process isolation, but it means you may run into some issues with networking and access to system resources, like your files.</p>
<p>You’ll have to develop a reasonably good mental model of the relationship of the Docker container to the rest of your machine in order to be able to develop effectively. For many data scientists, this isn’t a primary concern of theirs.</p>
<p>For that reason, it’s often preferable to skip Docker altogether and develop on a centralized server environment like RStudio Server or JupyterHub. Then, when it comes time to deploy apps, you can use a platform specifically for deploying data science content, like RStudio Connect, or build your app into a Docker container specifically for deployment.</p>
</section>
<section id="hands-on-with-docker" class="level2 page-columns page-full" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="hands-on-with-docker"><span class="header-section-number">4.3</span> Hands on with Docker</h2>
<p>In this section, we’re going to spend a few minutes learning how to get hands-on with Docker. This is not designed to be a full introduction to Docker, but just a quick overview of the commands you’ll probably need to know to get started. There are many great resources out there for <em>really</em> learning Docker. I’d suggest picking up one of them rather than relying on this book to learn everything you need to know about Docker.</p>
<p>There are at least three different cases where you might want to run Docker:</p>
<ol type="1">
<li>You are running a batch (non-interactive) job in R or Python. By packaging it up with all of its dependencies, you make it really easy to run quickly.</li>
<li>You are running a service – like an app or api – out of the container.</li>
<li>You are running a development environment like RStudio or JupyterHub out of the container and find the an easy way to control the environment.</li>
</ol>
<p>We’ll run through an example of how to do all 3, as they’ll help us build up an understanding of how to do everything we’d need to with Docker.</p>
<section id="getting-prepped" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="getting-prepped"><span class="header-section-number">4.3.1</span> Getting prepped</h3>
<p><a href="https://www.docker.com/products/docker-desktop">Install docker desktop</a>.</p>
<p>Know how to open a terminal</p>
</section>
<section id="running-an-app-from-docker" class="level3 page-columns page-full" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="running-an-app-from-docker"><span class="header-section-number">4.3.2</span> Running an app from Docker</h3>
<p>Running an interactive app or api is one of the most common use cases for Docker. In this case, we’re going to start there because it’s the simplest from a Docker perspective.</p>
<p>I’ve already created a container with Shiny Server and a running app in it, so all you’ve got to do is pull it down to run locally.</p>
<p>To run a Docker container, you just do <code>docker run &lt;image name&gt;</code>, however you’ll usually specify one or more options to the <code>docker run</code> command to make it work the way you want.</p>
<section id="port-publishing" class="level4 page-columns page-full" data-number="4.3.2.1">
<h4 data-number="4.3.2.1" class="anchored" data-anchor-id="port-publishing"><span class="header-section-number">4.3.2.1</span> Port Publishing</h4>
<p>In the case of a running app, we’ll want to “publish” the port where Shiny Server runs inside the container to the host so that you can actually get there in your browser. By default Shiny Server runs on port <code>3838</code>, and we’ll use that same port outside by adding a <code>-p 3838:3838</code> to our <code>docker run</code> command.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
How to read port mapping
</div>
</div>
<div class="callout-body-container callout-body">
<p>I always forget the order, so this is as much a note for me as it is for you!</p>
<p>In this command, we’re just mapping <code>3838</code> inside the container to <code>3838</code> on the host (your laptop). But sometimes, you’ll want to map to a different port, and then you have to remember the order.</p>
<p>The syntax is <code>&lt;host port&gt;:&lt;container port&gt;</code>. So if we did <code>8383:3838</code>, would make whatever is available at <code>3838</code> inside the container accessible at <code>8383</code> on your laptop at <code>http://localhost:8383</code>.</p>
<p>For more on ports, see <a href="../sec2/understanding-traffic.html#ports">the section</a></p>
</div>
</div>
<p>We’re also going to add a -<code>-rm</code> so the container cleans up nicely after itself.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>--rm</code> flag is something you’ll usually want if you’re just messing around – and you’ll probably never want in production. Cleanup after the container closes includes deleting any stored logs.</p>
<p>You’re definitely going to want those stored logs if you have a failure when you’re in production!</p>
</div>
</div>
<p>Ok, so let’s try it. Open a terminal and type</p>
<pre><code>docker run -rm -p 3838:3838 alexkgold/interactive</code></pre>
<div class="page-columns page-full"><p>If you’ve never run this before, Docker will pull down the container and launch it. <code>docker pull.</code> Now, go to <code>http://localhost:3838</code>, and you should see the Old Faithful shiny app.</p><div class="no-row-height column-margin column-container"><span class="aside">You can always explicitly pull a container with</span></div></div>
<p>&lt;TODO - change this app to be something more book-relevant&gt;</p>
<p>That’s great! Now let’s close it. Uh oh…unless you’re already pretty terminal-savvy, you’re stuck. You could close the terminal window, but you’re just locked watching logs. If you do need to get out, you can just send an interrupt to the terminal (<code>Ctrl + c</code>).</p>
</section>
<section id="detaching-a-container" class="level4 page-columns page-full" data-number="4.3.2.2">
<h4 data-number="4.3.2.2" class="anchored" data-anchor-id="detaching-a-container"><span class="header-section-number">4.3.2.2</span> Detaching a container</h4>
<p>Generally, when you’re running a process like this, you’ll want to run it in “detached” mode, so it doesn’t take over a terminal window. That’s quite easy just by adding a <code>-d</code> to your run command.</p>
<pre><code>docker run -d --rm -p 3838:3838 alexkgold/interactive</code></pre>
<p>Like before, we can go to <code>http://localhost:3838</code> to see the running Shiny app. Now when we go to close it down, we have a different problem…where did the app go?</p>
<p>We can find all of our running containers using the <code>docker ps</code> (short for <em>process status</em>) command. For me, that looks something like:</p>
<pre><code>$ docker ps                                                                       
CONTAINER ID   IMAGE                   COMMAND   CREATED         STATUS         PORTS                                       NAMES
d67d19d488b6   alexkgold/interactive   "/init"   6 seconds ago   Up 4 seconds   0.0.0.0:3838-&gt;3838/tcp, :::3838-&gt;3838/tcp   pedantic_williams</code></pre>
<p>This gives me all the information I need about the running container, including the image, how long it has existed, and any port mapping that I’m doing.</p>
<div class="page-columns page-full"><p>When it comes time to close the container, I can close it with the <code>docker kill</code> command. I can use either the id or the name. If you use the ID, Docker does automatic matching, so you usually only need the first 3-4 characters. In this case <code>docker kill d67</code> was sufficient. <code>docker kill my-shiny.</code></p><div class="no-row-height column-margin column-container"><span class="aside">You can also provide a name when you start the container with the <code>--name</code> flag. So if I added <code>--name my-shiny</code> when I started, I could kill the container with</span></div></div>
</section>
</section>
<section id="running-a-batch-job" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="running-a-batch-job"><span class="header-section-number">4.3.3</span> Running a batch job</h3>
<p>For this first task, let’s say we’ve got a Jupyter notebook that we know we’ll want to re-render in the future. For that purpose, it might be useful to bake it into a Docker container, so we can re-run it at will. This container is using <a href="https://quarto.org">Quarto</a> to render my Jupyter Notebook into an html document I could serve on a webpage or share with others.</p>
<p>&lt;TODO - change this book to be something more book-relevant, perhaps w/ input data, perhaps PDF&gt;</p>
<p>Before we go any further, let’s just try out running this job with</p>
<pre><code>docker run alexkgold/batch</code></pre>
<p>It may take a minute to download the container, as it’s over 600Mb. But once you’ve got it, it should take just a few seconds to run. Note that because there isn’t an ongoing running service, this container just shuts down when it has done its business.</p>
<p>But wait…where’d my document go?</p>
<p>Remember – containers are completely ephemeral. As they say (they do not) – <em>what happens in the container stays in the container</em>. This means that when my document is rendered inside the container, it gets deleted when the container ends its job.</p>
<p>But that’s not what I wanted – I wanted to get the output back out of the container.</p>
<section id="mounting-a-volume" class="level4" data-number="4.3.3.1">
<h4 data-number="4.3.3.1" class="anchored" data-anchor-id="mounting-a-volume"><span class="header-section-number">4.3.3.1</span> Mounting a volume</h4>
<p>The solution – making data outside the container available to the container and vice-versa – is accomplished by mounting a volume into the container. This an essential concept to understand when working with containers. Because containers are so ephemeral, volumes are the way to persist anything that you want to outlast the lifecycle of the container.</p>
<p>TODO - diagram of a volume</p>
<p>The way to think of this is that the file directories inside the container are completely independent from the file directories on the host. By mounting a volume, you can make a directory inside the container correspond to a volume outside the container.</p>
<p>This is accomplished with the <code>-v</code> flag on the <code>docker run</code> command. Like with mounting a port, the syntax is <code>-v &lt;directory outside container&gt;:&lt;directory inside container&gt;</code>.</p>
<p>This time, mount your current directory as <code>/project-out</code> inside the container.</p>
<pre><code>$ docker run -v $(pwd):/project-out alexkgold/batch</code></pre>
<p>This time, when the container finishes, you should see a file named <code>hello.html</code> in your working directory. If you right click it to open it in your browser, you should see a rendered Jupyter Notebook!</p>
</section>
</section>
<section id="using-dockerfiles" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="using-dockerfiles"><span class="header-section-number">4.3.4</span> Using Dockerfiles</h3>
<p>So far, we’ve just been working on running containers based on images I’ve already prepared for you. Let’s look at how those images got created so you can try building your own.</p>
<p>A Dockerfile is just a set of instructions that you use to build a Docker image. If you have a pretty good idea how to accomplish something on a running machine, you shouldn’t have too much trouble building a Dockerfile to do the same as long as you remember two things:</p>
<ol type="1">
<li>Docker containers only have access to exactly the resources you provide to them. That means that they won’t have access to libraries or programs unless you give them access, and you also won’t have access to files from your computer unless you make them available.</li>
<li>You have to keep in mind what you want to have happen at <em>build</em> time and how that’s different fro what should happen at <em>run</em> time. So, for example, I want to get all the pieces in place – my Python environment, the notebook, etc at build time – and then at run time I want the notebook to be rendered and output.</li>
</ol>
<p>There are many different commands you can use inside a Dockerfile, but with just 4, you’ll be able to build most images you might need.</p>
<ul>
<li><p><code>FROM</code> – every container starts from a base image. In some cases, like in my Jupyter example, you might start with a bare bones container that’s just the operating system (<code>ubuntu:20.04</code>). In other cases, like in my <code>shiny</code> example, you might start with a container that’s almost there, and all you need to do is to copy in a file or two.</p></li>
<li><p><code>RUN</code> – run any command as if you were sitting at the command line inside the container. Just remember, if you’re starting from a very basic container, you may need to make a command available before you can run it (like <code>wget</code> in my container below).</p></li>
<li><p><code>COPY</code> – copy a file from the host filesystem into the container. Note that the working directory for your Dockerfile will be whatever your working directory is when you run your build command.</p></li>
<li><p><code>CMD</code> - This is the command the Docker container will run when you run it with <code>docker run</code>. This is the thing you actually want to happen when you run your container.</p></li>
</ul>
<p>Now that you have that background, hopefully this Dockerfile makes some sense to you. If you don’t know what some of the individual commands are, consider googling them.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="cv">syntax=docker/dockerfile:1</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> ubuntu:20.04</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy external files</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">mkdir</span> <span class="at">-p</span> /project/out/</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> ./requirements.txt /project/</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> ./hello.ipynb /project/</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Install system packages</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> <span class="dt">\</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  wget python3 python3-pip</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Install quarto CLI + clean up</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">wget</span> https://github.com/quarto-dev/quarto-cli/releases/download/v0.9.83/quarto-0.9.83-linux-amd64.deb</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">dpkg</span> <span class="at">-i</span> ./quarto-0.9.83-linux-amd64.deb</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">rm</span> <span class="at">-f</span> ./quarto-0.9.83-linux-amd64.deb</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Python requirements</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip3</span> install <span class="at">-r</span> /project/requirements.txt</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Render notebook</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> <span class="bu">cd</span> /project <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="ex">quarto</span> render ./hello.ipynb <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Move output to correct directory</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Needed because quarto requires relative paths in --output-dir: </span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># https://github.com/quarto-dev/quarto-cli/issues/362</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  rm -rf /project-out/hello_files/ &amp;&amp; <span class="op">\</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  mkdir -p /project-out/hello_files &amp;&amp; <span class="op">\</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  mv ./hello_files/* /project-out/hello_files/ &amp;&amp; <span class="op">\</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  mv ./hello.html /project-out/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once you’ve created your Dockerfile, you build it into an image using <code>docker build -t &lt;image name&gt;</code> and then you can push that to DockerHub or another registry using <code>docker push</code>.</p>
</section>
<section id="docker-cheatsheet" class="level3" data-number="4.3.5">
<h3 data-number="4.3.5" class="anchored" data-anchor-id="docker-cheatsheet"><span class="header-section-number">4.3.5</span> Docker Cheatsheet</h3>
<p>WORK IN PROGRESS</p>
<section id="docker-commands" class="level4" data-number="4.3.5.1">
<h4 data-number="4.3.5.1" class="anchored" data-anchor-id="docker-commands"><span class="header-section-number">4.3.5.1</span> Docker Commands</h4>
<p><code>docker run</code></p>
<ul>
<li><p><code>-d</code> – run in “detached mode” – this is often a good idea, as it puts the docker container into the background of your terminal, so it doesn’t stay blocking anything else you’d want to do.</p></li>
<li><p><code>-p</code> – “publish” ports from inside the container to the host</p></li>
<li><p><code>-v</code> – mount a volume into the container</p></li>
<li><p><code>-n</code> – give your container a name</p></li>
</ul>
<p><code>docker ps</code> lists all of your running containers. Because a container can just run quietly in the background, it’s easy to lose track of them, and <code>docker ps</code> will give you the list. It’s also worth remarking that you don’t need to be a command-line hero – you can open the docker desktop dashboard to see these things.</p>
<p><code>docker exec -it &lt;container id&gt;</code></p>
<p><code>docker kill</code></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Cleaning up old containers
</div>
</div>
<div class="callout-body-container callout-body">
<p>Docker images can be quite large. If you’re doing a lot of different things on Docker, you may quickly find yourself using A LOT of storage space.</p>
<p>You can see all the images you’ve got downloaded with <code>docker ps -a</code> (<code>-a</code> is short for all) and you can delete them with <code>docker container rm &lt;container id&gt;</code>.</p>
<p>Don’t be precious about your images! You’re always just a <code>docker pull</code> away from getting them back.</p>
<p>If you want to delete <em>all</em> the images you’ve ever downloaded, you can do that with <code>docker container rm -f $(docker container ls -aq)</code>.</p>
</div>
</div>
</section>
</section>
</section>
<section id="exercises" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="exercises"><span class="header-section-number">4.4</span> Exercises</h2>
<ol type="1">
<li>Put a shiny app in a container, run it on your desktop.</li>
<li>Put that container into a container registry.</li>
<li>Use a local K8S distribution to run several instances of that container.</li>
<li>Redo the Jupyter example but instead of baking the notebook into the conatiner, provide the notebook at runtime.</li>
</ol>


</section>
<section class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1" role="doc-endnote"><p>As much as any esoteric code-development and deployment tool can be said to “hit the mainstream”.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/sec1/repro-pkgs.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Environments and Reproducibility</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/sec1/data.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Taking Data to Production</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2021, Alex K Gold</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/akgold/do4ds" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/alexkgold">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>