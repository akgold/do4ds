<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DevOps for Data Science - 2&nbsp; Environments as Code</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/sec1/1-3-data-arch.html" rel="next">
<link href="../../chapters/sec1/1-1-code-promotion.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BTSMMRMH08"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-BTSMMRMH08', { 'anonymize_ip': true});
</script>


</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/sec1/1-0-sec-intro.html">DevOps Lessons for Data Science</a></li><li class="breadcrumb-item"><a href="../../chapters/sec1/1-2-env-as-code.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Environments as Code</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">DevOps for Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/akgold/do4ds" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec1/1-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DevOps Lessons for Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-1-code-promotion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Code promotion and integration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-2-env-as-code.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Environments as Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-3-data-arch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Pipeline Architecture</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-4-apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Designing Your Application Layers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-5-monitor-log.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Logging and Monitoring</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec2/2-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IT/Admin Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-1-terminal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Terminal</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-2-ssh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Connecting Securely with SSH</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-3-cmd-line.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Getting comfortable on the Command Line</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-4-docker.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Demystifying Docker</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec3/3-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IT/Admin for Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-1-cloud.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Getting Started with the Cloud</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-2-linux-admin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Basic Linux SysAdmin</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-3-networking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Intro to Computer Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-4-dns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">DNS allows for human-readable addresses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-5-ssl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">You should use SSL/HTTPS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-6-servers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Choosing the right server for you</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec4/4-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making it Enterprise-Grade</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-1-os-ds-in-ent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Open Source Data Science in the Enterprise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-2-ent-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Enterprise Networking</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-3-auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Auth in Enterprise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-4-ent-servers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Enterprise Server Management</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Auth Technologies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/lab-map.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Lab Map</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#environments-have-layers" id="toc-environments-have-layers" class="nav-link active" data-scroll-target="#environments-have-layers"><span class="header-section-number">2.1</span> Environments have layers</a>
  <ul class="collapse">
  <li><a href="#package-environments-as-code" id="toc-package-environments-as-code" class="nav-link" data-scroll-target="#package-environments-as-code"><span class="header-section-number">2.1.1</span> Package environments as code</a></li>
  <li><a href="#step-1-standalone-package-libraries" id="toc-step-1-standalone-package-libraries" class="nav-link" data-scroll-target="#step-1-standalone-package-libraries"><span class="header-section-number">2.1.2</span> Step 1: Standalone Package Libraries</a></li>
  <li><a href="#step-2-document-environment-state." id="toc-step-2-document-environment-state." class="nav-link" data-scroll-target="#step-2-document-environment-state."><span class="header-section-number">2.1.3</span> Step 2: Document environment state.</a></li>
  <li><a href="#step-3-collaborate-or-deploy" id="toc-step-3-collaborate-or-deploy" class="nav-link" data-scroll-target="#step-3-collaborate-or-deploy"><span class="header-section-number">2.1.4</span> Step 3: Collaborate or Deploy</a></li>
  </ul></li>
  <li><a href="#reproducing-the-rest-of-the-stack" id="toc-reproducing-the-rest-of-the-stack" class="nav-link" data-scroll-target="#reproducing-the-rest-of-the-stack"><span class="header-section-number">2.2</span> Reproducing the rest of the stack</a>
  <ul class="collapse">
  <li><a href="#caution-on-docker" id="toc-caution-on-docker" class="nav-link" data-scroll-target="#caution-on-docker"><span class="header-section-number">2.2.1</span> Caution on Docker</a></li>
  </ul></li>
  <li><a href="#comprehension-questions" id="toc-comprehension-questions" class="nav-link" data-scroll-target="#comprehension-questions"><span class="header-section-number">2.3</span> Comprehension Questions</a></li>
  <li><a href="#lab2" id="toc-lab2" class="nav-link" data-scroll-target="#lab2"><span class="header-section-number">2.4</span> Lab 2: Use <code>{renv}</code> and <code>{venv}</code></a>
  <ul class="collapse">
  <li><a href="#using-renv-for-r" id="toc-using-renv-for-r" class="nav-link" data-scroll-target="#using-renv-for-r"><span class="header-section-number">2.4.1</span> Using <code>{renv}</code> for R</a></li>
  <li><a href="#using-venv-for-python" id="toc-using-venv-for-python" class="nav-link" data-scroll-target="#using-venv-for-python"><span class="header-section-number">2.4.2</span> Using <code>{venv}</code> for Python</a></li>
  </ul></li>
  <li><a href="#cheat-renv-venv" id="toc-cheat-renv-venv" class="nav-link" data-scroll-target="#cheat-renv-venv"><span class="header-section-number">2.5</span> Cheatsheet: Environments as Code</a>
  <ul class="collapse">
  <li><a href="#checking-library-repository-status" id="toc-checking-library-repository-status" class="nav-link" data-scroll-target="#checking-library-repository-status"><span class="header-section-number">2.5.1</span> Checking library + repository status</a></li>
  <li><a href="#creating-and-using-a-standalone-project-library" id="toc-creating-and-using-a-standalone-project-library" class="nav-link" data-scroll-target="#creating-and-using-a-standalone-project-library"><span class="header-section-number">2.5.2</span> Creating and Using a Standalone Project Library</a></li>
  <li><a href="#collaborating-on-someone-elses-project" id="toc-collaborating-on-someone-elses-project" class="nav-link" data-scroll-target="#collaborating-on-someone-elses-project"><span class="header-section-number">2.5.3</span> Collaborating on someone else’s project</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/akgold/do4ds/edit/main/chapters/sec1/1-2-env-as-code.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-env-as-code" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Environments as Code</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>TODO: add note on shared vs user vs project space</p>
<p>I like to think of doing data science much like producing a delicious meal. In my data, I have the raw ingredients I’ll slice, dice, and recombine to make something great, and my code is the recipe I’ll follow to get there.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Novice cooks generally think that their prep is done once they’ve gathered their ingredients and recipes. They’ll grab a tomato and chop/smush it with whatever dull butter knife happens to be at hand. But that’s not how the pros think. A pro probably has a knife just for tomatoes and they frequently – perhaps every time they use it – hone it to razor sharpness so they can slice paper-thin slices off even the mushiest tomato.</p>
<p><img src="images/environment.png" class="img-fluid" width="413"></p>
<p>Regardless of your proficiency in the kitchen, you’re a pro (or aiming to be one) at data science. In this chapter, we’re going to talk about the data science equivalent of prepping your knives in your kitchen – actively managing your data science environments using code.</p>
<p>Kitchen metaphors aside, your data science environment is the stack of software and hardware below the level of your code, from the R and Python packages you’re using right down to the physical hardware your code runs on.</p>
<p>Most data scientists are like novice cooks, and think little – or not at all – about the readiness of their environment and the sharpness of their tools. One of the primary results of this is the oft-spoken, and dreaded phrase, “well, it works on my machine” after attempting to share code with a colleague or deploy an app into a different environment.</p>
<p>Some people who read this will just throw up their hands and say, “well, it’s impossible to make things completely reproducible, so I’m not going to bother”. And they’re right about the first part. Trying to craft an environment that’s completely reproducible is somewhat of a fool’s errand.</p>
<p><img src="images-repro/repro-spectrum.png" class="img-fluid" width="429"></p>
<p>There’s a tradeoff. Making things more reproducible generally takes more work – in a way that’s frustratingly asymptotic.</p>
<p>Some industries are highly regulated and need to be able to guarantee that they can reproduce an analysis exactly – down to the layer of machine instructions – a decade later. In this world, the general reproducibility practice for an analysis is to take a physical piece of hardware that they know runs the analysis, make a backup or two, and just keep that physical piece of hardware running for many years.</p>
<p>But you don’t have to go all the way there. Making things 100% reproducible is really, really hard. But making things a little more reproducible is really quite easy.</p>
<p>The first step towards making environments more reproducible is to start to create Environments as Code. In the DevOps world, the aim is to create environments that are largely “stateless” – functionally identical copies of any environment can be created and destroyed at whim using code.</p>
<p>The glib-but-useful shorthand for the idea of Infrastucture or Environments as code is that they should be “cattle, not pets” – interchangeable one for the other.</p>
<p>In this chapter, we’ll get into the why and how of capturing data science environments in code, saving them for later, and easily moving them around from place to place.</p>
<section id="environments-have-layers" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="environments-have-layers"><span class="header-section-number">2.1</span> Environments have layers</h2>
<p>When you first start thinking about environments, it can be hard to wrap your head around them. The environment seems like a monolith, and it can be hard to figure out what the different components are.</p>
<p>I generally think of three layers in data science environments, and these are in order – each layer of the environment is actually built on the ones below. Once you understand the layers of an environment, you can think more clearly about what your actual reproducibility needs are, and which environmental layers you need to target putting into code.</p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Layer</th>
<th>Contents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Packages</td>
<td>R + Python Packages</td>
</tr>
<tr class="even">
<td>System</td>
<td><p>R + Python Language Versions</p>
<p>Other System Libraries</p>
<p>Operating System</p></td>
</tr>
<tr class="odd">
<td>Hardware</td>
<td><p>Virtual Hardware</p>
<p>Physical Hardware</p></td>
</tr>
</tbody>
</table>
<p>Note that your code and your data are not the environment – they are what the environment is for. As you’re thinking about reproducibility, I’d encourage you to think about how they fit inside the environment and how they might be reproduced.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> But we’re not going to address them in this book.</p>
<p>For most data scientists, the biggest bang for your buck is getting the package layer right. In a lot of organizations, another team entirely will be responsible for the system and hardware layers, but the package layer is always your responsibility as the data scientist. Moreover, managing that layer isn’t terribly hard, and if you get it right, you’ll solve a huge fraction of the “runs on my machine” issues you’re likely to encounter.</p>
<section id="package-environments-as-code" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="package-environments-as-code"><span class="header-section-number">2.1.1</span> Package environments as code</h3>
<p>A successful package Environment as Code setup has two key attributes:</p>
<ol type="1">
<li>Your package environment is isolated and cannot be disrupted by other activities on the same machine.</li>
<li>Your package environment can easily be captured and transported elsewhere.</li>
</ol>
<p>Before we get to what a good Environment as Code setup looks like, let’s dive into what bad setups look like.</p>
<p>In a lot of cases, data scientists have the habit of starting a project, and, when they need to install packages, they just run an <code>install.packages</code> command in their console or <code>pip install</code> in their terminal. This works fine for a while. But the problem with this is that the default has you installing things into a cache that’s shared among every project on your system.</p>
<p>What happens if you come back to a project after a year and you’ve been installing things into your machine-wide package cache the whole time. It’s very possible you won’t have the right versions and your code will break.</p>
<p>The other problem happens when it comes time to share a project with others. It’s not uncommon to see an intro to an R script that looks something like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1"><a href="#cb1-1"></a></span>
<span id="cb1-2"><a href="#cb1-2"></a># Check if dplyr installed</span>
<span id="cb1-3"><a href="#cb1-3"></a>if (!"dplyr" %in% row.names(installed.packages())) {</span>
<span id="cb1-4"><a href="#cb1-4"></a>  # install if not</span>
<span id="cb1-5"><a href="#cb1-5"></a>  install.packages("dplyr")</span>
<span id="cb1-6"><a href="#cb1-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ACK! Please don’t do this!</p>
<p>Number one, this is very rude. If someone runs your code, you’ll be installing packages willy-nilly into their system. Additionally, because this doesn’t specify a <em>version</em> of the <code>{dplyr}</code> package, it doesn’t even really fix the problem!</p>
</section>
<section id="step-1-standalone-package-libraries" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="step-1-standalone-package-libraries"><span class="header-section-number">2.1.2</span> Step 1: Standalone Package Libraries</h3>
<p>As a data scientist, you’re probably familiar with installing packages from a repository using the <code>install.packages</code> command in R or <code>pip install</code> or <code>conda install</code> in Python. But do you really understand what’s happening when you type that command?</p>
<p>Let’s first level-set on what the various states for R or Python packages are. There are three states packages can be in – and we’re going to go back to our data science as cooking analogy.</p>
<ol type="1">
<li>Packages can be stored in a repository, like CRAN or BioConductor in R or PyPI or Conda in Python. You can think of a package in a repository like food at the grocery store – it’s packaged up and ready to go, but inert. Setting aside groovy bodegas with eat-in areas, you don’t get to eat at the grocery store. You’ve got to buy the food and take it home before you can use it – and you’ve got to install the food before you can use it.</li>
<li>And then your library is your pantry, where you keep a private set of packages, bespoke to you and the food you like to cook – the projects you’re likely to do.</li>
<li>Loading a package with a <code>library</code> or <code>import</code> command is like taking the food out of the pantry and putting it on the counter so you can actually cook with it.</li>
</ol>
<p>[Diagram of package states]</p>
<p>By default, when you install an R or Python package, that package installs into user space. That means that it installs into a package library that is specific to your user, but is shared among every time that package is used by you on the machine.</p>
<p>This isn’t a disastrous situation, but it is a recipe for package incompatibilities down the road.</p>
<p>[TODO: diagram of user-level vs project-level installs]</p>
<p>The most important thing to understand about package libraries is that libraries can only have one version of any given package at a time. So that means that if I have code that relies on version 1.0 of a given package and I install a new version of that package, version 1.0 is gone and I am likely to run into package incompatibility issues.</p>
<p>It’s for this reason that you want to have standalone package libraries for each <em>project</em> on your system. Hopefully, you already have good practices around having each project in a standalone directory on your system and making a git repo in that system. Now just make the base directory of that directory a standalone library as well.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What if I have multiple content items?
</div>
</div>
<div class="callout-body-container callout-body">
<p>In many data science projects, you’ve got multiple content items within a single project. Maybe you have an ETL script and an API and an app. After a lot of experimenting, my recommendation is to create one git repo for the whole project and have content-level package libraries.</p>
<p>This is not a rule. It’s just a suggestion about how I’ve found it works best over time.</p>
<p>[TODO: Add image]</p>
</div>
</div>
<section id="whats-really-happening" class="level4" data-number="2.1.2.1">
<h4 data-number="2.1.2.1" class="anchored" data-anchor-id="whats-really-happening"><span class="header-section-number">2.1.2.1</span> What’s really happening?</h4>
<p>I happen to think the grocery store metaphor for package management is a useful one, but you might be wondering what the heck is <em>actually</em> happening when you’re using <code>{renv}</code> or <code>{venv}</code>. How does this package magic happen?</p>
<p>First, let’s quickly go over what happens when you install or load a package.</p>
<p>Whenever you install a package, there are two key settings that R or Python consult: the URL of the repository to install from, and the library to install to. Similarly, when you load an R or Python library, the install checks the library location. In R, the command used is <code>.libPaths()</code>, and in Python it’s <code>sys.path</code>.</p>
<p>So you can see that it’s (conceptually) pretty simple to create a standalone package library for any project – when the virtual environment is activated, just make sure that the project-level library is what comes back when checking the library path.</p>
<p>You can see it pretty easily in R. If I run <code>.libPaths()</code> before and after activating an <code>{renv}</code> environment, the first entry from the <code>.libPaths()</code> call changes from a user-level library <code>/Users/alexkgold</code> to a project-level library <code>/Users/alexkgold/Documents/do4ds/</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="sc">&gt;</span> <span class="fu">.libPaths</span>()</span>
<span id="cb2-2"><a href="#cb2-2"></a>[<span class="dv">1</span>] <span class="st">"/Users/alexkgold/Library/R/x86_64/4.2/library"</span>                 </span>
<span id="cb2-3"><a href="#cb2-3"></a>[<span class="dv">2</span>] <span class="st">"/Library/Frameworks/R.framework/Versions/4.2/Resources/library"</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>renv<span class="sc">::</span><span class="fu">activate</span>()</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="sc">*</span> Project <span class="st">'~/Documents/do4ds/docker/docker/plumber'</span> loaded. [renv <span class="dv">0</span>.<span class="fl">15.5</span>]</span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="fu">.libPaths</span>()</span>
<span id="cb2-7"><a href="#cb2-7"></a>[<span class="dv">1</span>] <span class="st">"/Users/alexkgold/Documents/do4ds/docker/docker/plumber/renv/library/R-4.2/x86_64-apple-darwin17.0"</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>[<span class="dv">2</span>] <span class="st">"/Library/Frameworks/R.framework/Versions/4.2/Resources/library"</span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Similarly, in Python it looks like this. Note that the “after” version replaces the last line of the <code>sys.path</code> with a project-level library:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="op">&gt;</span> python3 <span class="ex">-m</span> site                                       </span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="ex">sys.path</span> = [</span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="st">'/Users/alexkgold/Documents/python-examples/dash-app'</span><span class="ex">,</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="st">'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python38.zip'</span><span class="ex">,</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="st">'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8'</span><span class="ex">,</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="st">'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/lib-dynload'</span><span class="ex">,</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="st">'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/site-packages'</span><span class="ex">,</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="ex">]</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="ex">USER_BASE:</span> <span class="st">'/Users/alexkgold/Library/Python/3.8'</span> <span class="er">(</span><span class="ex">doesn</span><span class="st">'t exist)</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="st">USER_SITE: '</span><span class="ex">/Users/alexkgold/Library/Python/3.8/lib/python/site-packages</span><span class="st">' (doesn'</span><span class="ex">t</span> exist<span class="kw">)</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="ex">ENABLE_USER_SITE:</span> True</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="op">&gt;</span> source <span class="ex">.venv/bin/activate</span>                       </span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="kw">(</span><span class="ex">.venv</span><span class="kw">)</span></span>
<span id="cb3-15"><a href="#cb3-15"></a></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="op">&gt;</span> python3 <span class="ex">-m</span> site</span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="ex">sys.path</span> = [</span>
<span id="cb3-18"><a href="#cb3-18"></a>    <span class="st">'/Users/alexkgold/Documents/python-examples/dash-app'</span><span class="ex">,</span></span>
<span id="cb3-19"><a href="#cb3-19"></a>    <span class="st">'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python38.zip'</span><span class="ex">,</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>    <span class="st">'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8'</span><span class="ex">,</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>    <span class="st">'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/lib-dynload'</span><span class="ex">,</span></span>
<span id="cb3-22"><a href="#cb3-22"></a>    <span class="st">'/Users/alexkgold/Documents/python-examples/dash-app/.venv/lib/python3.8/site-packages'</span><span class="ex">,</span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="ex">]</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="ex">USER_BASE:</span> <span class="st">'/Users/alexkgold/Library/Python/3.8'</span> <span class="er">(</span><span class="ex">doesn</span><span class="st">'t exist)</span></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="st">USER_SITE: '</span><span class="ex">/Users/alexkgold/Library/Python/3.8/lib/python/site-packages</span><span class="st">' (doesn'</span><span class="ex">t</span> exist<span class="kw">)</span></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="ex">ENABLE_USER_SITE:</span> False</span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="kw">(</span><span class="ex">.venv</span><span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="step-2-document-environment-state." class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="step-2-document-environment-state."><span class="header-section-number">2.1.3</span> Step 2: Document environment state.</h3>
<p>Using standalone package libraries for each project ensures that your projects remain undisturbed when you come back to them months or years later and keeps your work reproducible.</p>
<p>But it doesn’t solve the sharing problem.</p>
<p>That is, you still need some help when it comes time to share an environment with someone else. So how does that work?</p>
<p>[TODO: image – anatomy of a lockfile]</p>
<p>Both R and Python have great utilities that make it easy to capture the current state of a library into a <code>lockfile</code> or <code>requirements.txt</code> and to restore those libraries at a later date or somewhere else.</p>
<p>In R, <code>{renv}</code> is the standard on this front. In Python, there are many different options. In the context of production data science, I recommend <code>{virtualenv}/{venv}</code> and related tools.</p>
<p>Now, when you share your project with someone else, your <code>lockfile</code> or <code>requirements.txt</code> goes along for the ride. Sometimes people are dismayed that their library doesn’t go along as well and that people have to install the packages themselves – but this is by design!</p>
<p>First, the actual package libraries can be very large, so putting just a short lockfile or requirements file into git is definitely preferred. The other reason is that the actual package install can differ from system to system. For example, if you’re working on a Windows laptop and your colleague is on a Mac, an install of <code>{dplyr}</code> 1.0 means that different files are installed – but with exactly the same functionality. You want to respect this, so instead of sending the whole library along for the ride, you just send the specification that <code>dplyr 1.0</code> is needed.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A sidebar on Conda
</div>
</div>
<div class="callout-body-container callout-body">
<p>Many data scientists love Conda for managing their Python environments.</p>
<p>Conda is a great tool for its main purpose – allowing you to create a data science environment on your local laptop, especially when you don’t have root access to your laptop because it’s a work machine that’s locked down by the admins.</p>
<p>In the context of a production environment, Conda smashes together the language version, the package management, and (sometimes) the system library management. This has the benefit of being conceptually simple and easy-to-use. But I’ve often seen it go awry in production environments, and I generally recommend people use a tool that’s just for package management, like <code>{venv}</code>, as opposed to an all-in-one tool like Conda.</p>
</div>
</div>
<p>On a high level, the workflows for these tasks are similar between R and Python. However, there are some meaningful differences in tooling – especially because many computers arrive with a system version of Python installed, while R is only ever installed by a user trying to do data science tasks.</p>
<p>At the end of the day, this actually makes it <em>harder</em> to use Python because you do not want to use your system Python for your data science work…but sometimes it accidentally gets into the mix.</p>
</section>
<section id="step-3-collaborate-or-deploy" class="level3" data-number="2.1.4">
<h3 data-number="2.1.4" class="anchored" data-anchor-id="step-3-collaborate-or-deploy"><span class="header-section-number">2.1.4</span> Step 3: Collaborate or Deploy</h3>
<p>The nice thing about these tools is that they make collaboration easy. One big problem people run into is that they plan to share their package library with collaborators. Don’t do this!</p>
<p>There are two reasons – first, sharing a library is a bad idea because it can change under people with no warning, leaving them confused about why things are breaking. If you’re potentially working on a different operating system from your collaborators, this won’t even work in the first place. And if you’re trying to deploy - probably on a Linux server – and you’re developing on your Windows or Mac laptop, it’s not going to work at all.</p>
<p>The other reason is that this collaboration works really nicely over git. Putting large files – like an entire package library – into git is generally a bad idea. In most cases, you’ll want to gitignore the library itself and instead just share the lockfile.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sharing package caches
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’re on a shared server, you may want to share a package cache across users. This generally isn’t necessary, but can save some space on the server. Both <code>{renv}</code> and <code>venv</code> include settings to allow you to relocate the package cache to a shared location on the server. You’ll need to make sure that all the relevant users have read and write privileges to this location.</p>
</div>
</div>
<p>If you are collaborating, both Python and R have one-line commands for restoring a library from a lockfile. In R, you should make sure to set your working directory to the project directory – or open the project in RStudio – and run <code>renv::restore()</code>.</p>
<p>In Python, you’ll want to make sure you activate your project-level virtual environment using <code>venv source ./venv/bin/activate</code> and then install from a requirements file using <code>pip install -r requirements.txt</code>.</p>
</section>
</section>
<section id="reproducing-the-rest-of-the-stack" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="reproducing-the-rest-of-the-stack"><span class="header-section-number">2.2</span> Reproducing the rest of the stack</h2>
<p>Sometimes, just recording the package environment and moving that around is sufficient. In many cases, old versions of R and Python are retained in the environment, and that’s sufficient.</p>
<p>There are times where you need to reproduce elements further down the stack. In some highly-regulated industries, you’ll need to go further down the stack because of requirements for numeric reproducibility. Numeric routines in both R and Python call on system-level libraries, often written in C++ for speed. While it’s unlikely that upgrades to these libraries would cause changes to the numeric results you get, it can happen, and it may be worth maintaining parts of the stack.</p>
<p>In other cases, your R or Python library might basically just be a wrapper for system libraries. For example, many popular packages for geospatial analysis are just thin language wrappers that call out to the system libraries. In this case, it might be important to be able to maintain a particular version of the underlying system library to ensure that your code runs at all in the future.</p>
<p>There are many tools you can use to record and reproduce the R and Python versions you’re using, the system libraries, and the operating system itself.</p>
<p>These days, the clear leader of the pack on this front is Docker. Since its introduction in 2013, it has become an increasingly popular way to create, maintain, and use standalone environments – and for good reason!</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/docker-usage.png" class="img-fluid figure-img" width="408"></p>
</figure>
</div>
<p>In most cases, the only requirement to run any Docker container is having Docker installed. If you put your project in a Docker container and it runs today, you can be reasonably confident that the container itself can run almost anywhere else, irrespective of what else is running on that machine.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p>In <a href="../sec2/2-4-docker.html">Chapter&nbsp;<span>9</span></a>, you’ll learn the basics of how to use Docker as a tool for reproducing a data science project and moving it around.</p>
<section id="caution-on-docker" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="caution-on-docker"><span class="header-section-number">2.2.1</span> Caution on Docker</h3>
<p>Like so many of the tools in this book, Docker was developed by Software Engineers to solve software engineering problems, and fitting Docker into a data science workflow has a bit of a square-peg round-hole kind of feeling.</p>
<p>Once a Docker container is built, it’s amazing to run over and over in nearly any environment. But if you ever have to rebuild the container, you still need R and Python specific tooling like <code>{renv}</code> and <code>{venv}</code>.</p>
<p>The biggest strength of Docker is also its greatest weakness as a data science tool. Docker containers are highly ephemeral and highly isolated. That means that whatever happens in a Docker container stays in a Docker container.</p>
<p>This is great if you’re running a production service that has many instances of the same app and security and stability are your main concerns. As a Data Scientist, working inside a Docker container can be an exercise in frustration, as anything you want inside the container from outside has to explicitly be passed in, and anything from the inside you want to get out has to do the same. Working well with Docker requires a very good mental model of the container and how it relates to the rest of the system. Most data scientists would do better not to develop this expertise.</p>
<p>Instead, Docker <em>can</em> be an extremely valuable tool for reproducibility and for moving things into production.</p>
</section>
</section>
<section id="comprehension-questions" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="comprehension-questions"><span class="header-section-number">2.3</span> Comprehension Questions</h2>
<ol type="1">
<li>Why does difficulty increase as the level of required reproducibility increase for a data science project. In your day-to-day work, what’s the hardest reproducibility challenge?</li>
<li>Draw a mental map of the relationships between the 7 levels of the reproducibility stack. Pay particular attention to <em>why</em> the higher layers depend on the lower ones.</li>
<li>What are the two key attributes of environments as code? Why do you need both of them? Are there cases where you might only care about one?</li>
<li>Draw a mental map of the relationships between the following: package repository, package library, package, project-level-library, <code>.libPaths()</code> (R) or <code>sys.path</code>(python), lockfile</li>
<li>Why is it a bad idea to share package libraries? What’s the best way to collaborate with a colleague using an environment as code? What are the commands you’ll run in R or Python to save a package environment and restore it later?</li>
</ol>
</section>
<section id="lab2" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="lab2"><span class="header-section-number">2.4</span> Lab 2: Use <code>{renv}</code> and <code>{venv}</code></h2>
<p>In this lab, we’re going to add some pages to the website from <a href="@lab1">Lab 1</a> that use R and Python. The real point of this lab is to get your comfortable using <code>{renv}</code> and <code>{venv}</code> to create and use virtual environments and to understand how to restore those environments in CI/CD to render documents there.</p>
<p>I’m going to do some simple exploratory data analysis and create a model from the <a href="https://allisonhorst.github.io/palmerpenguins/">Palmer Penguins</a> dataset, which is available as a package in both R and Python. In order to get to practice with both R and Python, I’m going to do the EDA page in R and the modeling in Python.</p>
<p>You’ll start off by adding a new page to the Quarto project and checking it out locally with <code>quarto preview</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Don’t forget to add the page to your <code>_quarto.yml</code> or it won’t render.</p>
</div>
</div>
<p>Once you’ve done that, you’ll probably be tempted to push that right up to GitHub, but it’s worth remembering that CI/CD doesn’t work like that. The CI/CD environment is blank, so you’ve got to add R or Python as well as the packages your content needs.</p>
<p>So once you’ve got everything looking good locally, you’ll do the following in both R and Python:</p>
<ol type="1">
<li>Freeze the package requirements locally into a lockfile/requirements file.</li>
<li>Add a workflow to set up the language and install frozen packages into <code>.github/workflows/publish.yml</code>.</li>
<li>Add the lockfile/requirements to git and push to main.</li>
<li>Wait for the action to complete and admire your new website page!</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Freezing Quarto Computations
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you read the Quarto documents, they recommend freezing your computations. This is very useful if you want to render your R or Python code locally and only render the markdown elsewhere.</p>
<p>Because the main point here is to learn about getting environments as code working in CI/CD you <em>should not</em> freeze your environment.</p>
</div>
</div>
<section id="using-renv-for-r" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="using-renv-for-r"><span class="header-section-number">2.4.1</span> Using <code>{renv}</code> for R</h3>
<p>Let’s add a simple R-language EDA of the Palmer Penguins data set to our website.</p>
<p>I’d recommend doing this in RStudio. You absolutely can do it elsewhere, but RStudio includes many built-in conveniences for working with both Quarto and <code>{renv}</code>.</p>
<p>I’ve created a page in the repo called <code>eda.qmd</code> with the following contents.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>eda.qmd</strong></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">---</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="an">title:</span><span class="co"> "Penguins EDA"</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="an">format:</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">  html:</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">    code-fold: true</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">---</span></span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="fu">## Penguin Size and Mass by Sex and Species</span></span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="in">```{r}</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-14"><a href="#cb4-14"></a></span>
<span id="cb4-15"><a href="#cb4-15"></a>df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="in">```</span></span>
<span id="cb4-17"><a href="#cb4-17"></a></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="in">```{r}</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb4-20"><a href="#cb4-20"></a>  <span class="fu">group_by</span>(species, sex) <span class="sc">%&gt;%</span></span>
<span id="cb4-21"><a href="#cb4-21"></a>  <span class="fu">summarise</span>(</span>
<span id="cb4-22"><a href="#cb4-22"></a>    <span class="fu">across</span>(</span>
<span id="cb4-23"><a href="#cb4-23"></a>      <span class="fu">where</span>(is.numeric), </span>
<span id="cb4-24"><a href="#cb4-24"></a>      \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-25"><a href="#cb4-25"></a>      )</span>
<span id="cb4-26"><a href="#cb4-26"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb4-27"><a href="#cb4-27"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb4-28"><a href="#cb4-28"></a><span class="in">```</span></span>
<span id="cb4-29"><a href="#cb4-29"></a></span>
<span id="cb4-30"><a href="#cb4-30"></a><span class="fu">## Penguin Size vs Mass by Species</span></span>
<span id="cb4-31"><a href="#cb4-31"></a></span>
<span id="cb4-32"><a href="#cb4-32"></a><span class="in">```{r}</span></span>
<span id="cb4-33"><a href="#cb4-33"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb4-34"><a href="#cb4-34"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bill_length_mm, <span class="at">y =</span> body_mass_g, <span class="at">color =</span> species)) <span class="sc">+</span></span>
<span id="cb4-35"><a href="#cb4-35"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb4-36"><a href="#cb4-36"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb4-37"><a href="#cb4-37"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Feel free to copy this Quarto doc right into your website, or to write your own. But before you go installing R packages, make sure you’ve created an <code>{renv}</code> environment with <code>renv::init()</code>.</p>
<p>Once you’ve finished writing your EDA script and checked that it renders nicely into the website, save the doc, and create your lockfile with <code>renv::snapshot()</code>.</p>
<p>Add the commands to install R, <code>{renv}</code>, and the packages for your content to the GitHub Actions workflow.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.github/workflows/publish.yml</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-startfrom="20"><pre class="sourceCode numberSource yml number-lines code-with-copy"><code class="sourceCode yaml" style="counter-reset: source-line 19;"><span id="cb5-20"><a href="#cb5-20"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install R</span></span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-r@v2</span></span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb5-23"><a href="#cb5-23"></a><span class="at">          </span><span class="fu">r-version</span><span class="kw">:</span><span class="at"> </span><span class="st">'4.2.0'</span></span>
<span id="cb5-24"><a href="#cb5-24"></a><span class="at">          </span><span class="fu">use-public-rspm</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb5-25"><a href="#cb5-25"></a></span>
<span id="cb5-26"><a href="#cb5-26"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Setup renv and install packages</span></span>
<span id="cb5-27"><a href="#cb5-27"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-renv@v2</span></span>
<span id="cb5-28"><a href="#cb5-28"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb5-29"><a href="#cb5-29"></a><span class="at">          </span><span class="fu">cache-version</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb5-30"><a href="#cb5-30"></a><span class="at">        </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb5-31"><a href="#cb5-31"></a><span class="at">          </span><span class="fu">RENV_CONFIG_REPOS_OVERRIDE</span><span class="kw">:</span><span class="at"> https://packagemanager.rstudio.com/all/latest</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One important thing to note is the repos override. This is because I’d like <code>{renv}</code> to install packages from binaries because it’s much faster. But my CI/CD environment is using Ubuntu, not whatever I’m using on my desktop. So I’ve got to let <code>{renv}</code> in GitHub Actions know to use public Posit Package Manager for my current operating system. This is the reason why you want to ship the <em>lockfile</em> but never the actual packages.</p>
<p>Now, if you push your website including the lockfile and the updated GitHub workflow, your site should render flawlessly.</p>
</section>
<section id="using-venv-for-python" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="using-venv-for-python"><span class="header-section-number">2.4.2</span> Using <code>{venv}</code> for Python</h3>
<p>Now let’s add a page documenting how we build a little <code>{scikit-learn}</code> model for predicting penguin weight in a Python notebook. I’m just going to base the predictions on its species and bill length.</p>
<p>Here’s the code for the Quarto doc I created.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>model.qmd</strong></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource yml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1"></a><span class="pp">---</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Model"</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="at">  </span><span class="fu">html</span><span class="kw">:</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="at">    </span><span class="fu">code-fold</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="pp">---</span></span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="at">```{python}</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="at">from palmerpenguins import penguins</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="at">from pandas import get_dummies</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="at">import numpy as np</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="at">from sklearn.linear_model import LinearRegression</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="at">from sklearn import preprocessing</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="at">```</span></span>
<span id="cb6-15"><a href="#cb6-15"></a></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">## Get Data</span></span>
<span id="cb6-17"><a href="#cb6-17"></a></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="at">```{python}</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="at">df = penguins.load_penguins().dropna()</span></span>
<span id="cb6-20"><a href="#cb6-20"></a></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="at">df.head(3)</span></span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="at">```</span></span>
<span id="cb6-23"><a href="#cb6-23"></a></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="co">## Define Model and Fit</span></span>
<span id="cb6-25"><a href="#cb6-25"></a></span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="at">```{python}</span></span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="at">X = get_dummies(df[['bill_length_mm', 'species', 'sex']], drop_first = True)</span></span>
<span id="cb6-28"><a href="#cb6-28"></a><span class="at">y = df['body_mass_g']</span></span>
<span id="cb6-29"><a href="#cb6-29"></a></span>
<span id="cb6-30"><a href="#cb6-30"></a><span class="at">model = LinearRegression().fit(X, y)</span></span>
<span id="cb6-31"><a href="#cb6-31"></a><span class="at">```</span></span>
<span id="cb6-32"><a href="#cb6-32"></a></span>
<span id="cb6-33"><a href="#cb6-33"></a><span class="co">## Get some information</span></span>
<span id="cb6-34"><a href="#cb6-34"></a></span>
<span id="cb6-35"><a href="#cb6-35"></a><span class="at">```{python}</span></span>
<span id="cb6-36"><a href="#cb6-36"></a><span class="at">print(f"R^2 {model.score(X,y)}")</span></span>
<span id="cb6-37"><a href="#cb6-37"></a><span class="at">print(f"Intercept {model.intercept_}")</span></span>
<span id="cb6-38"><a href="#cb6-38"></a><span class="at">print(f"Columns {X.columns}")</span></span>
<span id="cb6-39"><a href="#cb6-39"></a><span class="at">print(f"Coefficients {model.coef_}")</span></span>
<span id="cb6-40"><a href="#cb6-40"></a><span class="at">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again, you’ll want to create your virtual environment and make sure to activate it before you start <code>pip install</code>-ing packages into the environment.</p>
<p>Once this is working right, you’ll capture your dependencies in a <code>requirements.txt</code> using <code>pip freeze &gt; requirements.txt</code> on the command line.</p>
<p>Then you add a workflow to GitHub Actions to install Python and the necessary Python packages from the <code>requirements.txt</code>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.github/workflows/publish.yml</strong></pre>
</div>
<div class="sourceCode" id="cb7" data-startfrom="33"><pre class="sourceCode numberSource yml number-lines code-with-copy"><code class="sourceCode yaml" style="counter-reset: source-line 32;"><span id="cb7-33"><a href="#cb7-33"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install Python and Dependencies</span></span>
<span id="cb7-34"><a href="#cb7-34"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-python@v4</span></span>
<span id="cb7-35"><a href="#cb7-35"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb7-36"><a href="#cb7-36"></a><span class="at">          </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="st">'3.10'</span></span>
<span id="cb7-37"><a href="#cb7-37"></a><span class="at">          </span><span class="fu">cache</span><span class="kw">:</span><span class="at"> </span><span class="st">'pip'</span></span>
<span id="cb7-38"><a href="#cb7-38"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> pip install jupyter</span></span>
<span id="cb7-39"><a href="#cb7-39"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> pip install -r requirements.txt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that in this case, we run the Python environment restore commands with <code>run</code> rather than <code>uses</code>. Where <code>uses</code> takes an existing GitHub Action and runs it, <code>run</code> just runs the code included there in the terminal.</p>
<p>With your <code>requirements.txt</code> and your workflow, pushing to GitHub should give you a beautiful Quarto webpage with tabs for an EDA page and a Model page.</p>
</section>
</section>
<section id="cheat-renv-venv" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="cheat-renv-venv"><span class="header-section-number">2.5</span> Cheatsheet: Environments as Code</h2>
<section id="checking-library-repository-status" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="checking-library-repository-status"><span class="header-section-number">2.5.1</span> Checking library + repository status</h3>
<table class="table">
<colgroup>
<col style="width: 19%">
<col style="width: 19%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>R Command</th>
<th>Python Command</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Check whether library in sync with lockfile.</td>
<td><code>renv ::status()</code></td>
<td>None</td>
</tr>
</tbody>
</table>
</section>
<section id="creating-and-using-a-standalone-project-library" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="creating-and-using-a-standalone-project-library"><span class="header-section-number">2.5.2</span> Creating and Using a Standalone Project Library</h3>
<p>Make sure you’re in a standalone project library.</p>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 39%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>R Command</th>
<th>Python Command</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Make sure you’ve got <code>{renv}/{venv}</code>.</td>
<td><code>install.packages("renv")</code></td>
<td>Included w/ Python 3.5+</td>
</tr>
<tr class="even">
<td>Create a standalone library.</td>
<td><code>renv::init()</code></td>
<td><p><code>python -m venv &lt;dir&gt;</code></p>
<p>Convention: <code>use .venv for &lt;dir&gt;</code></p></td>
</tr>
<tr class="odd">
<td>Activate project library.</td>
<td><p><code>renv::activate()</code></p>
<p>Happens automatically if using projects.</p></td>
<td><code>source &lt;dir&gt; /bin/activate</code></td>
</tr>
<tr class="even">
<td>Install packages as normal.</td>
<td><code>install.packages("&lt;pkg&gt;")</code></td>
<td><code>python -m pip install &lt;pkg&gt;</code></td>
</tr>
<tr class="odd">
<td>Snapshot package state.</td>
<td><code>renv::snapshot()</code></td>
<td><code>pip freeze &gt; requirements.txt</code></td>
</tr>
<tr class="even">
<td>Exit project environment.</td>
<td>Leave R project.</td>
<td><code>deactivate</code></td>
</tr>
</tbody>
</table>
</section>
<section id="collaborating-on-someone-elses-project" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="collaborating-on-someone-elses-project"><span class="header-section-number">2.5.3</span> Collaborating on someone else’s project</h3>
<p>Start by downloading the project into a directory on your machine.</p>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 35%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>R Command</th>
<th>Python Command</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Move into project directory.</td>
<td><p><code>setwd("&lt;project-dir&gt;")</code></p>
<p>Or just open R project in RStudio.</p></td>
<td><code>cd &lt;project-dir&gt;</code></td>
</tr>
<tr class="even">
<td>Create project environment.</td>
<td><code>renv::init()</code></td>
<td><p><code>python -m venv &lt;dir&gt;</code></p>
<p>Recommend: <code>use .venv for &lt;dir&gt;</code></p></td>
</tr>
<tr class="odd">
<td>Enter project environment.</td>
<td>Happens automatically or <code>renv::activate()</code></td>
<td><code>source &lt;dir&gt; /bin/activate</code></td>
</tr>
<tr class="even">
<td>Restore packages.</td>
<td>Happens automatically or <code>renv::restore()</code></td>
<td><code>pip install -r requirements.txt</code></td>
</tr>
</tbody>
</table>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Credit for this analogy goes to my former colleague Sean Lopp – a fount of excellent analogies and overall wonderful co-worker.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>If you’re an R user, I’d especially recommend <a href="https://rstats.wtf/">What they forgot to teach you about R</a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Usually. Users of Apple’s M1 and M2 chips have run into many issues running containers due to differences in hardware architecture.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/sec1/1-1-code-promotion.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Code promotion and integration</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/sec1/1-3-data-arch.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Pipeline Architecture</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, Alex K Gold</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/akgold/do4ds" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/alexkgold">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>