<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DevOps for Data Science - 2&nbsp; Code deployment and promotion</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/sec1/1-3-data-arch.html" rel="next">
<link href="../../chapters/sec1/1-1-env-as-code.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BTSMMRMH08"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-BTSMMRMH08', { 'anonymize_ip': true});
</script>


</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/sec1/1-0-sec-intro.html">DevOps Lessons for Data Science</a></li><li class="breadcrumb-item"><a href="../../chapters/sec1/1-2-code-promotion.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Code deployment and promotion</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">DevOps for Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/akgold/do4ds" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec1/1-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DevOps Lessons for Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-1-env-as-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Environments as Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-2-code-promotion.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Code deployment and promotion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-3-data-arch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Pipeline Architecture</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-4-apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Designing Your Application Layers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-5-monitor-log.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Logging and Monitoring</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec2/2-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IT/Admin Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-1-terminal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Terminal</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-2-ssh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Connecting Securely with SSH</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-3-cmd-line.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Getting comfortable on the Command Line</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-4-docker.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Demystifying Docker</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec3/3-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IT/Admin for Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-1-cloud.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Getting Started with the Cloud</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-2-linux-admin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Basic Linux SysAdmin</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-3-networking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Intro to Computer Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-4-dns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">DNS allows for human-readable addresses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-5-ssl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">You should use SSL/HTTPS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-6-servers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Choosing the right server for you</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec4/4-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making it Enterprise-Grade</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-1-os-ds-in-ent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Open Source Data Science in the Enterprise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-2-ent-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Enterprise Networking</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-3-auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Auth in Enterprise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-4-ent-servers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Enterprise Server Management</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Auth Technologies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/lab-map.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Lab Map</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#you-need-a-prod" id="toc-you-need-a-prod" class="nav-link active" data-scroll-target="#you-need-a-prod"><span class="header-section-number">2.1</span> You need a prod</a></li>
  <li><a href="#dev-and-test-environments" id="toc-dev-and-test-environments" class="nav-link" data-scroll-target="#dev-and-test-environments"><span class="header-section-number">2.2</span> Dev and test environments</a></li>
  <li><a href="#sec-env-vars" id="toc-sec-env-vars" class="nav-link" data-scroll-target="#sec-env-vars"><span class="header-section-number">2.3</span> Environment Variables</a>
  <ul class="collapse">
  <li><a href="#secrets-management" id="toc-secrets-management" class="nav-link" data-scroll-target="#secrets-management"><span class="header-section-number">2.3.1</span> Secrets management</a></li>
  <li><a href="#per-environment-behavior" id="toc-per-environment-behavior" class="nav-link" data-scroll-target="#per-environment-behavior"><span class="header-section-number">2.3.2</span> Per environment behavior</a></li>
  </ul></li>
  <li><a href="#automated-promotion" id="toc-automated-promotion" class="nav-link" data-scroll-target="#automated-promotion"><span class="header-section-number">2.4</span> Automated Promotion</a>
  <ul class="collapse">
  <li><a href="#a-rough-intro-to-git" id="toc-a-rough-intro-to-git" class="nav-link" data-scroll-target="#a-rough-intro-to-git"><span class="header-section-number">2.4.1</span> A Rough Intro to Git</a></li>
  </ul></li>
  <li><a href="#comprehension-questions" id="toc-comprehension-questions" class="nav-link" data-scroll-target="#comprehension-questions"><span class="header-section-number">2.5</span> Comprehension Questions</a></li>
  <li><a href="#lab2" id="toc-lab2" class="nav-link" data-scroll-target="#lab2"><span class="header-section-number">2.6</span> Lab 2: Host a website with automatic updates</a></li>
  <li><a href="#cheat-git" id="toc-cheat-git" class="nav-link" data-scroll-target="#cheat-git"><span class="header-section-number">2.7</span> Cheatsheet: Git</a>
  <ul class="collapse">
  <li><a href="#freezing-quarto-computations" id="toc-freezing-quarto-computations" class="nav-link" data-scroll-target="#freezing-quarto-computations"><span class="header-section-number">2.7.1</span> Freezing Quarto Computations</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">2.7.2</span> </a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/akgold/do4ds/edit/main/chapters/sec1/1-2-code-promotion.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-code-promotion" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Code deployment and promotion</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The most dangerous parts of a flight are when you’re closest to the ground. Things can go wrong at altitude, but there’s a lot more leeway with 35,000 feet of air below than 50.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>It’s the same with software. Properly tested software tends to continue running smoothly. It’s getting it up that gets you.</p>
<p>That’s why <em>deployment</em> is one of the primary concerns of DevOps best practices.</p>
<p>Deployment is the process of taking code that isn’t in production and putting it there – for both new code and upgrades. That moment when your Shiny app goes live or you run your report or job for real for the first time or when you add a new feature to your model – that’s the result of a deployment.</p>
<p>DevOps has a lot to say about deployments. In particular, DevOps suggests a framework called <em>Continuous Integration and Continuous Deployment (CI/CD)</em>. The idea of CI/CD is to create a deployment process that is low friction so deployments can be incremental, frequent, and low drama.</p>
<p>A CI/CD process has three major components:</p>
<ol type="1">
<li>Separate production and non-production environments.</li>
<li>An explicit code deployment process.</li>
<li>Automation that executes the deployment.</li>
</ol>
<p>In this chapter, I hope to convince you that you need to create a code promotion workflow, help you understand how a data science promotion workflow is different from a general purpose software one, and illuminate tooling you can use to build your own promotion workflows.</p>
<section id="you-need-a-prod" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="you-need-a-prod"><span class="header-section-number">2.1</span> You need a prod</h2>
<p>One of the primary risks to production code is that a deployment could happen accidentally. To mitigate that risk, you need to separate the production environment and create a process to promote things into prod.</p>
<p><img src="images/dev-test-prod.png" class="img-fluid" alt="An app moving through dev, test, and prod environments."></p>
<p>Here are some guidelines that, if followed, will result in a very stable prod environment:</p>
<ol type="1">
<li><p>Test looks a lot like prod. In fact, it’s best if it’s identical. You can be very confident that your code will work in prod if it works in a nearly identical test environment.</p></li>
<li><p>No manual changes in prod. If something breaks, you don’t get to make any changes until you can re-create the issue in a lower environment. Break this rule, and you’ll quickly find your environment drifting and attribute 1 goes out the window.</p></li>
<li><p>Changes and fixes get pushed via a promotion process, preferable automated. No making changes directly in prod that haven’t been thoroughly tested in a lower environment. This rule is very tempting to break.</p></li>
<li><p>Only certain people can promote code into prod. The approval process is well-defined and consistently followed.</p></li>
</ol>
<p>Now, not every prod environment need follow <em>all</em> these guidelines. It’s up to you and your team to decide how to balance making it easy to make changes to prod and making sure prod is stable. There’s no right answer – only the right answer for your situation.</p>
</section>
<section id="dev-and-test-environments" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="dev-and-test-environments"><span class="header-section-number">2.2</span> Dev and test environments</h2>
<p>Creating a prod environment for data science looks very much like creating a prod environment for general purpose software development. The guidelines for data science prod would be right at home in a general purpose DevOps book.</p>
<p><em>Lower environments</em>, on the other hand, often look very different because of the very different kind of software you’re building as a data scientist. If you’re working with IT/Admins to create your promotion process, this is likely to be one of the most important (and difficult) things to impress upon them.</p>
<p>Whether you’re talking data science or general purpose software development, dev is an environment for building, and test is for…testing. Your testing might include security, performance, functionality, or user acceptance testing (UAT).</p>
<p>That’s more-or-less where the similarity ends. The differences between general purpose software engineering and data science result in three big differences in dev and test environments and practices.</p>
<p>First, for general purpose software engineering, a lower environment needs to include inputs that are <em>shaped</em> like prod, but the actual content doesn’t matter. For example, if you’re building an online store, you need dev and test environments where the API calls from the sales system are in the same format as the real data – but you don’t actually care if it’s real data. In fact, you probably want to create some odd-looking cases for testing purposes.</p>
<p>That’s very different for a data scientist. In a dev or test environment, you don’t want <em>write</em> access to anything sensitive. But a dev environment for data science without <em>read</em> access to the real data is basically useless.</p>
<p>This is often a point of friction with IT/Admins who might believe access to fake data is fine. Convincing them that you need <em>read-only</em> access in a dev environment can often help allay these concerns.</p>
<p>Second, dev, test, and prod all look similar for general purpose software engineering, but there are often meaningful differences like mocked API calls or fake data. In constrast, data science dev and prod look quite different from each other, and test and prod can be extremely similar.</p>
<p>A data science dev environment is likely to be a code-writing environment like RStudio, Spyder, VSCode, or PyCharm on your laptop or on a server. In this environment, you’ll want a lot of freedom to install and try out new R and Python packages.</p>
<p>In contrast, test and prod should be environments with no direct editing capabilities. Instead, they should be environments for hosting with no direct ability to edit code.</p>
<p>For many data science purposes, test and prod can actually be the same environment. You need a separate instance of your project for testing, but many data science projects are read-only. For example, if you’ve got a dashboard that just allows views of the data, you can probably do your testing on a second instance of your dashboard in the prod environment.</p>
<p>Last, you’ve got an additional layer of testing a data science project. Because data science is about discovering and sharing insights from data, you’ll want some sort of monitoring for whether your dashboard values are accurate or for whether your model is experiencing drift over time. There are many different ways and frameworks to do this kind of testing, but you should be aware that it’s something you need to do as a data scientist that general purpose software developers don’t.</p>
</section>
<section id="sec-env-vars" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-env-vars"><span class="header-section-number">2.3</span> Environment Variables</h2>
<p>In <a href="1-1-env-as-code.html">Chapter&nbsp;<span>1</span></a>, we got deep into the different layers of the environment. There’s one important additional piece of an environment at runtime – the environment variables.</p>
<p>An environment variable is a value that is set in the environment. That means unlike a regular R or Python variable that is expected to change throughout the runtime, environment variables are set at the outset of your code to change the behavior throughout the runtime.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is convention to make environment variable names in all caps with words separated by underscores. The values are always simple character values, though these can be cast to some other type inside R or Python.</p>
</div>
</div>
<p>Environment variables are extremely important for code promotion process because they provide a way to manage secrets across multiple environments, as well as a way to change behavior of your project in different environments.</p>
<p>Inside your code, you’ll use the <em>name</em> of the environment variable, so your app can use secrets and have different behavior without your code changing at all from environment to environment.</p>
<section id="secrets-management" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="secrets-management"><span class="header-section-number">2.3.1</span> Secrets management</h3>
<p>When you’re moving your code across environments, one of the most delicate parts is managing secrets like passwords and secret access keys.</p>
<p>Putting secrets directly in your code is a great way to end up with them leaking on GitHub or to people who aren’t supposed to have them. <em>Do not put your secrets in your code</em>. Instead, the best way to manage secrets is to reference them <em>by name</em>. Referencing secrets by name makes it safe to share your code freely and make secrets management a separate concern.</p>
<p>In Python, you can read environment variables from the <code>os.environ</code> dictionary or by using <code>os.getenv("&lt;VAR_NAME&gt;")</code>. In R, you can get and set environment variables with <code>Sys.getenv("&lt;VAR_NAME&gt;")</code>.</p>
<p>Dev environment secrets are most often loaded from a plain text from a file on disk, though organizations are increasingly moving to secrets management tools so you get these secrets via an API of some sort.</p>
<p>If you are loading in secrets from a plain text file in Python, environment variables are usually set by explicitly reading a <code>.env</code> file into your Python session. The <a href="https://pypi.org/project/python-dotenv/"><code>{python-dotenv}</code> package</a> is a good choice for doing this.</p>
<p>R automatically reads the <code>.Renviron</code> file as environment variables and also sources the <code>.Rprofile</code> file, where you can set environment variables with <code>Sys.setenv()</code>. I personally prefer putting everything in <code>.Rprofile</code> for simplicity – but that’s not a universal opinion.</p>
<p>Depending on the tooling you’re using, your Test and Prod environment may well come with integrated secrets management. The exact configuration will depend on that environment, but you should use those tools when they’re available.</p>
</section>
<section id="per-environment-behavior" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="per-environment-behavior"><span class="header-section-number">2.3.2</span> Per environment behavior</h3>
<p>If you’ve got a very simple project – perhaps a Shiny app that just reads a local CSV file – then the world will look exactly the same regardless of the environment.</p>
<p>But in many cases, you actually want your project to behave differently in dev, test, and prod. You might want to switch data sources from a dev database to a prod one, or you want to write to a real output location, or you want to use a different level of logging.</p>
<p>That means your project needs the ability to know which environment it’s in and then to respond accordingly. The easiest way to make this happen is to base that behavior on the value of an environment variable and to load in different environment variables depending on the environment.</p>
<p>Most of the time, the way this is accomplished is that you externally set the name of the environment and then your code loads up the appropriate set of environment variables.</p>
<p>There are a variety of ways to do this in Python – many of which involve creating a custom class for each of the environments you want to use and then selecting the right class based on the value of an environment variable.</p>
<p>In R, the <code>{config}</code> package is the standard way to load an environmental configuration. The <code>config::get()</code> function uses the value of the <code>R_CONFIG_ACTIVE</code> environment variable to choose which configuration to use. That means that switching from the dev to the prod version of the app is as easy as making sure you’ve got the correct environment variable set on your system.</p>
</section>
</section>
<section id="automated-promotion" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="automated-promotion"><span class="header-section-number">2.4</span> Automated Promotion</h2>
<p>It’s possible to manually promote code from one environment to another. Some organizations write <em>runbooks</em> that dictate how code is promoted. The issue is that humans aren’t great at following procedures. Environments often drift apart and your rigorous code promotion strategy comes undone.</p>
<p>Computers, on the other hand, are great at following procedures. The best way to automate CI/CD is to attach it to version control so that automated promotion follows from changes being approved in a version control system.</p>
<section id="a-rough-intro-to-git" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="a-rough-intro-to-git"><span class="header-section-number">2.4.1</span> A Rough Intro to Git</h3>
<p>These days, <a href="https://git-scm.com/">git</a> is the industry standard for version control.</p>
<p>If you’re not already familiar, I’d suggest spending some time learning git.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>People who say git is easy to learn are either lying or have forgotten. I am sorry our industry has standardized on a tool with such terrible ergonomics, but it’s really worth it to learn.</p>
<p>Whether you’re an R or Python user, I’d recommend starting with <a href="https://happygitwithr.com/">HappyGitWithR</a> by Jenny Bryan. It’s a great on-ramp to learn git.</p>
<p>Even if you’re a Python user, the sections on getting started with git, on basic git concepts, and on workflows will be useful since they approach git from a data science perspective.</p>
</div>
</div>
<p>I’m not going to get into the mechanics of git in this book– what it means to add, commit, push, pull, merge, and more. There are lots of great resources out there that I’m not aiming to reproduce, though there is a git <a href="#cheat-git">cheatsheet</a> at the end of the chapter.</p>
<p>Instead, I want to talk about git <em>strategies</em> that match well with using git to execute a data science code promotion strategy.</p>
<p>For production data science assets, I generally recommend long-running <code>test</code> and <code>prod</code> branches, with feature branches for developing new things. New code is developed in a feature branch, merged into <code>test</code> for testing, and then promoted to <code>prod</code> when you’re confident it’s ready.</p>
<p>For example, if you had a new plots you were adding to an existing dashboard, your git commit graph might look like this:</p>
<p><img src="images/git-branches.png" class="img-fluid" alt="Diagram showing branching strategy. A feature branch called plot 1 comes off of test. A merge reveals a bug, so a bugfix results. It is then merged back to prod."></p>
<p>In this git graph, you added your new plot. Testing then revealed a bug, which was fixed before merging back to prod.</p>
<p>CI/CD tooling allows you to add automation that runs on the basis of actions in git. Most commonly, CI/CD runs pre-merge checks like spell checking, code linting, and automated testing before making merges and runs automatic deployments after.</p>
<p>A CI/CD integration using the same git graph as above would have released 2 new test versions of the app and only 1 new prod version.</p>
</section>
</section>
<section id="comprehension-questions" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="comprehension-questions"><span class="header-section-number">2.5</span> Comprehension Questions</h2>
<ol type="1">
<li>Write down a mental map of the relationship between the three environments for data science.</li>
<li>What are the options for protecting production data in a dev or test environment?</li>
<li>Why is git so important to a good code promotion strategy? Can you have a code promotion strategy without git?</li>
<li>What is the relationship between git and CI/CD? What’s the benefit of using git and CI/CD together?</li>
</ol>
</section>
<section id="lab2" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="lab2"><span class="header-section-number">2.6</span> Lab 2: Host a website with automatic updates</h2>
<p>In <a href="1-1-env-as-code.html#lab1">Lab 1</a>, we created a Quarto website with some EDA and model building. In this lab, we’re going to actually deploy that website to a public site and render the EDA and modeling steps every time we push a new version up.</p>
<p>We’re going to do all this using GitHub and GitHub Actions. GitHub is the most popular git hosting service around. A few years ago, they released a CI/CD tool called GitHub Actions (GHA). It’s free for public repositories and is easy to use.</p>
<p>It’s safe to say GHA is eating the world of CI/CD.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>Before we get into the meat of the lab, there are a few things you have to do on your own. If you don’t know how to do these things, there are plenty of great tutorials online.</p>
<ol type="1">
<li>Create an empty public git repo on GitHub.</li>
<li>Configure your Quarto project directory to push to your GitHub repo.</li>
</ol>
<p>Once you’ve got your GitHub repo up and connected, you want to set up your website to publish via GitHub Actions. There are great directions on how to get that configured on the <a href="https://quarto.org/docs/publishing/github-pages.html#github-action">Quarto website</a>.</p>
<p>In those instructions, you’ll set up GitHub Pages to serve your website off a long-running standalone branch called <code>gh-pages</code>. Along the way, you’ll generate an <code>_publish.yml</code>, which is a Quarto-specific file for configuring publishing locations.</p>
<p>You’ll also generate the GitHub Action workflow file, which will live at <code>.github/workflows/publish.yml</code>. Since the main point here is to learn about CI/CD like GitHub Actions, let’s take a minute to make sure you understand what the GitHub Action does.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.github/workflows/publish.yml</strong></pre>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="at">  </span><span class="fu">workflow_dispatch</span><span class="kw">:</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> main</span></span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Quarto Publish</span></span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="at">  </span><span class="fu">build-deploy</span><span class="kw">:</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="at">    </span><span class="fu">permissions</span><span class="kw">:</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="at">      </span><span class="fu">contents</span><span class="kw">:</span><span class="at"> write</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Check out repository</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v2</span></span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Quarto</span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> quarto-dev/quarto-actions/setup@v2</span></span>
<span id="cb1-19"><a href="#cb1-19"></a></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Render and Publish</span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> quarto-dev/quarto-actions/publish@v2</span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="at">          </span><span class="fu">target</span><span class="kw">:</span><span class="at"> gh-pages</span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="at">        </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="at">          </span><span class="fu">GITHUB_TOKEN</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This action has three high-level sections – <code>on</code>, <code>name</code>, and <code>jobs</code>.</p>
<p>This particular syntax is unique to GitHub Actions. The basic idea is universal to all CI/CD systems – you define a trigger and a job to do when it’s triggered.</p>
<p>The <code>on</code> section defines <strong>when</strong> the workflow occurs. In this case, we’ve configured the workflow only to trigger on a push to the <code>main</code> branch, which includes a merge.</p>
<p>The <code>jobs</code> section defines what happens when the job is triggered. The most common way to define what happens is to use preexisting GitHub Actions steps with <code>uses</code>.</p>
<p>As you can see from the <code>runs-on</code> field, we’re starting with a very basic Ubuntu setup. After that, the first two workflow steps set up our environment, with our website’s GitHub repository checked out into the Actions environment and Quarto installed.</p>
<p>In the third step, we’re actually rendering the website and then pushing it back to the repository. This third step makes use of arguments in GitHub Actions. In GitHub Actions, <code>with</code> defines variables used by the workflow, and <code>env</code> defines values in the environment – often secrets used by the workflow, like in this case.</p>
<p>Now, if you try to run this, it probably won’t work.</p>
<p>That’s because the CI/CD process occurs in a completely isolated environment, so we need to set up the versions of R and Python, as well as the packages to run our EDA and modeling scripts.</p>
<p>First, add the commands to install R, <code>{renv}</code>, and the packages for your content to the GitHub Actions workflow.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.github/workflows/publish.yml</strong></pre>
</div>
<div class="sourceCode" id="cb2" data-startfrom="20"><pre class="sourceCode numberSource yml number-lines code-with-copy"><code class="sourceCode yaml" style="counter-reset: source-line 19;"><span id="cb2-20"><a href="#cb2-20"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install R</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-r@v2</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="at">          </span><span class="fu">r-version</span><span class="kw">:</span><span class="at"> </span><span class="st">'4.2.0'</span></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="at">          </span><span class="fu">use-public-rspm</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb2-25"><a href="#cb2-25"></a></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Setup renv and install packages</span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-renv@v2</span></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="at">          </span><span class="fu">cache-version</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="at">        </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="at">          </span><span class="fu">RENV_CONFIG_REPOS_OVERRIDE</span><span class="kw">:</span><span class="at"> https://packagemanager.rstudio.com/all/latest</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One important thing to note is the repos override. This is because I’d like <code>{renv}</code> to install packages from binaries rather than compiling them because it’s much faster. But my CI/CD environment is using Ubuntu, not whatever I’m using on my desktop. So I’ve got to let <code>{renv}</code> in GitHub Actions know to use public Posit Package Manager for my current operating system.</p>
<p>Then you add a workflow to GitHub Actions to install Python and the necessary Python packages from the <code>requirements.txt</code>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.github/workflows/publish.yml</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-startfrom="33"><pre class="sourceCode numberSource yml number-lines code-with-copy"><code class="sourceCode yaml" style="counter-reset: source-line 32;"><span id="cb3-33"><a href="#cb3-33"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install Python and Dependencies</span></span>
<span id="cb3-34"><a href="#cb3-34"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-python@v4</span></span>
<span id="cb3-35"><a href="#cb3-35"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="at">          </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="st">'3.10'</span></span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="at">          </span><span class="fu">cache</span><span class="kw">:</span><span class="at"> </span><span class="st">'pip'</span></span>
<span id="cb3-38"><a href="#cb3-38"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> pip install jupyter</span></span>
<span id="cb3-39"><a href="#cb3-39"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> pip install -r requirements.txt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that in this case, we run the Python environment restore commands with <code>run</code> rather than <code>uses</code>. Where <code>uses</code> takes an existing GitHub Action and runs it, <code>run</code> just runs the code included there in the terminal.</p>
<p>Once you’ve done that, your website should be good to go. If you want to check, make a change to your website and push to the main branch. If you click on the <code>Actions</code> tab on GitHub you’ll be able to see the Action running. Once it finishes, you should be able to see your change reflected on your website.</p>
<p>Once it’s up, your website will be available at <code>https://&lt;username&gt;.github.io/&lt;repo-name&gt;</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Don’t worry if you don’t like that URL. We’ll set up a custom domain in <a href="../sec3/3-4-dns.html">Chapter&nbsp;<span>13</span></a>.</p>
</div>
</div>
</section>
<section id="cheat-git" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="cheat-git"><span class="header-section-number">2.7</span> Cheatsheet: Git</h2>
<table class="table">
<colgroup>
<col style="width: 37%">
<col style="width: 62%">
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>What it Does</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>git clone &lt;remote&gt;</code></td>
<td>Clone a remote repo – make sure you’re using SSH URL.</td>
</tr>
<tr class="even">
<td><code>git add &lt;files/dir&gt;</code></td>
<td>Add files/dir to staging area.</td>
</tr>
<tr class="odd">
<td><code>git commit -m &lt;message&gt;</code></td>
<td>Commit your staging area.</td>
</tr>
<tr class="even">
<td><code>git push origin &lt;branch&gt;</code></td>
<td>Push to a remote.</td>
</tr>
<tr class="odd">
<td><code>git pull origin &lt;branch&gt;</code></td>
<td>Pull from a remote.</td>
</tr>
<tr class="even">
<td><code>git checkout &lt;branch name&gt;</code></td>
<td>Checkout a branch.</td>
</tr>
<tr class="odd">
<td><code>git checkout -b &lt;branch name&gt;</code></td>
<td>Create and checkout a branch.</td>
</tr>
<tr class="even">
<td><code>git branch -d &lt;branch name&gt;</code></td>
<td>Delete a branch.</td>
</tr>
</tbody>
</table>
<section id="freezing-quarto-computations" class="level3" data-number="2.7.1">
<h3 data-number="2.7.1" class="anchored" data-anchor-id="freezing-quarto-computations"><span class="header-section-number">2.7.1</span> Freezing Quarto Computations</h3>
<p>If you read the Quarto documents, they recommend freezing your computations. This is very useful if you want to render your R or Python code locally and only render the markdown elsewhere.</p>
<p>Because the main point here is to learn about getting environments as code working in CI/CD you <em>should not</em> freeze your environment.</p>
</section>
<section id="section" class="level3" data-number="2.7.2">
<h3 data-number="2.7.2" class="anchored" data-anchor-id="section"><span class="header-section-number">2.7.2</span> </h3>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>It’s worth noting that commercial air travel is exceptionally safe – including takeoff and landing. But we’re talking relative risk here.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Prior to the release of GHA, Travis and Jenkins were the industry standards for CI/CD. GitLab, another git host, has long offered a very good CI/CD integration.</p>
<p>Lots of organizations have Azure DevOps, formerly known as Visual Studio Team Services. Microsoft, who owns Azure, acquired GitHub in 2018, so who knows what the future holds.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/sec1/1-1-env-as-code.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Environments as Code</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/sec1/1-3-data-arch.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Pipeline Architecture</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, Alex K Gold</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/akgold/do4ds" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/alexkgold">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>