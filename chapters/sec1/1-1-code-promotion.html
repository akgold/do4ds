<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DevOps for Data Science - 1&nbsp; Code promotion and integration</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/sec1/1-2-env-as-code.html" rel="next">
<link href="../../chapters/sec1/1-0-sec-intro.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BTSMMRMH08"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-BTSMMRMH08', { 'anonymize_ip': true});
</script>
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/sec1/1-0-sec-intro.html">DevOps Lessons for Data Science</a></li><li class="breadcrumb-item"><a href="../../chapters/sec1/1-1-code-promotion.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Code promotion and integration</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">DevOps for Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/akgold/do4ds" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec1/1-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DevOps Lessons for Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-1-code-promotion.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Code promotion and integration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-2-env-as-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Environments as Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-3-data-arch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Pipeline Architecture</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-4-apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Designing Your Application Layers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-5-monitor-log.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Logging and Monitoring</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec2/2-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IT/Admin Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-1-terminal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Terminal</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-2-ssh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Connecting Securely with SSH</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-3-cmd-line.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Getting comfortable on the Command Line</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-4-docker.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Demystifying Docker</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec3/3-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IT/Admin for Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-1-cloud.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Getting Started with the Cloud</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-2-linux-admin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Basic Linux SysAdmin</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-3-networking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Intro to Computer Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-4-dns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">DNS allows for human-readable addresses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-5-ssl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">You should use SSL/HTTPS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-6-servers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Choosing the right server for you</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec4/4-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making it Enterprise-Grade</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-1-os-ds-in-ent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Open Source Data Science in the Enterprise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-2-ent-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Enterprise Networking</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-3-auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Auth in Enterprise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-4-ent-servers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Enterprise Server Management</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Auth Technologies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/lab-map.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Lab Map</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-three-environments" id="toc-the-three-environments" class="nav-link active" data-scroll-target="#the-three-environments"><span class="header-section-number">1.1</span> The Three Environments</a>
  <ul class="collapse">
  <li><a href="#dev-for-data-science" id="toc-dev-for-data-science" class="nav-link" data-scroll-target="#dev-for-data-science"><span class="header-section-number">1.1.1</span> Dev for Data Science</a></li>
  <li><a href="#test-and-prod" id="toc-test-and-prod" class="nav-link" data-scroll-target="#test-and-prod"><span class="header-section-number">1.1.2</span> Test and Prod</a></li>
  <li><a href="#protecting-prod-data" id="toc-protecting-prod-data" class="nav-link" data-scroll-target="#protecting-prod-data"><span class="header-section-number">1.1.3</span> Protecting Prod Data</a></li>
  </ul></li>
  <li><a href="#taking-data-science-to-production-with-cicd" id="toc-taking-data-science-to-production-with-cicd" class="nav-link" data-scroll-target="#taking-data-science-to-production-with-cicd"><span class="header-section-number">1.2</span> Taking data science to production with CI/CD</a>
  <ul class="collapse">
  <li><a href="#a-rough-intro-to-git" id="toc-a-rough-intro-to-git" class="nav-link" data-scroll-target="#a-rough-intro-to-git"><span class="header-section-number">1.2.1</span> A Rough Intro to Git</a></li>
  <li><a href="#using-cicd-to-deploy-data-science-assets" id="toc-using-cicd-to-deploy-data-science-assets" class="nav-link" data-scroll-target="#using-cicd-to-deploy-data-science-assets"><span class="header-section-number">1.2.2</span> Using CI/CD to deploy data science assets</a></li>
  </ul></li>
  <li><a href="#per-environment-configuration" id="toc-per-environment-configuration" class="nav-link" data-scroll-target="#per-environment-configuration"><span class="header-section-number">1.3</span> Per-Environment Configuration</a></li>
  <li><a href="#sec-env-vars" id="toc-sec-env-vars" class="nav-link" data-scroll-target="#sec-env-vars"><span class="header-section-number">1.4</span> The power of environment variables</a></li>
  <li><a href="#comprehension-questions" id="toc-comprehension-questions" class="nav-link" data-scroll-target="#comprehension-questions"><span class="header-section-number">1.5</span> Comprehension Questions</a></li>
  <li><a href="#lab1" id="toc-lab1" class="nav-link" data-scroll-target="#lab1"><span class="header-section-number">1.6</span> Lab 1: Host a Website on GitHub with Automatic Updates</a></li>
  <li><a href="#cheat-git" id="toc-cheat-git" class="nav-link" data-scroll-target="#cheat-git"><span class="header-section-number">1.7</span> Cheatsheet: Git</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/akgold/do4ds/edit/main/chapters/sec1/1-1-code-promotion.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-code-promotion" class="quarto-section-identifier"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Code promotion and integration</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>If you’ve ever taken an app or report into production, you know the moment. You get a call, a text, a slack – “the app is down”. A bead of cold sweat runs down your back. Your world narrows to you and your agonizingly nonfunctional app that the CEO, of course, needs <em>right now</em>.</p>
<p>Basically all of DevOps is designed around preventing this moment.</p>
<p>Promotion workflows are the core of DevOps practices.</p>
<p>In this chapter in particular, we’ll be thinking about <em>deployments</em> – the moment something goes into production, whether that’s a new app entirely or an update to an existing app. You want this moment to be as smooth as possible. Thus, you want to ensure that deployments don’t happen unless they’re supposed to and that when a deployment happens, it is as seamless as possible, with minimal downtime in the live production system.</p>
<p>In this chapter, we’ll explore how to set up multiple environments so you can safely develop and test your app before going to production and how to design and execute a promotion workflow that makes your deployment completely seamless.</p>
<section id="the-three-environments" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="the-three-environments"><span class="header-section-number">1.1</span> The Three Environments</h2>
<p>The best way to ensure that things only get deployed when you mean them to – and sleep securely knowing that it won’t be disturbed – is to have standalone environments for development, testing, and production. Having separate environments and a plan for promoting content from one to the other is the core of workflows that de-risk pushing to production.</p>
<p>Usually, these environments are referred to as Dev, Test, and Prod.</p>
<p><img src="images-code-promotion/dev-test-prod.png" class="img-fluid" alt="An app moving through dev, test, and prod environments."></p>
<div class="cell" data-eval="true">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">flowchart LR
    A("Dev") --&gt;|Promote| B(Test)
    B --&gt;|Promote| C(Prod)
</pre>
</div>
</div>
</div>
</div>
<p>The best way to ensure that deployments go smoothly is to make them as minimal and predictable as possible. This requires that the dev, test, and prod environments be very close mirrors of each other. We’ll get into how to accomplish that at the end of this chapter.</p>
<section id="dev-for-data-science" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="dev-for-data-science"><span class="header-section-number">1.1.1</span> Dev for Data Science</h3>
<p><strong>Dev</strong> is a sandbox where people can install packages and try new things with no risk of breaking anything in production.</p>
<p>If you’re a data scientist, you probably have a really good idea what your Dev environment looks like. It’s probably a Jupyter Notebook or an IDE with data science capabilities like RStudio, Spyder, or PyCharm. You use this environment to do exploratory data analysis, try out new types of charts and graphs, and test model performance against new features that you might design. This is really different than what most IT/Admins imagine is happening in Dev.</p>
<p>For a pure software engineering project, the Dev environment isn’t about exploration and experimentation – it’s about building. The relationship between data science and software engineering is akin to the difference between archaeology and architecture. Data science is about exploring existing relationships and sharing them with others once they’ve been discovered. The path is often meandering – and it’s usually not clear whether it’s even a possible one when you start. In contrast, pure software engineering is like designing a building. You know from the beginning that you’re designing a building for a particular purpose. You might need a little exploration to ensure you’ve thought through all of the nooks and crannies, or that you’ve chosen the right materials, or that you’re going to stay on budget, but you’ll have a pretty good idea up front whether it’s possible to design the building you want.</p>
<p>This means that Dev environments look really different for a data scientist versus a software engineer.</p>
<p>The biggest difference is that most IT/Admins are going to think of Dev, Test, and Prod being three identical copies of the same environment. That’s close to what you need as a data scientist, but really it’s more like you need a sandbox, a test environment, and prod. That means that if you’re using a deployment platform like RStudio Connect or Dash Enterprise, you probably don’t need it in your Dev environment, and that you don’t need your development tool in Test or Prod (any changes should go back through the deployment pipeline).</p>
</section>
<section id="test-and-prod" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="test-and-prod"><span class="header-section-number">1.1.2</span> Test and Prod</h3>
<p><strong>Test</strong> is (unsurprisingly) an environment for testing. Depending on the type of asset you’re developing, the test environment might incorporate testing that you do, testing by outside entities like security, and/or performance testing. Generally, the test environment facilitates User Acceptance Testing (UAT), where you can investigate whether labels and buttons are clear or whether plots and graphs meet the need. Depending on your organization, test might be collapsed with dev, it might be a single environment, or it could be multiple environments for the different types of testing.</p>
<p><strong>Prod</strong> is the gold standard environment where things run without any manual human intervention. Usually the only way to get things into prod is through some type of formalized process – sometimes backed by a computer process like a git merge or push from a Continuous Integration/Continuous Deployment (CI/CD) platform (more on that below). One of the most important ways to keep prod stable is that nothing changes in prod other than via a simple promotion from the test environment.</p>
</section>
<section id="protecting-prod-data" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="protecting-prod-data"><span class="header-section-number">1.1.3</span> Protecting Prod Data</h3>
<p>One of the biggest risks during the dev and test parts of an assets lifecycle is that you might mess up real data during your work. In a software engineering context, it’s common to use completely fake data or for the app to be the data generation tool.</p>
<p>In contrast, data science is all about using and learning from your organization’s actual data. So a dev environment that doesn’t include access to your organization’s real data is going to be completely useless if it doesn’t have real data in it. This is often a difficult thing to convince an IT/Admin of.</p>
<p>In many cases, data science assets and reports are read-only. If you’re mostly building visualizations or dashboards that just consume the business data, perhaps clean it for analytics purposes, you can happily accept a read-only connection to your organization’s data.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> In this case, it works just fine to connect to your real data from your Dev and Test environments and create graphs, models, and dashboards based on the real data, testing out new visualizations and model features in a safe sandbox while the existing version of your app or report runs smoothly in prod.</p>
<p>On the other hand, if your app or report actually writes data, you’ll have to be a little more clever. In general, you’ll have to figure out how to redirect your apps output into a test data store, or to mock responses from the real services you’re interacting with. The easiest way to do this is by including your output locations as variables inside your code and then setting them at runtime based on an environment variable. See <a href="#config-swap">below</a> for an example of how to do this.</p>
</section>
</section>
<section id="taking-data-science-to-production-with-cicd" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="taking-data-science-to-production-with-cicd"><span class="header-section-number">1.2</span> Taking data science to production with CI/CD</h2>
<p>The common term for the mechanics of code promotion is Continuous Integration/Continuous Deployment (CI/CD).</p>
<p>CI/CD is about moving your data science projects, including code, data, and environment, into successively more formal states of production. While it’s not a requirement to use source control to make this happen, the <em>mechanics</em> of CI/CD is usually tightly linked to source control procedures.</p>
<section id="a-rough-intro-to-git" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="a-rough-intro-to-git"><span class="header-section-number">1.2.1</span> A Rough Intro to Git</h3>
<p>If you’re not already familiar, I’d suggest spending some time learning git. If you’re just starting, you’re in for a bit of a ride.</p>
<p>People who say git is easy are either lying to look smarter or learned so long ago that they have forgotten how easy it is to mess up your entire workflow at any moment.</p>
<p>I’m not going to get into the mechanics of git in this book– what it means to add, commit, push, pull, merge, and more. There are lots of great resources out there that I’m not aiming to reproduce.</p>
<div class="rmdinfo">
<p>If you don’t already know git and want to learn, I’d recommend <a href="https://happygitwithr.com/index.html">HappyGitWithR</a> by Jenny Bryan. It’s a great on-ramp to learn git.</p>
<p>Even if you’re a Python user, the sections on getting started with git, on basic git concepts, and on workflows will be useful since they approach git from a data science perspective.</p>
</div>
<p>There’s a git <a href="#cheat-git">cheatsheet</a> at the end of the chapter, and I will talk about some git <em>strategies</em> that match well with using git to execute a data science code promotion strategy.</p>
<p>For production data science assets, I generally recommend long-running dev (or test) and prod branches, with feature branches for developing new things. The way this works is that new features are developed in a feature branch, merged into dev for testing, and then promoted to prod when you’re confident it’s ready.</p>
<p>For example, if you had two new plots you were adding to an existing dashboard, your git commit graph might look like this:</p>
<p><img src="images-code-promotion/git-branches.png" class="img-fluid" width="474"></p>
<p>CI/CD adds a layer on top of this. CI/CD allows you to integrate functional testing by automatically running those tests whenever you do something in git. These jobs can run when a merge request is made, and are useful for tasks like spellchecking, linting, and running tests.</p>
<p>For the purposes of CI/CD, the most interesting jobs are those that do something after there’s a commit or a completed merge, often deploying the relevant asset to its designated location.</p>
<p>A CI/CD integration using the same git graph as above would have released 3 new test versions of the app and 2 new prod versions. Note that in this case, the second test release revealed a bug, which was fixed and tested in the test version of the app before a prod release was completed.</p>
<p>In years past, the two most popular CI/CD tools were called Travis and Jenkins. By all accounts, these tools were somewhat unwieldy and difficult to get set up. More recently, GitHub – the foremost git server – released GitHub Actions (GHA), which is CI/CD tooling directly integrated into GitHub that’s free for public repositories and free up to some limits for private ones.</p>
<p>It’s safe to say GHA is eating the world of CI/CD.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>For example, if you’re reading this book online, it was deployed to the website you’re currently viewing using GHA. I’m not going to get deep into the guts of GHA, but instead talk generally about the pattern for deploying data science assets, and then go through how I set up this book on GHA.</p>
</section>
<section id="using-cicd-to-deploy-data-science-assets" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="using-cicd-to-deploy-data-science-assets"><span class="header-section-number">1.2.2</span> Using CI/CD to deploy data science assets</h3>
<p>In general, using a CI/CD tool to deploy a data science asset is pretty straightforward. The mental model to have is that the CI/CD tool stands up a completely empty server for you, and runs some code on it.</p>
<p>That means that if you’re just doing something simple like spellchecking, you can probably just specify to run spellcheck. If you’re doing something more complicated, like rendering an R Markdown document or Jupyter Notebook and then pushing it to a server, you’ll have to take a few extra steps to be sure the right version of R or Python is on the CI/CD server, that your package environment is properly reproduced, and that you have the right code to render your document.</p>
</section>
</section>
<section id="per-environment-configuration" class="level2" data-config-swap="" data-number="1.3">
<h2 data-config-swap="" data-number="1.3" class="anchored" data-anchor-id="per-environment-configuration"><span class="header-section-number">1.3</span> Per-Environment Configuration</h2>
<p>Sometimes you want a little more flexibility – for example the option to switch many the environment variables depending on the environment.</p>
<p>In R, the standard way to do this is using the <a href="https://cran.r-project.org/web/packages/config/index.html"><code>config</code></a> package. There are many options for managing runtime configuration in Python, including a package called config.</p>
<p>For example, let’s consider this shiny app. In this app, every time I press the button, the app sends a <code>POST</code> request to an external service indicating that the button has been pressed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># UI that's just a button</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="fu">actionButton</span>(<span class="st">"button"</span>, <span class="st">"Press Me!"</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a>)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># Do something on button press</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="fu">observeEvent</span>(</span>
<span id="cb1-11"><a href="#cb1-11"></a>    input<span class="sc">$</span>button, </span>
<span id="cb1-12"><a href="#cb1-12"></a>    httr<span class="sc">::</span><span class="fu">POST</span>(</span>
<span id="cb1-13"><a href="#cb1-13"></a>      <span class="st">"www.my-external-system.com"</span>, </span>
<span id="cb1-14"><a href="#cb1-14"></a>      <span class="at">body =</span> <span class="fu">list</span>(<span class="at">button_pressed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-15"><a href="#cb1-15"></a>    )</span>
<span id="cb1-16"><a href="#cb1-16"></a>  )</span>
<span id="cb1-17"><a href="#cb1-17"></a>}</span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co"># Run the application </span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the URL hardcoded like this, it’s really hard to imagine doing this in a Dev or Test environment.</p>
<p>However, with R’s config package, you can create a config.yml file that looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource default number-lines code-with-copy"><code class="sourceCode default"><span id="cb2-1"><a href="#cb2-1"></a>dev:</span>
<span id="cb2-2"><a href="#cb2-2"></a>  url: "www.test-system.com"</span>
<span id="cb2-3"><a href="#cb2-3"></a>  </span>
<span id="cb2-4"><a href="#cb2-4"></a>prod:</span>
<span id="cb2-5"><a href="#cb2-5"></a>  url: "www.my-external-system.com"</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then you can switch to the correct config and apply that configuration inside the app.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb3-2"><a href="#cb3-2"></a>config <span class="ot">&lt;-</span> config<span class="sc">::</span><span class="fu">get</span>(<span class="st">"prod"</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># UI that's just a button</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="fu">actionButton</span>(<span class="st">"button"</span>, <span class="st">"Press Me!"</span>)</span>
<span id="cb3-7"><a href="#cb3-7"></a>)</span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co"># Do something on button press</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb3-11"><a href="#cb3-11"></a>  <span class="fu">observeEvent</span>(</span>
<span id="cb3-12"><a href="#cb3-12"></a>    input<span class="sc">$</span>button, </span>
<span id="cb3-13"><a href="#cb3-13"></a>    httr<span class="sc">::</span><span class="fu">POST</span>(</span>
<span id="cb3-14"><a href="#cb3-14"></a>      config<span class="sc">$</span>url, </span>
<span id="cb3-15"><a href="#cb3-15"></a>      <span class="at">body =</span> <span class="fu">list</span>(<span class="at">button_pressed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-16"><a href="#cb3-16"></a>    )</span>
<span id="cb3-17"><a href="#cb3-17"></a>  )</span>
<span id="cb3-18"><a href="#cb3-18"></a>}</span>
<span id="cb3-19"><a href="#cb3-19"></a></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co"># Run the application </span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-env-vars" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="sec-env-vars"><span class="header-section-number">1.4</span> The power of environment variables</h2>
<p>Environment variables are an extremely powerful way to manage the context in which your code is running.</p>
<p>Whenever your code is running, your system maintains a number of different values to be used by processes running on the system. These variables are not specific to the R or Python process on the system – but they are usable by R or Python to powerful ends.</p>
<p>It is convention to make environment variable names in all caps, words separated by underscores. The values are always simple character values, though these can be cast to some other type inside R or Python.</p>
<p>In R, you can set environment variables in an <code>.Renviron</code> file or using <code>Sys.setenv(VAR_NAME = VALUE)</code> in a <code>.Rprofile</code>. These files are sourced on process startup, so the values are always available inside the running process with <code>Sys.getenv("VAR_NAME")</code>. You can have user and/or project level files and even server-level ones with <code>.Renviron.site</code> and <code>.Rprofile.site</code>.</p>
<p>In Python, environment variables are accessible one-by-one using the <code>os.getenv</code> function or as a dictionary in <code>os.environ</code>. If you’re using a lot of environment variables, it’s common to import them using a statement like <code>from os import environ as env</code>.</p>
<p>There is no equivalent of the <code>.Rprofile</code> that’s sourced before startup in Python, but it’s common to use the <code>python-dotenv</code> package to manually load the contents of a <code>.env</code> file into the environment as one of the first few lines in your code.</p>
<p>You should not commit these files to git, but should manually move them across environments, so they never appear anywhere centrally accessible.</p>
<p>Once you’re using environment variables, they’re extremely powerful. It’s very common to set the default value of a function argument to be the value of an environment variable. For example, in the example using the R <code>{config}</code> package, <code>config::get()</code> uses the value of the <code>R_CONFIG_ACTIVE</code> environment variable to choose which configuration to use.</p>
<p>That means that switching from the dev to the prod version of the app is as easy as making sure you’ve got the correct environment variable set on your system.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p>It can also be a great way to safely store secrets on your system. If you’ve got a function that, for example, creates a database connection, it’s a good idea to have the <code>username</code> and <code>password</code> arguments of your function default to reading from an environment variable so you don’t ever have to expose them in your code.</p>
<p>That might look something like this in R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>my_db_con <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">user =</span> <span class="fu">Sys.getenv</span>(<span class="st">"DB_USER"</span>), <span class="at">pw =</span> <span class="fu">Sys.getenv</span>(<span class="st">"DB_PW"</span>)) {</span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">make_db_con</span>(user, pw)</span>
<span id="cb4-3"><a href="#cb4-3"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and in Python</p>
<p>TODO: Check python version works</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">def</span> my_db_con(user <span class="op">=</span> os.getenv(<span class="st">"db_user"</span>), pw <span class="op">=</span> os.getenv(<span class="st">"db_pw"</span>)):</span>
<span id="cb5-2"><a href="#cb5-2"></a>  make_db_con(user, pw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="comprehension-questions" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="comprehension-questions"><span class="header-section-number">1.5</span> Comprehension Questions</h2>
<ol type="1">
<li>Write down a mental map of the relationship between the three environments for data science.</li>
<li>What are the options for protecting production data in a dev or test environment?</li>
<li>Why is git so important to a good code promotion strategy? Can you have a code promotion strategy without git?</li>
<li>What is the relationship between git and CI/CD? What’s the benefit of using git and CI/CD together?</li>
</ol>
</section>
<section id="lab1" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="lab1"><span class="header-section-number">1.6</span> Lab 1: Host a Website on GitHub with Automatic Updates</h2>
<p>The goal for this lab is to set up a <a href="https://pages.github.com/">GitHub Pages</a> website that automatically updates when the code changes using <a href="https://github.com/features/actions">GitHub Actions</a>.</p>
<p>We’re going to create the website using <a href="https://quarto.org">Quarto</a> for our website. Quarto is a open source scientific and technical publishing system that makes it easy to render R and Python code into beautiful documents, websites, reports, and presentations.</p>
<p>I’m not going to give you a complete step-by-step walkthrough, but here is the outline:</p>
<ol type="1">
<li>Create an empty public git repo on GitHub and clone it locally.</li>
<li>Create a Quarto website in the repo.</li>
<li>Publish the website to GitHub Pages.</li>
<li>Configure GitHub Actions to re-render the website and push updates when the GitHub repo is updated.</li>
</ol>
<p>If you need to learn more about using git or GitHub, I’d recommend checking out <a href="https://happygitwithr.com/">Happy Git with R</a>. There are tons of great git references online. This one is nicely oriented towards the needs of a data professional. It’s obviously a little more R-oriented than Python, but I think it’s a great resource regardless of your language of choice.</p>
<p>Once you’ve got the git repo created and a basic Quarto website created, the Quarto website has <a href="https://quarto.org/docs/publishing/github-pages.html#github-action">great instructions to configure publishing with GitHub Actions</a>.</p>
<p>In those instructions, you’ll set up GitHub Pages to serve your website off a long-running standalone branch called <code>gh-pages</code>. Along the way, you’ll generate an <code>_publish.yml</code>, which is a Quarto-specific file for configuring publishing locations.</p>
<p>By default, your website will be available at <code>https://&lt;username&gt;.github.io/&lt;repo-name&gt;</code>. If you want to use a custom domain, GitHub has <a href="https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/about-custom-domains-and-github-pages">good instructions</a> for how to set that up. While you can just follow those instructions, I’d recommend you wait until you get to <a href="../sec3/3-4-dns.html">Chapter&nbsp;<span>13</span></a> to understand a little better how it all works.</p>
<p>You’ll also generate the GitHub Action, which will live at <code>.github/workflows/publish.yml</code>. Since the main point here is to learn about CI/CD like GitHub Actions, let’s take a minute to make sure you understand what the GitHub Action does.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.github/workflows/publish.yml</strong></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="at">  </span><span class="fu">workflow_dispatch</span><span class="kw">:</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> main</span></span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Quarto Publish</span></span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="at">  </span><span class="fu">build-deploy</span><span class="kw">:</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="at">    </span><span class="fu">permissions</span><span class="kw">:</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="at">      </span><span class="fu">contents</span><span class="kw">:</span><span class="at"> write</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Check out repository</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v2</span></span>
<span id="cb6-16"><a href="#cb6-16"></a></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Quarto</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> quarto-dev/quarto-actions/setup@v2</span></span>
<span id="cb6-19"><a href="#cb6-19"></a></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Render and Publish</span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> quarto-dev/quarto-actions/publish@v2</span></span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="at">          </span><span class="fu">target</span><span class="kw">:</span><span class="at"> gh-pages</span></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="at">        </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="at">          </span><span class="fu">GITHUB_TOKEN</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you’ve never looked at YAML before, it should be reasonably human-readable. In this YAML file, there are three high-level sections – <code>on</code>, <code>name</code>, and <code>jobs</code>. This is a pretty minimal GitHub Actions workflow. Every workflow needs an <code>on</code> and <code>jobs</code>. The <code>name</code> is technically optional, but it’s a good idea to keep track of what job is running.</p>
<p>While this particular syntax is unique to GitHub Actions, the basic idea is universal to any CI/CD system. You have to define when something occurs and what that something is.</p>
<p>The <code>on</code> section defines <em>when</em> the workflow occurs. In this case, we’ve configured the workflow only to trigger on a push to the <code>main</code> branch. Note that a merge into main counts. This is basically the simplest trigger you can have. GitHub Actions supports a ton of different ways to trigger a workflow. You can see more <a href="https://docs.github.com/en/actions/using-workflows/triggering-a-workflow">in the documentation</a>.</p>
<p>The <code>jobs</code> section defines what happens when the job is triggered. The most common way to define what happens is to use preexisting GitHub Actions steps with <code>uses</code>. Recall that part of the value of CI/CD is that it occurs in a completely isolated environment, so you’ll first have to set up the environment for the work to occur, then actually do the work.</p>
<p>As you can see from the <code>runs-on</code> field, we’re starting with a very basic Ubuntu setup. After that, the first two workflow steps set up our environment, with our website’s GitHub repository checked out into the Actions environment and Quarto installed.</p>
<p>In the third step, we’re actually rendering the website and then pushing it back to the repository. This third step makes use of arguments in GitHub Actions. In GitHub Actions, <code>with</code> defines variables used by the workflow, and <code>env</code> defines values in the environment – often secrets used by the workflow, like in this case.</p>
<p>At this point, you can just take the pre-defined workflow and use it.</p>
<p>Once you’ve done that, you’re website should be good to go. If you want to check, make a change to your website and push to the main branch. If you click on the <code>Actions</code> tab on GitHub you’ll be able to see the Action running. Once it finishes, you should be able to see your change reflected on your website.</p>
</section>
<section id="cheat-git" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="cheat-git"><span class="header-section-number">1.7</span> Cheatsheet: Git</h2>
<table class="table">
<colgroup>
<col style="width: 37%">
<col style="width: 62%">
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>What it Does</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>git clone &lt;remote&gt;</code></td>
<td>Clone a remote repo – make sure you’re using SSH URL.</td>
</tr>
<tr class="even">
<td><code>git add &lt;files/dir&gt;</code></td>
<td>Add files/dir to staging area.</td>
</tr>
<tr class="odd">
<td><code>git commit -m &lt;message&gt;</code></td>
<td>Commit your staging area.</td>
</tr>
<tr class="even">
<td><code>git push origin &lt;branch&gt;</code></td>
<td>Push to a remote.</td>
</tr>
<tr class="odd">
<td><code>git pull origin &lt;branch&gt;</code></td>
<td>Pull from a remote.</td>
</tr>
<tr class="even">
<td><code>git checkout &lt;branch name&gt;</code></td>
<td>Checkout a branch.</td>
</tr>
<tr class="odd">
<td><code>git checkout -b &lt;branch name&gt;</code></td>
<td>Create and checkout a branch.</td>
</tr>
<tr class="even">
<td><code>git branch -d &lt;branch name&gt;</code></td>
<td>Delete a branch.</td>
</tr>
</tbody>
</table>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>In fact, you should probably feel grateful! It’s nice to know you can mess around as much as you want without risking any damage to real data.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>It’s worth remarking that GitLab has long offered a very good CI/CD integration. I’m going to talk about GHA, since it’s the most popular, but you can accomplish these same things with GitLab CI/CD.</p>
<p>Lots of organizations have Azure DevOps, formerly known as Visual Studio Team Services. Microsoft, who owns Azure, acquired GitHub in 2018, so I’d expect Azure DevOps and GitHub to converge at some point…but who knows?<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>If you’re deploying to Posit Connect, <code>R_CONFIG_ACTIVE</code> is locked to <code>rsconnect</code>. If you’ve got multiple deployments to Connect that you want to differentiate, you may want to use a different environment variable, which you would specify manually like <code>config::get(config = Sys.getenv("WHICH_CONFIG"))</code> .<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/sec1/1-0-sec-intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">DevOps Lessons for Data Science</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/sec1/1-2-env-as-code.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Environments as Code</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, Alex K Gold</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/akgold/do4ds" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/alexkgold">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>