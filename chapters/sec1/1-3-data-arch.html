<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DevOps for Data Science - 3&nbsp; Data Pipeline Architecture</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/sec1/1-4-apis.html" rel="next">
<link href="../../chapters/sec1/1-2-env-as-code.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BTSMMRMH08"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-BTSMMRMH08', { 'anonymize_ip': true});
</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Pipeline Architecture</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">DevOps for Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/akgold/do4ds" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">Welcome!</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec1/1-0-sec-intro.html" class="sidebar-item-text sidebar-link">DevOps Lessons for Data Science</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-1-code-promotion.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Code promotion and integration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-2-env-as-code.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Environments as Code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-3-data-arch.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Pipeline Architecture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-4-apis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Designing Your Application Layers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-5-monitor-log.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Logging and Monitoring</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec2/2-0-sec-intro.html" class="sidebar-item-text sidebar-link">IT/Admin Tools</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-1-terminal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Terminal</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-2-ssh.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Connecting Securely with SSH</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-3-cmd-line.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Getting comfortable on the Command Line</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-4-docker.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Docker for Data Science</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec3/3-0-sec-intro.html" class="sidebar-item-text sidebar-link">IT/Admin for Data Science</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-1-cloud.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Getting Started with the Cloud</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-2-linux-admin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Basic Linux SysAdmin</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-3-networking.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Intro to Computer Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-4-dns.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">DNS allows for human-readable addresses</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-5-ssl.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">You should use SSL/HTTPS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-6-servers.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Choosing the right server for you</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec4/4-0-sec-intro.html" class="sidebar-item-text sidebar-link">Making it Enterprise-Grade</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-1-os-ds-in-ent.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Open Source Data Science in the Enterprise</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-2-ent-networks.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Enterprise Networking</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-3-auth.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Auth in Enterprise</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-4-scaling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Scaling</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/docker-cheatsheet.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Docker Cheatsheet</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/auth.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Appendix: Auth Technologies</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-composition-of-a-data-pipeline" id="toc-the-composition-of-a-data-pipeline" class="nav-link active" data-scroll-target="#the-composition-of-a-data-pipeline"><span class="toc-section-number">3.1</span>  The composition of a data pipeline</a></li>
  <li><a href="#can-you-load-all-your-data" id="toc-can-you-load-all-your-data" class="nav-link" data-scroll-target="#can-you-load-all-your-data"><span class="toc-section-number">3.2</span>  Can you load all your data?</a>
  <ul class="collapse">
  <li><a href="#choose-your-flat-file-format" id="toc-choose-your-flat-file-format" class="nav-link" data-scroll-target="#choose-your-flat-file-format"><span class="toc-section-number">3.2.1</span>  Choose your flat file format</a></li>
  </ul></li>
  <li><a href="#how-and-where-to-save-a-flat-file-or-blob" id="toc-how-and-where-to-save-a-flat-file-or-blob" class="nav-link" data-scroll-target="#how-and-where-to-save-a-flat-file-or-blob"><span class="toc-section-number">3.3</span>  How and where to save a flat file or blob</a></li>
  <li><a href="#what-to-do-when-you-cant-load-all-the-data" id="toc-what-to-do-when-you-cant-load-all-the-data" class="nav-link" data-scroll-target="#what-to-do-when-you-cant-load-all-the-data"><span class="toc-section-number">3.4</span>  What to do when you can’t load all the data</a></li>
  <li><a href="#query-able-storage" id="toc-query-able-storage" class="nav-link" data-scroll-target="#query-able-storage"><span class="toc-section-number">3.5</span>  Query-able storage</a>
  <ul class="collapse">
  <li><a href="#how-to-connect-to-databases" id="toc-how-to-connect-to-databases" class="nav-link" data-scroll-target="#how-to-connect-to-databases"><span class="toc-section-number">3.5.1</span>  How to connect to databases?</a></li>
  <li><a href="#data-authorization-is-key-in-production" id="toc-data-authorization-is-key-in-production" class="nav-link" data-scroll-target="#data-authorization-is-key-in-production"><span class="toc-section-number">3.5.2</span>  Data authorization is key in production</a></li>
  <li><a href="#securely-managing-credentials" id="toc-securely-managing-credentials" class="nav-link" data-scroll-target="#securely-managing-credentials"><span class="toc-section-number">3.5.3</span>  Securely Managing Credentials</a></li>
  </ul></li>
  <li><a href="#comprehension-questions" id="toc-comprehension-questions" class="nav-link" data-scroll-target="#comprehension-questions"><span class="toc-section-number">3.6</span>  Comprehension Questions</a></li>
  <li><a href="#portfolio-exercise-standing-up-a-loosely-coupled-app" id="toc-portfolio-exercise-standing-up-a-loosely-coupled-app" class="nav-link" data-scroll-target="#portfolio-exercise-standing-up-a-loosely-coupled-app"><span class="toc-section-number">3.7</span>  Portfolio Exercise: Standing Up a Loosely Coupled App</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/akgold/do4ds/edit/main/chapters/sec1/1-3-data-arch.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-data-arch" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Pipeline Architecture</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>TODO: write a cheatsheet of requirements gathering questions</p>
<p>Data is like water. It flows through the systems you’ve designed. As a data scientist, you spend all day thinking about the water. You think about the relationships in it, the reality it reflects, and how to predict what’s going to happen next.</p>
<p>But there’s another important perspective, which is thinking about the pipeline carrying the water. This is how data engineers and IT/Admins think about data. The content of the data is irrelevant to them – but they care a lot that it’s flowing easily, safely, and with minimal turbulence.</p>
<p>That’s what this chapter is about.</p>
<p>This chapter has nothing to say on feature engineering, plot generation, or machine learning models. I’m going to assume that you’ve done your discovery. You’re ready to put a reasonably stable data pipeline into production. So this chapter has a lot to say is about how to architect and implement a data storage, processing, and access system that will allow you to reliably and securely control the data flowing into and through your data science project.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
But we’ve already standardized on X
</div>
</div>
<div class="callout-body-container callout-body">
<p>Great! You should probably use that.</p>
<p>If your organization has a standard database they use or a data warehouse don’t reinvent the wheel.</p>
<p>Now, it might be the case that you still need to be creative for at least part of your data pipeline, most often because you don’t have write access or because your organization’s system is only for rectangular data and you have something that’s more “blobby”.</p>
</div>
</div>
<p>This chapter will help you evaluate the type of data you’re taking in, the kind of project you’re trying to create, and make smarter decisions on how to get the data into your project. Hopefully by the end of this chapter, you’ll understand better how to think about the data requirements for your project and how to design your data pipeline and your project to make everything easier.</p>
<section id="the-composition-of-a-data-pipeline" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="the-composition-of-a-data-pipeline"><span class="header-section-number">3.1</span> The composition of a data pipeline</h2>
<p>The right way to design a data pipeline is to begin at the end. You want to start by thinking about the output of your project. It might be charts, reports, visualizations, apps, and more. Most often, this layer uses either an interactive app library like Shiny, Dash, or Streamlit or a report-generation library like R Markdown, Quarto, or Voila. In some cases, the presentation phase is just an API for machine to machine communication – but that’s still relatively uncommon.</p>
<p>There are often several kinds of data that have to get prepared to go into the presentation layer.</p>
<p>The first kind is rectangular business data. That’s the kind of data that obviously belongs in a <code>data.frame</code> in R or a <code>pandas.DataFrame</code> in Python. It’s the data you’re actually doing data science on. Depending on your organization, you might get it as completely raw data you actually have to enter yourself. In other organizations, data engineering teams have created complete data pipelines that deliver highly-refined data right to your model training process.</p>
<p>Most organizations fall somewhere in the middle. There’s a central home for data – a data warehouse, data lake, or share drive for files - but it’s not fully ready to be presented, and you’ll have to do some processing to get there.</p>
<p>Then there’s the other kinds of data that are the output of your analytics pipeline. Maybe you trained one or more machine learning model, derived descriptive statistics, or did causal inference. You also might’ve pulled out data specifically for the presentation layer during your pipeline.</p>
<p>These would be things like lists of valid categories for slicers and selectors, dates to include in the analysis, and metadata you’ll want to include like plot headers and prettier names for columns in your data.</p>
<p>Depending on the exact type of data, some of it might be pretty rectangular – something like a list of store locations and metadata about them or model coefficients and standard errors. Or it might be something really non-rectangular like a machine learning model.</p>
<p>If you take one thing away from this chapter, let it be this – you should separate your data pipeline from your presentation layer.</p>
<p>This may be a big change. Many data scientists just write a bunch of code, assuming that the data is just the data. It’s very common to see a Shiny app that mushes a bunch of data cleaning into the app itself. Or a Quarto report that does processing in the body of the report.</p>
<p>For some projects, this is a valid assumption and your data will never change. If so, you probably don’t need this chapter.</p>
<p>But for many data projects, data will change – perhaps even on a regular basis. In these cases, you’ll want to think carefully about how to link your data to your app. This chapter will review ways to write your project so that you can update and change out the data later without having to completely rewrite or rework your code.</p>
</section>
<section id="can-you-load-all-your-data" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="can-you-load-all-your-data"><span class="header-section-number">3.2</span> Can you load all your data?</h2>
<p>Just loading your data into memory is a good option if you haven’t established you can’t do this. Basically, you should try this first and see if it works. If it does, go no further. If it doesn’t – or you anticipate it won’t, you’ll want to choose a different answer.</p>
<p>You don’t have to figure out any clever way to access the data or how to make sure you’re getting all the data you need. You’ve got it all! “Real engineers” may scoff at this pattern, but don’t let their criticism dissuade you. If your data size is small and your app performance is good enough, just read in all of your data and operate on it live. Don’t complicate things more than they need to. After all, “Premature optimization is the root of all evil.” Donald Knuth</p>
<p>So the main question is whether your data is too big to load. Preprocessing will generally happen on a schedule, so as long as your data fits into memory and processing it doesn’t kill your server resources, you’re good!</p>
<p>In the presentation layer, the question is a little more complicated. It’s quick to jump to the size of the raw data you’re using and assume you can’t load all the data in, but that’s often a completely irrelevant metric. You’re starting backwards if you start from the size of the raw data. Instead, you should figure out how big the data is that you actually need in the presentation layer. In a lot of cases, you can preprocess the input data into a small dataset you can just read wholly into the presentation layer.</p>
<p>To make this a little more concrete, let’s imagine you work for a large retailer and are responsible for creating a dashboard that will allow people to visualize the last week’s worth of sales for a variety of products. With this vague prompt, you could end up needing to load a huge amount of data into your project – or very little at all.</p>
<p>One of the most important questions is how much you can cache before someone even opens the app. For example, if you need to provide total weekly sales at the department level, that’s probably just a few data points. And even if you need to go back a long ways, it’s just a few hundred data points – load all that in!</p>
<p>But if you start needing to slice and dice the data in a lot of directions, then the data size starts multiplying, and you may have to include the entire raw data set in the report. For example, if you need to include weekly sales at the department level, then the size of your data is the <span class="math inline">\(\text{number of weeks} * \text{number of departments}\)</span>. If you need to include more dimensions – say you need to add geographies, then your data size <strong>multiplies</strong> by the number of geographies.</p>
<p>Now that you’ve figured out how big the data is, you need to determine whether it’s too big. In this case, too big is really a matter of performance.</p>
<p>For some apps, you want the data to be snappy throughout runtime, but it’s ok to have a lengthy startup process (perhaps because it can happen before the user actually arrives). In that case, it’s probably still ok to use a flat file and read it all in on startup.</p>
<p>One crucial question for your project is how much wait time is acceptable for people wanting to see the project – and when is that waiting ok? For example, if people need to be able to make selections and see the results in realtime, then you probably need a snappy database, or all the data preloaded into memory when they show up.</p>
<p>But maybe you have high performance requirements or a lot of data. Or maybe you know your data will grow over time. In that case, you’re going to want to choose some other system for accessing your data.</p>
<p>If you can just load in all your data, the question then becomes how. One common way to load all your data is just to read in a whole database table. If that’s an option for you, it can be really nice.</p>
<p>If you don’t have a database handy, the most common way to save and read data is with a flat file. A flat file is what happens when you just save an active data frame somewhere. If you have relatively small data in a flat file or a database table, just moving flat files around is by far the simplest way to manage your data pipeline.</p>
<section id="choose-your-flat-file-format" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="choose-your-flat-file-format"><span class="header-section-number">3.2.1</span> Choose your flat file format</h3>
<p><strong>Flat file</strong> storage describes writing the data out into a simple file. The canonical example of a flat file is a <code>csv</code> file. However, there are also other formats that may make data storage smaller because of compression, make reads faster, and/or allow you to save arbitrary objects rather than just rectangular data. In R, the <code>rds</code> format is the generic binary format, while <code>pickle</code> is the generic binary format in python.</p>
<p>Flat files can be moved around just like any other file on your computer. You can put them on your computer, and share them through tools like dropbox, google drive, scp, or more.</p>
<p>The biggest disadvantage of flat file data storage is twofold – and is related to their indivisibility. In order to use a flat file in R or Python, you’ll need to load it into your R or Python session. For small data files, this isn’t a big deal. But if you’ve got a large file, it can take a long time to read, which you may not want to wait for. Also, if your file has to go over a network, that can be a very slow operation. Or you might have to load it into an app at startup. Also, there’s generally no way to version data, or just update part, so, if you’re saving archival versions, they can take up a lot of space very quickly.</p>
<p>---</p>
<p>There are a few different options for types of flat files. The most common is a comma separated value (csv) file, which is just a literal text file of the values in your data with commas as separators.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> You could open it in a text editor and read it if you wanted to.</p>
<p>The advantage of csvs is that they’re completely ubiquitous. Basically every programming language has some way to read in a csv file and work with it.</p>
<p>On the downside, csvs are completely uncompressed and they can only hold rectangular data. That makes them quite large relative to other sorts of files and slow to read and write. So if you’re trying to save a machine learning model, a csv doesn’t make any sense.</p>
<p>Both R and Python have language-specific flat-file types – rds in R and pickle in Python. Relative to csvs, these are nice because they usually include some amount of compression. They also can hold non-rectangular data, which can be great if you want to save a machine learning model or some other sort of object. The other advantage of rds and pickle is that they can be used with built-in data types that might not come through when saving to csv. For example, if you’re saving dates, an rds or pickle file will be able to save the data frame so that it knows to come back as a date. If you’re reading from a csv, you’d probably need to read it in as text and cast it to a character that can be annoying and – depending on the size of your data – time-consuming.</p>
</section>
</section>
<section id="how-and-where-to-save-a-flat-file-or-blob" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="how-and-where-to-save-a-flat-file-or-blob"><span class="header-section-number">3.3</span> How and where to save a flat file or blob</h2>
<p>So let’s say you’ve decided that you’re ok to just load all the data, and you don’t have a database to store it in.</p>
<p>There’s one place you usually should not save your data, and that’s inside your presentation bundle. The bundle is the set of code and assets that make up your presentation layer. For example, let’s say you’re building a simple Dash app that’s just a single file. You could create a project structure like this.</p>
<pre><code>my-project/
├─ my_app.py
├─ data/
│  ├─ my_data.csv
│  ├─ my_model.pkl</code></pre>
<p>You could do this, but you shouldn’t.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>There’s one situation in which it’s ok to just put the data inside the project, and that’s when your data will be updated at the same cadence as the app or report itself. This is pretty rare for an in-production app, but sometimes there are cases where you’re just sharing an existing dataset in the form of a report/app.</p>
</div>
</div>
<p>This is convenient as a first cut at a project, but it can make it really difficult to update the data once your project is in production. You have to keep track of where the project is on your deployment file system, reach in, and update it.</p>
<p>Instead, you want to decouple the data location from the project location.</p>
<p>There are a few ways you can do this. The most basic way is just to put the data on a location in your file system that isn’t inside the app bundle. This is, again, easy. Just make a different location in your directory and you’re good.</p>
<p>But when it comes to deployment this can also be complicated. If you’re writing your app and deploying it on the same server, then you can access the same directory. If not, you’ll need to worry about how to make sure that directory is also accessible on the server where you’re deploying your project.</p>
<p>Additionally, if you just put the file somewhere on the file system, you’ll need to control access using Linux file permissions. That’s not the end of the world, but controlling Linux file permissions is generally harder than controlling other sorts of access.</p>
<p>If you’re not going to store the flat file on the filesystem and you’re in the cloud, the most common option for where it can go is in blob storage. Blob storage is the term for storage where you store and recall things by name.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> Each cloud provider has blob storage – AWS’s is s3 (short for simple storage service), Azure has Azure Blob store, and GCP has Google Storage.</p>
<p>The nice thing about blob storage is that it can be accessed from anywhere that has access to the cloud. You can also control access using standard cloud identity management tooling, so you could control who has access using individual credentials or could just say that any request for a blob coming from a particular server would be valid.</p>
<p>There are packages in both R and Python for interacting with AWS that are very commonly used for getting access to s3 – Boto3 in Python, and paws in R.</p>
<p>There’s also the popular <code>pins</code> package in both R and Python that basically wraps using blob storage into neater code. It can use a variety of storage backends, including cloud blob storage, networked or cloud drives like Dropbox, Microsoft365 sites, and Posit Connect.</p>
<p>Lastly, a google sheet can be a great, temporary, way to save and recall a flat file. While this isn’t the most robust from an engineering perspective, it can often be a good first step while you’re still figuring out what the right answer is for your pipeline. It’s primary engineering weakness – that it’s editable by someone who logs in – can also be an asset if you need someone to edit the data. If you have to get something up and running right away, storing the data in a google sheet can be a great temporary solution while you figure out the long-term home for your data.</p>
</section>
<section id="what-to-do-when-you-cant-load-all-the-data" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="what-to-do-when-you-cant-load-all-the-data"><span class="header-section-number">3.4</span> What to do when you can’t load all the data</h2>
<p>There are some scales at which you literally cannot hold all your data in memory. It also may be the case that your data isn’t literally too big to fit into memory but its impractical – usually because it would make app startup times unacceptably long.</p>
<p>In this case, you’ll need to store your data somewhere else and run live queries against the data as you’re using it.</p>
<p>If you are using a database, you’ll want to be careful about how you construct your queries to make sure they perform well. The main way to think about this is whether your queries will be eager or lazy.</p>
<p>In an eager app, you’ll pull basically all of the data for the project as it starts up, while a lazy project will pull data only as it is need.</p>
<p>&lt;TODO: Diagram of eager vs lazy data pulling&gt;</p>
<p>Making your project eager is usually much simpler – you just read in all the data at the beginning. This is often a good first cut at writing an app, as you’re not sure exactly what requirements your project has. For relatively small datasets, this is often good enough.</p>
<p>If it seems like your project is starting up slowly – or your data’s too big to all pull in, you may want to pull data more lazily.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Before you start converting queries to speed up your app, it’s always worthwhile to profile your project and actually check that the data pulling is the slow step. I’ve often been wrong in my intuitions about what the slow step of the project is.</p>
<p>There’s nothing more annoying than spending hours refactoring your project to pull data more lazily only to realize that pulling the data was never the slow step to begin with.</p>
</div>
</div>
<p>It’s also worth considering how to make your queries perform better, regardless of when they occur in your code. You want to pull the minimum amount of data possible, so making data less granular, pulling in a smaller window of data, or pre-computing summaries is great when possible (though again, it’s worth profiling before you take on a lot of work that might result in minimal performance improvements).</p>
<p>Once you’ve decided whether to make your project eager or lazy, you can think about whether to make the query eager or lazy. In most cases, when you’re working with a database, the slowest part of the process is actually pulling the data. That means that it’s generally worth it to be lazy with your query. And if you’re using <code>dplyr</code> from R, being eager vs lazy is simply a matter of where in the chain you put the <code>collect</code> statement.</p>
<p>So you’re better off sending a query to the database, letting the database do a bunch of computations, and pulling a small results set back, rather than pulling in a whole data set and doing computations in R or Python.</p>
</section>
<section id="query-able-storage" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="query-able-storage"><span class="header-section-number">3.5</span> Query-able storage</h2>
<p>There are basically two choices when you need to do live queries – use an external system to store and access your data or use an on-disk storage system.</p>
<p>An external system – a database or Spark cluster are the most common – are very common. The advantages of an external system is that you’ve got an external server that does all the computation. You ask for some computation, it goes off to this external system and then you get back results you can use.</p>
<p>Another advantage is that making this system accessible is as simple as getting credentials to it from the group that controls it at your organization.</p>
<p>But the downside is that (hopefully) another organization controls it. Being a database administrator (DBA) is yet another real job. Depending on your organization, having someone else control the cluster can be a blessing – it’s just there! It works! Or it can be a curse – it takes weeks or months to get access! You can’t get anywhere to write to! It really depends on your organization.</p>
<p>The other option, which have been rising in popularity for medium-sized data is on-disk storage of data that is offline query-able. DuckDB is the most popular of these tools. The basic idea is that you just store your data on disk and then you run a process only when you need to that is able to query the data and load just what you need into memory.</p>
<p>DuckDB is most powerful when backed with Apache Parquet or Arrow – these relatively new data formats save your data in a clever way that make it really quick to query it without loading it into memory.</p>
<p>I can’t stress enough how cool these tools are – all of a sudden you don’t really need a database for data well into the 10s of Gb or more.</p>
<p>If you have even more data than that, you need a big data tool.</p>
<p>These days Spark is more-or-less the standard big data tool for analytics teams. There are two ways you can use Spark. The first is just to treat it as a glorified database and access the data inside using SQL. That can work great if you just have big data and you need to access it.</p>
<p>But Spark is far more powerful than that - it can also do a number of other tasks, including certain kinds of machine learning inside the Spark cluster. In that case, you should use pyspark or sparklyr to do all kinds of cool Spark stuff. If you’re just getting started, I strongly recommend the book <a href="https://therinspark.com">Mastering Spark with R</a> (free online version, like this book!) for getting started. Even if you’re using pyspark, the conceptual introduction is fantastic.</p>
<section id="how-to-connect-to-databases" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="how-to-connect-to-databases"><span class="header-section-number">3.5.1</span> How to connect to databases?</h3>
<p>In both R and Python, there are two general ways to connect to a database.</p>
<p>The first option is to use a direct connector to connect to the database. These connectors are most often thin R or Python wrappers around a bunch of C++ code. If this exists for the database you’re using, it’s generally the most optimized for your database and your should probably use it.</p>
<p>The second option is to connect to the database using a system-level driver and then connect to that database from R or Python. Many organizations like these because IT/Admins can configure them on behalf of users and can be agnostic about whether users are using them from R, Python, or something else entirely.</p>
<p>&lt;TODO: image of direct connection vs through driver&gt;</p>
<p>In this case, you’ll have to get the driver from your database provider, configure it on the system, and connect to it from R or Python. There are two main standards for system drivers – Java Database Connectivity (JDBC) and Open Database Connectivity (ODBC).</p>
<p>In general, I recommend using ODBC over JDBC if available. If you’re using JDBC, you have to deal with configuring Java in addition to your driver. Anyone who’s ever had to configure the <code>rJava</code> package will share horror stories. Enough said.</p>
<p>In R I strongly recommend using an ODBC driver and using the <code>odbc</code> and <code>DBI</code> packages to make this connection. There are other ODBC packages and there are JDBC drivers available. But <code>odbc</code> and <code>DBI</code> are very actively maintained by Posit.</p>
<p>In Python, <code>pyodbc</code> is the main package for using ODBC connections.</p>
</section>
<section id="data-authorization-is-key-in-production" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="data-authorization-is-key-in-production"><span class="header-section-number">3.5.2</span> Data authorization is key in production</h3>
<p>This is a question you probably don’t think about much as you’re puttering around inside RStudio or in a Jupyter Notebook. But when you take an app to production, this becomes a crucial question.</p>
<p>The best and easiest case here is that everyone who views the app has the same permissions to see the data. In that case, you can just allow the app access to the data, and you can check whether someone is authorized to view the app as a whole, rather than at the data access layer.</p>
<p>In some cases, you might need to provide differential data access to different users. Sometimes this can be accomplished in the app itself. For example, if you can identify the user, you can gate access to certain tabs or features of your app. Many popular app hosting options for R and Python data science apps pass the username into the app as an environment variable.</p>
<p>Sometimes you might also have a column in a table that allows you to filter by who’s allowed to view, so you might just be able to filter to allowable rows in your database query.</p>
<p>Sometimes though, you’ll actually have to pass database credentials along to the database, which will do the authorization for you. This is nice, because then all you have to do is pass along the correct credential, but it’s also a pain because you have to somehow get the credential and send it along with the query.</p>
</section>
<section id="securely-managing-credentials" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3" class="anchored" data-anchor-id="securely-managing-credentials"><span class="header-section-number">3.5.3</span> Securely Managing Credentials</h3>
<p>The single most important thing you can do to secure your credentials for your outside services is to avoid ever putting credentials in your code. That means that the actual value of your username or password should never actually appear in your code.</p>
<p>There are a few alternatives for how to make your credentials safe.</p>
<p>The first, and simplest option, is just to set them into an environment variable. If you need a refresher on how to set or use environment variables, see <a href="1-1-code-promotion.html#sec-env-vars">Section&nbsp;<span>1.4</span></a>.</p>
<p>In R, it’s also very common for organizations to create internal packages that provide connections to databases. The right way to do this is to create a function that returns a database connection object that you can use in conjunction with the <code>DBI</code> or <code>dplyr</code> packages.</p>
<p>Here’s an example of what that might look like if you were using a Postgres database:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">#' Return a database connection</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#'</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#' @param user username, character, defaults to value of DB_USER</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#' @param pw password, character, defaults to value of DB_PW</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#' @param ... other arguments passed to </span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#' @param driver driver, defaults to RPostgres::Postgres</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#'</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#' @return DBI connection</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#' @export</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#'</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#' @examples</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#' my_db_con()</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>my_db_con <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb2-14"><a href="#cb2-14"></a>    <span class="at">user =</span> <span class="fu">Sys.getenv</span>(<span class="st">"DB_USER"</span>), </span>
<span id="cb2-15"><a href="#cb2-15"></a>    <span class="at">pw =</span> <span class="fu">Sys.getenv</span>(<span class="st">"DB_PW"</span>), </span>
<span id="cb2-16"><a href="#cb2-16"></a>    ..., </span>
<span id="cb2-17"><a href="#cb2-17"></a>    <span class="at">driver =</span> RPostgres<span class="sc">::</span><span class="fu">Postgres</span>()</span>
<span id="cb2-18"><a href="#cb2-18"></a>) {</span>
<span id="cb2-19"><a href="#cb2-19"></a>  DBI<span class="sc">::</span><span class="fu">dbConnect</span>(</span>
<span id="cb2-20"><a href="#cb2-20"></a>    driver,</span>
<span id="cb2-21"><a href="#cb2-21"></a>    <span class="at">dbname =</span> <span class="st">'my-db-name'</span>, </span>
<span id="cb2-22"><a href="#cb2-22"></a>    <span class="at">host =</span> <span class="st">'my-db.example.com'</span>, </span>
<span id="cb2-23"><a href="#cb2-23"></a>    <span class="at">port =</span> <span class="dv">5432</span>, <span class="co"># default for Postgres</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="at">user =</span> user,</span>
<span id="cb2-25"><a href="#cb2-25"></a>    <span class="at">password =</span> pw)</span>
<span id="cb2-26"><a href="#cb2-26"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In some organizations, using environment variables may be fine for configuration, but will not be perceived as secure enough, because the credentials are not encrypted at rest.</p>
<p>Information that is encrypted at rest is cryptographically secured against unauthorized access. There are at least two different things people can mean. Whole-disk encryption means that your drive is encrypted so that it can only be accessed by your machine. That means that if someone were to take your hard drive to another computer, your data wouldn’t be usable. This has become more-or-less standard. Both Mac and Windows have built-in utilities to do full-disk encryption.</p>
<p>There’s another level to encrypted at rest that some organizations want, which is to avoid storing credentials in plaintext at all. For example, an <code>.Rprofile</code> file is just a simple text file. If an unauthorized user were to get access to my laptop, they could steal the credentials from my <code>.Rprofile</code> and use them themselves. Some organizations have prohibitions against ever storing credentials in plaintext. In these cases, the credentials must be stored in a cryptographically secure way and are only decrypted when they’re actually used. If you use a password manager or store passwords in your browser, this would be an example.</p>
<p>There are a number of more secure alternatives – but they generally require a little more work.</p>
<p>There are packages in both R and Python called <code>keyring</code> that allow you to use the system keyring to securely store environment variables and recall them at runtime. These can be good in a development environment, but run into trouble in a production environment because they generally rely on a user actually inputting a password for the system keyring.</p>
<p>Configuring a production system that never exposes credentials in plaintext is a nontrivial undertaking. Generally, you’ll need to work with an IT/Admin to pass through the identity of the person trying to access the system to a service that will grant them a token or ticket. This is something you’ll need help from an IT/Admin to accomplish and there’s more on how to discuss the issue in <a href="../sec4/4-3-auth.html">Chapter&nbsp;<span>18</span></a>.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some hosting software, like Posit Connect, can take care of this problem, as they store your environment variables inside the software in an encrypted fashion and inject them into the runtime.</p>
<p>You still have the issue of how you’re going to store the environment variables in your development environment, as a <code>.env</code> or <code>.Rprofile</code> file are still the most common.</p>
</div>
</div>
<p>If you are using ODBC, you or your admin may want to consider configuring a Data Source Name (DSN). A DSN provides connection details for an ODBC connection. They can be configured at a system or a user level. This means that you could put the connection details like the hostname, port, database name, etc into a simple text file right on your system and users don’t need to know anything beyond their username and password to login.</p>
</section>
</section>
<section id="comprehension-questions" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="comprehension-questions"><span class="header-section-number">3.6</span> Comprehension Questions</h2>
<ol type="1">
<li>What are the different options for data storage formats for apps? What are the advantages and disadvantages of each?</li>
<li>When should an app fetch all of the data up front? When is it better for the app to do live queries?</li>
<li>What are the different flat file types and how can they be stored?</li>
<li>What is a good way to create a database query that performs badly? (Hint: what’s the slowest part of the query)</li>
</ol>
</section>
<section id="portfolio-exercise-standing-up-a-loosely-coupled-app" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="portfolio-exercise-standing-up-a-loosely-coupled-app"><span class="header-section-number">3.7</span> Portfolio Exercise: Standing Up a Loosely Coupled App</h2>
<p>Find a public data source you like that’s updated on a regular candence. Some popular ones include weather, public transit, and air travel.</p>
<p>Create a job that uses R or Python to access the data and create a job to put it into a database (make sure this is compliant with the data use agreement).</p>
<p>Create an API in Plumber (R) or Flask or FastAPI (Python) that allows you to query the data – or maybe create a machine learning model that you can run against new data coming in.</p>
<p>Create an app that visualizes what’s coming out of the API using Dash or Streamlit (Python) or Shiny (either R or Python).</p>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>There are other separators you can use. Tab separated value files (tsv) are something you’ll see occasionally.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The term blob is great to describe the thing you’re saving in blob storage, but it’s actually an abbreviation for <strong>b</strong>inary <strong>l</strong>arge <strong>ob</strong>ject. I think it’s very clever.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/sec1/1-2-env-as-code.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Environments as Code</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/sec1/1-4-apis.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Designing Your Application Layers</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, Alex K Gold</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/akgold/do4ds" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/alexkgold">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>