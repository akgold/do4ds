<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DevOps for Data Science - 1&nbsp; Environments as Code</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/sec1/1-2-proj-arch.html" rel="next">
<link href="../../chapters/sec1/1-0-sec-intro.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EQR1RYSHQK"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EQR1RYSHQK', { 'anonymize_ip': true});
</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/sec1/1-0-sec-intro.html">DevOps Lessons for Data Science</a></li><li class="breadcrumb-item"><a href="../../chapters/sec1/1-1-env-as-code.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Environments as Code</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">DevOps for Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/akgold/do4ds" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec1/1-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DevOps Lessons for Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-1-env-as-code.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Environments as Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-2-proj-arch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Project Architecture Guidelines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-3-data-access.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Using databases and data APIs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-4-monitor-log.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Logging and Monitoring</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-5-deployments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Deployments and code promotion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-6-docker.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Demystifying Docker</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec2/2-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IT/Admin for Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-1-cloud.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Cloud</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-2-cmd-line.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Customizing the command line</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-3-linux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Intro to Linux Administration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-4-app-admin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Application administration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-5-scale.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Server Resources and Scaling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-6-networking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Intro to Computer Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-7-dns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">DNS allows for human-readable addresses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-8-ssl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">You should use SSL/HTTPS</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec3/3-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making it Enterprise-Grade</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-1-os-ds-in-ent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Open Source Data Science in the Enterprise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-2-ent-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Enterprise Networking</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-3-auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Auth in Enterprise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-4-ent-servers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Enterprise Server Management</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Auth Technologies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/lab-map.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Lab Map</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/cheatsheets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Cheatsheets</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#environments-have-layers" id="toc-environments-have-layers" class="nav-link active" data-scroll-target="#environments-have-layers"><span class="header-section-number">1.1</span> Environments have layers</a></li>
  <li><a href="#what-is-a-package-environment" id="toc-what-is-a-package-environment" class="nav-link" data-scroll-target="#what-is-a-package-environment"><span class="header-section-number">1.2</span> What is a package environment</a></li>
  <li><a href="#using-a-virtual-environment" id="toc-using-a-virtual-environment" class="nav-link" data-scroll-target="#using-a-virtual-environment"><span class="header-section-number">1.3</span> Using a virtual environment</a></li>
  <li><a href="#whats-happening-under-the-hood" id="toc-whats-happening-under-the-hood" class="nav-link" data-scroll-target="#whats-happening-under-the-hood"><span class="header-section-number">1.4</span> What’s happening under the hood</a></li>
  <li><a href="#reproducing-the-rest-of-the-stack" id="toc-reproducing-the-rest-of-the-stack" class="nav-link" data-scroll-target="#reproducing-the-rest-of-the-stack"><span class="header-section-number">1.5</span> Reproducing the rest of the stack</a></li>
  <li><a href="#comprehension-questions" id="toc-comprehension-questions" class="nav-link" data-scroll-target="#comprehension-questions"><span class="header-section-number">1.6</span> Comprehension Questions</a></li>
  <li><a href="#lab1" id="toc-lab1" class="nav-link" data-scroll-target="#lab1"><span class="header-section-number">1.7</span> Lab 1: Create a website with virtual environments</a>
  <ul class="collapse">
  <li><a href="#eda-in-r" id="toc-eda-in-r" class="nav-link" data-scroll-target="#eda-in-r"><span class="header-section-number">1.7.1</span> EDA in R</a></li>
  <li><a href="#modeling-in-python" id="toc-modeling-in-python" class="nav-link" data-scroll-target="#modeling-in-python"><span class="header-section-number">1.7.2</span> Modeling in Python</a></li>
  </ul></li>
  <li><a href="#cheat-renv-venv" id="toc-cheat-renv-venv" class="nav-link" data-scroll-target="#cheat-renv-venv"><span class="header-section-number">1.8</span> Cheatsheet: Environments as Code</a>
  <ul class="collapse">
  <li><a href="#checking-library-repository-status" id="toc-checking-library-repository-status" class="nav-link" data-scroll-target="#checking-library-repository-status"><span class="header-section-number">1.8.1</span> Checking library + repository status</a></li>
  <li><a href="#creating-and-using-a-standalone-project-library" id="toc-creating-and-using-a-standalone-project-library" class="nav-link" data-scroll-target="#creating-and-using-a-standalone-project-library"><span class="header-section-number">1.8.2</span> Creating and Using a Standalone Project Library</a></li>
  <li><a href="#collaborating-on-someone-elses-project" id="toc-collaborating-on-someone-elses-project" class="nav-link" data-scroll-target="#collaborating-on-someone-elses-project"><span class="header-section-number">1.8.3</span> Collaborating on someone else’s project</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/akgold/do4ds/edit/main/chapters/sec1/1-1-env-as-code.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-env-as-code" class="quarto-section-identifier"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Environments as Code</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Creating a data science project is like cooking a delicious meal.</p>
<p>In this analogy, your data are the raw ingredients and your code is the recipe for your meal.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>I’m not here to talk much about your ingredients or your recipes.</p>
<p>Instead, I’m here to talk about your pantry and your kitchen.</p>
<p>A novice cook thinks prep is done once they’ve gathered their ingredients and recipes. They might chop/smush a tomato with whatever dull butter knife happens to be at hand.</p>
<p>But that’s not how the pros think. A pro probably has a knife just for tomatoes and they frequently – perhaps every time they use it – hone it to razor sharpness.</p>
<p>Regardless of your proficiency in the kitchen, you’re a pro (or aiming to be one) at data science. In this chapter, we’re going to talk about the data science equivalent of prepping your knives in your kitchen – actively managing your data science environments using code.</p>
<p>Kitchen metaphors aside, your data science environment is the stack of software and hardware below the level of your code, from the R and Python packages you’re using right down to the physical hardware your code runs on.</p>
<p><img src="images/environment.png" class="img-fluid" alt="Code and data going into an environment with hardware, R and Python, and packages." width="413"></p>
<p>Novice data scientists are like novice cooks and think little – or not at all – about the readiness of their environment and the sharpness of their tools. One of the primary results of this is the oft-spoken, and dreaded phrase, “well, it works on my machine” after attempting to share code with a colleague or deploy an app into a different environment.</p>
<p>Some people who read this will just throw up their hands and say, “well, it’s impossible to make things completely reproducible, so I’m not going to bother”. And they’re kinda right.</p>
<p>Trying to craft an environment that’s completely reproducible is somewhat of a fool’s errand. There’s always a tradeoff. Making things more reproducible generally takes more work – in a way that’s frustratingly asymptotic.</p>
<p><img src="images/repro-spectrum.png" class="img-fluid" alt="Spectrum of reproducibility from not at all to &quot;fully&quot; indicating that as reproducibility rises, so does that amount of work."></p>
<p>Some industries are highly regulated and need to be able to guarantee that they can reproduce an analysis exactly – down to the layer of machine instructions – a decade later. In this world, IT/Admins take physical piece of hardware that they know runs the analysis, make a backup or two, and just keep that physical piece of hardware running for many years.</p>
<p>If you don’t work in such an industry, you don’t have to go all the way there. Making things 100% reproducible is really, really hard. But taking your first steps to make things more reproducible is well-worth your time.</p>
<p>The first step towards making environments more reproducible is to create and use <em>Environments as Code</em>.</p>
<p>The DevOps term for this is that environments are <em>stateless</em>. That means that there’s no secret state embedded in the environment so that functionally identical copies can be created and destroyed at whim from code.</p>
<p>This is often expressed in the phrase that environments should be “cattle, not pets”.</p>
<p>In this chapter, we’ll get into the why and how of capturing data science environments in code, saving them for later, and easily moving them around from place to place.</p>
<section id="environments-have-layers" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="environments-have-layers"><span class="header-section-number">1.1</span> Environments have layers</h2>
<p>Data science environments have three distinct layers that build on each other. Once you understand the layers of an environment, you can think more clearly about what your actual reproducibility needs are, and which environmental layers you need to target putting into code.</p>
<p><strong>Layers of a Data Science Environments</strong></p>
<table class="table">
<colgroup>
<col style="width: 19%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th>Layer</th>
<th>Contents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Packages</td>
<td>R + Python Packages</td>
</tr>
<tr class="even">
<td>System</td>
<td><p>R + Python Language Versions</p>
<p>Other System Libraries</p>
<p>Operating System</p></td>
</tr>
<tr class="odd">
<td>Hardware</td>
<td><p>Virtual Hardware</p>
<p>Physical Hardware</p></td>
</tr>
</tbody>
</table>
<p>Fundamentally, the hardware and software layers should be the responsibility of an IT/Admin. It may be the case that you’re responsible for them as well, but then you’re just fulfilling that role.</p>
<p>But as a data scientist, you can and should be responsible for the package layer, and getting this layer right is where the biggest reproducibility bang for your buck lies.</p>
</section>
<section id="what-is-a-package-environment" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="what-is-a-package-environment"><span class="header-section-number">1.2</span> What is a package environment</h2>
<p>It’s helpful to start by building a mental model of what a package environment is before we get into how to use them well.</p>
<p>Let’s start with an intro to the different states packages can be in.</p>
<ol type="1">
<li><strong>In a repository.</strong> You’re probably used to installing packages from a packages-specific repository like PyPI, Conda, CRAN, or BioConductor. These repositories are like the grocery store – the food is packaged up and ready to go, but inert. There’s also lots of variety – repositories hold current and archival versions of tons of different packages.</li>
<li><strong>In a library.</strong> Once you install the packages you need with <code>install.packages()</code> or <code>pip install</code> or <code>conda install</code>, they’re in your library – the data science equivalent of a pantry. That library is specific to a certain environment. Importantly, libraries can hold – at most – one version of any given package. Libraries can be specific to the project, user, or shared across the system.</li>
<li><strong>Loaded.</strong> Loading a package with a <code>library</code> or <code>import</code> command is like taking the food out of the pantry and putting it on the counter so you can actually cook with it.</li>
</ol>
<p>In general, the library is the package environment that’s the most relevant because it’s the part you, as a data scientist, have control over.</p>
<p>Let’s say you work on one project for a while, installing packages from the repository into your library. Now let’s say you come back after a year of working on other projects or try to share your project with someone else.</p>
<p>It’s probable that future you or your colleague you won’t have the right versions and your code will break.</p>
<p>What would’ve been better is if you’d had an environments as code strategy that created a portable environment for each <strong>project</strong> on your system.</p>
<p>A successful package Environment as Code setup has two key attributes:</p>
<ol type="1">
<li>Your package environment is isolated and cannot be disrupted by other activities on the same machine.</li>
<li>Your package environment can easily be captured and transported elsewhere.</li>
</ol>
<p>Both R and Python have great environments as code utilities that make it easy to do both these things.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
R vs Python
</div>
</div>
<div class="callout-body-container callout-body">
<p>On a high level, the workflows for these tasks are similar between R and Python. However, it’s worth noting that Python is used all the time by your system, where R is basically only ever installed for data science purposes.</p>
<p>That means that most tutorials on using Python start with installing a standalone data science version of Python using a virtual environment or Conda, so you may already be used to using a virtual environment.</p>
<p>Hopefully this chapter will help fill out your mental model of what’s going on.</p>
</div>
</div>
<p>In R, <code>{renv}</code> is the standard on this front. In Python, there are many different options. In the context of production data science, I recommend <code>{virtualenv}/{venv}</code> and related tools.</p>
</section>
<section id="using-a-virtual-environment" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="using-a-virtual-environment"><span class="header-section-number">1.3</span> Using a virtual environment</h2>
<p>Using a virtual environment tool to create an environment as code is a three-step process. This section will teach you about the process of creating and using a virtual environment – there’s <a href="#cheat-renv-venv">a cheatsheet</a> on the commands for both R and Python at the end of the chapter.</p>
<p><strong>Step 1: Create standalone package libraries</strong></p>
<p>Each project should have it’s own <code>{renv}</code>/<code>{venv}</code> library. When you start your project, it should be in a standalone directory that includes everything the project needs – including a virtual environment.</p>
<p>This is called a project-oriented workflow. You can do it in either R or Python. The <em>What They Forgot to Teach You About R</em> course (materials available online at <a href="https://rstats.wtf/">rstats.wtf</a>) is a great intro to a project-oriented workflow whether you work in R or Python. The tooling will be somewhat different in Python, but the idea is the same.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some projects include multiple content items – like a project that like an app project backed up by an API and an ETL script. My recommendation is to create one virtual environment for each piece of content.</p>
</div>
</div>
<p>Then, every time you work on the project, you activate the virtual environment and install/activate packages in there.</p>
<p>One worry that can arise is that it could take up a lot of space to reinstall these packages over and over again for every project on your system. Don’t worry – <code>{renv}</code> and <code>{venv}</code> are a little cleverer than this. If you’re using the same package multiple times, it does some work behind the scenes using <em>symbolic links</em> to make sure that the package is actually only installed once.</p>
<p><strong>Step 2: Document environment state</strong></p>
<p>As you work inside your virtual environment, you’ll want to document the state of the package library. Both <code>{renv}</code> and <code>{venv}</code> have standard file formats for documenting the packages that are installed in the environment as well as the versions.</p>
<p>In <code>{renv}</code>, the file is called a <code>lockfile</code> and it’s a <code>requirements.txt</code> in <code>{venv}</code>.</p>
<p>Since all this work is occurring in a standalone package environment, you don’t have to worry about what’ll happen if you come back after a break. You’ll still have those same packages to use.</p>
<p><strong>Step 3: Collaborate or deploy</strong></p>
<p>When you go to share your project, you don’t want to share your actual package libraries. The actual package libraries can be large, so putting just a short lockfile or requirements file into git is definitely preferred. Additionally, package installs are specific to the operating system and the language version you’re using.</p>
<p>So if you’re working on a Mac with a particular set of R and/or Python versions and you collaborate or deploy to a Windows or Linux machine, you can’t share the actual package files. Those machines will need to install the required set of packages for themselves.</p>
<p>So you just share your <code>lockfile</code> or <code>requirements.txt</code> and your collaborator or deployment process consults that file and installs all the required packages from there.</p>
</section>
<section id="whats-happening-under-the-hood" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="whats-happening-under-the-hood"><span class="header-section-number">1.4</span> What’s happening under the hood</h2>
<p>Now that you understand the basic process of using a virtual environment tool, it might be helpful to understand what’s actually going on.</p>
<p>When you install a package, it installs into a <em>package cache</em>. This is just a directory full of installed packages. When you install a package, it’s installed into that directory. When you activate a library with <code>library</code> or <code>import</code>, it searches that directory and loads the library into the active session.</p>
<p>In R, the package cache(s) to be consulted are contained in <code>.libPaths()</code>. In Python it’s <code>sys.path</code>.</p>
<p>The key to virtual environments is that they monkey around with the package cache list, so both installation and loading happens from a cache that’s specific to the virtual environment.</p>
<p>Here’s an example. If I run <code>.libPaths()</code> before and after activating an <code>{renv}</code> environment, the first entry from the <code>.libPaths()</code> call changes from a user-level library <code>/Users/alexkgold</code> to a project-level library <code>/Users/alexkgold/Documents/do4ds/</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="sc">&gt;</span> <span class="fu">.libPaths</span>()</span>
<span id="cb1-2"><a href="#cb1-2"></a>[<span class="dv">1</span>] <span class="st">"/Users/alexkgold/Library/R/x86_64/4.2/library"</span>                 </span>
<span id="cb1-3"><a href="#cb1-3"></a>[<span class="dv">2</span>] <span class="st">"/Library/Frameworks/R.framework/Versions/4.2/Resources/library"</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>renv<span class="sc">::</span><span class="fu">activate</span>()</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="sc">*</span> Project <span class="st">'~/Documents/do4ds/docker/docker/plumber'</span> loaded. [renv <span class="dv">0</span>.<span class="fl">15.5</span>]</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">.libPaths</span>()</span>
<span id="cb1-7"><a href="#cb1-7"></a>[<span class="dv">1</span>] <span class="st">"/Users/alexkgold/Documents/do4ds/docker/docker/plumber/renv/library/R-4.2/x86_64-apple-darwin17.0"</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>[<span class="dv">2</span>] <span class="st">"/Library/Frameworks/R.framework/Versions/4.2/Resources/library"</span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Similarly, in Python it looks like this. Note that the “after” version replaces the last line of the <code>sys.path</code> with a project-level library:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="op">&gt;</span> python3 <span class="ex">-m</span> site                                       </span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="ex">sys.path</span> = [</span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="st">'/Users/alexkgold/Documents/python-examples/dash-app'</span><span class="ex">,</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="st">'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python38.zip'</span><span class="ex">,</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="st">'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8'</span><span class="ex">,</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="st">'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/lib-dynload'</span><span class="ex">,</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>    <span class="st">'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/site-packages'</span><span class="ex">,</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="ex">]</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="ex">USER_BASE:</span> <span class="st">'/Users/alexkgold/Library/Python/3.8'</span> <span class="er">(</span><span class="ex">doesn</span><span class="st">'t exist)</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="st">USER_SITE: '</span><span class="ex">/Users/alexkgold/Library/Python/3.8/lib/python/site-packages</span><span class="st">' (doesn'</span><span class="ex">t</span> exist<span class="kw">)</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="ex">ENABLE_USER_SITE:</span> True</span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="op">&gt;</span> source <span class="ex">.venv/bin/activate</span>                       </span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="kw">(</span><span class="ex">.venv</span><span class="kw">)</span></span>
<span id="cb2-15"><a href="#cb2-15"></a></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="op">&gt;</span> python3 <span class="ex">-m</span> site</span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="ex">sys.path</span> = [</span>
<span id="cb2-18"><a href="#cb2-18"></a>    <span class="st">'/Users/alexkgold/Documents/python-examples/dash-app'</span><span class="ex">,</span></span>
<span id="cb2-19"><a href="#cb2-19"></a>    <span class="st">'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python38.zip'</span><span class="ex">,</span></span>
<span id="cb2-20"><a href="#cb2-20"></a>    <span class="st">'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8'</span><span class="ex">,</span></span>
<span id="cb2-21"><a href="#cb2-21"></a>    <span class="st">'/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/lib-dynload'</span><span class="ex">,</span></span>
<span id="cb2-22"><a href="#cb2-22"></a>    <span class="st">'/Users/alexkgold/Documents/python-examples/dash-app/.venv/lib/python3.8/site-packages'</span><span class="ex">,</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="ex">]</span></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="ex">USER_BASE:</span> <span class="st">'/Users/alexkgold/Library/Python/3.8'</span> <span class="er">(</span><span class="ex">doesn</span><span class="st">'t exist)</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="st">USER_SITE: '</span><span class="ex">/Users/alexkgold/Library/Python/3.8/lib/python/site-packages</span><span class="st">' (doesn'</span><span class="ex">t</span> exist<span class="kw">)</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="ex">ENABLE_USER_SITE:</span> False</span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="kw">(</span><span class="ex">.venv</span><span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you’re on a shared server, you may want to share a package cache across users. This generally isn’t necessary, but can save some space on the server. Both <code>{renv}</code> and <code>venv</code> include settings to allow you to relocate the package cache to a shared location on the server. You’ll need to make sure that all the relevant users have read and write privileges to this location.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why I’m not talking about Conda
</div>
</div>
<div class="callout-body-container callout-body">
<p>Many data scientists love Conda for managing their Python environments.</p>
<p>Conda is allows you to create a data science environment on your local laptop. It’s especially useful when your machine is locked down and you don’t have root access because it does all of its installation in user space.</p>
<p>That’s super useful for working on your laptop, but it’s not a great fit for a production environment. Conda smashes together the language version, the package management, and (sometimes) the system library management. This has the benefit of being conceptually simple and easy-to-use. But I’ve often seen it go awry in production environments, and I generally recommend people use a tool that’s just for package management, like <code>{venv}</code>, as opposed to an all-in-one tool like Conda.</p>
</div>
</div>
</section>
<section id="reproducing-the-rest-of-the-stack" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="reproducing-the-rest-of-the-stack"><span class="header-section-number">1.5</span> Reproducing the rest of the stack</h2>
<p>As a data scientist, your responsibility in a production environment ends at responsibly creating and using virtual environments for your packages. That said, there may not be an IT/Admin to take care of the rest for your team.</p>
<p>Let’s talk a little about how to reproduce the rest of the stack.</p>
<p>Managing R and Python versions has gotten easier over the years. There are great tools like <code>{rig}</code> in R and <code>{pyenv}</code> in Python that makes it easy to manage the versions of R and Python that are available on a system.</p>
<p>Many R and Python libraries are wrappers for system libraries, often written in C++ for speed. For example, many popular packages for geospatial analysis are just thin language wrappers that call out to the system libraries. In this case, it might be important to be able to maintain a particular version of the underlying system library to ensure that your code runs at all in the future.</p>
<p>There are many tools you can use to record and reproduce the R and Python versions you’re using, the system libraries, and the operating system itself.</p>
<p>These days, the clear leader of the pack on this front is Docker. Since its introduction in 2013, it has become an increasingly popular way to create, maintain, and use standalone environments – and for good reason!</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/docker-usage.png" class="img-fluid figure-img" width="408"></p>
</figure>
</div>
<p>In most cases, the only requirement to run any Docker container is having Docker installed. If you put your project in a Docker container and it runs today, you can be reasonably confident that the container itself can run almost anywhere else, irrespective of what else is running on that machine.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>In <a href="1-6-docker.html">Chapter&nbsp;<span>6</span></a>, you’ll learn the basics of how to use Docker as a tool for reproducing a data science project and moving it around.</p>
</section>
<section id="comprehension-questions" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="comprehension-questions"><span class="header-section-number">1.6</span> Comprehension Questions</h2>
<ol type="1">
<li>Why does difficulty increase as the level of required reproducibility increase for a data science project. In your day-to-day work, what’s the hardest reproducibility challenge?</li>
<li>Draw a mental map of the relationships between the 7 levels of the reproducibility stack. Pay particular attention to <strong>why</strong> the higher layers depend on the lower ones.</li>
<li>What are the two key attributes of environments as code? Why do you need both of them? Are there cases where you might only care about one?</li>
<li>Draw a mental map of the relationships between the following: package repository, package library, package, project-level-library, <code>.libPaths()</code> (R) or <code>sys.path</code>(python), lockfile</li>
<li>Why is it a bad idea to share package libraries? What’s the best way to collaborate with a colleague using an environment as code? What are the commands you’ll run in R or Python to save a package environment and restore it later?</li>
</ol>
</section>
<section id="lab1" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="lab1"><span class="header-section-number">1.7</span> Lab 1: Create a website with virtual environments</h2>
<p>In this lab, we’re going to start working on our penguin explorer website. We’re going to create a simple website using <a href="https://quarto.org">Quarto</a>, which is an open source scientific and technical publishing system that makes it easy to render R and Python code into beautiful documents, websites, reports, and presentations.</p>
<p>In this lab, we’re going to create pages for a simple exploratory data analysis and model building from the <a href="https://allisonhorst.github.io/palmerpenguins/">Palmer Penguins</a> dataset. In order to get to practice with both R and Python, I’m going to do the EDA page in R and the modeling in Python.</p>
<p>You can follow the instructions on the Quarto site to start a new Quarto project in your editor of choice. You can check it out locally with <code>quarto preview</code>.</p>
<p>As we add each of the pages below, don’t forget to add them to your <code>_quarto.yml</code> so quarto knows to render them.</p>
<section id="eda-in-r" class="level3" data-number="1.7.1">
<h3 data-number="1.7.1" class="anchored" data-anchor-id="eda-in-r"><span class="header-section-number">1.7.1</span> EDA in R</h3>
<p>Let’s add a simple R-language EDA of the Palmer Penguins data set to our website by adding a file called <code>eda.qmd</code> in the root directory of your project.</p>
<p>Before you start adding code, create and activate an <code>{renv}</code> environment with <code>renv::init()</code>.</p>
<p>Now, go ahead and do your analysis. Here’s the contents of my <code>eda.qmd</code>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>eda.qmd</strong></pre>
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">---</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="an">title:</span><span class="co"> "Penguins EDA"</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="an">format:</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">  html:</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">    code-fold: true</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">---</span></span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="fu">## Penguin Size and Mass by Sex and Species</span></span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="in">```{r}</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-14"><a href="#cb3-14"></a></span>
<span id="cb3-15"><a href="#cb3-15"></a>df <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="in">```</span></span>
<span id="cb3-17"><a href="#cb3-17"></a></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="in">```{r}</span></span>
<span id="cb3-19"><a href="#cb3-19"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>  <span class="fu">group_by</span>(species, sex) <span class="sc">%&gt;%</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>  <span class="fu">summarise</span>(</span>
<span id="cb3-22"><a href="#cb3-22"></a>    <span class="fu">across</span>(</span>
<span id="cb3-23"><a href="#cb3-23"></a>      <span class="fu">where</span>(is.numeric), </span>
<span id="cb3-24"><a href="#cb3-24"></a>      \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-25"><a href="#cb3-25"></a>      )</span>
<span id="cb3-26"><a href="#cb3-26"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="in">```</span></span>
<span id="cb3-29"><a href="#cb3-29"></a></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="fu">## Penguin Size vs Mass by Species</span></span>
<span id="cb3-31"><a href="#cb3-31"></a></span>
<span id="cb3-32"><a href="#cb3-32"></a><span class="in">```{r}</span></span>
<span id="cb3-33"><a href="#cb3-33"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb3-34"><a href="#cb3-34"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bill_length_mm, <span class="at">y =</span> body_mass_g, <span class="at">color =</span> species)) <span class="sc">+</span></span>
<span id="cb3-35"><a href="#cb3-35"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb3-36"><a href="#cb3-36"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Feel free to copy this Quarto doc right into your website or to write your own.</p>
<p>Once you’ve finished writing your EDA script and checked that it renders nicely into the website, save the doc, and create your lockfile with <code>renv::snapshot()</code>.</p>
</section>
<section id="modeling-in-python" class="level3" data-number="1.7.2">
<h3 data-number="1.7.2" class="anchored" data-anchor-id="modeling-in-python"><span class="header-section-number">1.7.2</span> Modeling in Python</h3>
<p>Now let’s build a <code>{scikit-learn}</code> model for predicting penguin weight based on bill length in a Python notebook by adding a <code>model.qmd</code> to the root of our project.</p>
<p>Again, you’ll want to create your virtual environment and activate it before you start <code>pip install</code>-ing packages into the environment. Check the <a href="#cheat-renv-venv">cheatsheet</a> if you need help with the specific commands.</p>
<p>Here’s what’s in my <code>model.qmd</code>, but you should feel free to include whatever you want.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>model.qmd</strong></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource yml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1"></a><span class="pp">---</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Model"</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="at">  </span><span class="fu">html</span><span class="kw">:</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="at">    </span><span class="fu">code-fold</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="pp">---</span></span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="at">```{python}</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="at">from palmerpenguins import penguins</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="at">from pandas import get_dummies</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="at">import numpy as np</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="at">from sklearn.linear_model import LinearRegression</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="at">from sklearn import preprocessing</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="at">```</span></span>
<span id="cb4-15"><a href="#cb4-15"></a></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">## Get Data</span></span>
<span id="cb4-17"><a href="#cb4-17"></a></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="at">```{python}</span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="at">df = penguins.load_penguins().dropna()</span></span>
<span id="cb4-20"><a href="#cb4-20"></a></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="at">df.head(3)</span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="at">```</span></span>
<span id="cb4-23"><a href="#cb4-23"></a></span>
<span id="cb4-24"><a href="#cb4-24"></a><span class="co">## Define Model and Fit</span></span>
<span id="cb4-25"><a href="#cb4-25"></a></span>
<span id="cb4-26"><a href="#cb4-26"></a><span class="at">```{python}</span></span>
<span id="cb4-27"><a href="#cb4-27"></a><span class="at">X = get_dummies(df[['bill_length_mm', 'species', 'sex']], drop_first = True)</span></span>
<span id="cb4-28"><a href="#cb4-28"></a><span class="at">y = df['body_mass_g']</span></span>
<span id="cb4-29"><a href="#cb4-29"></a></span>
<span id="cb4-30"><a href="#cb4-30"></a><span class="at">model = LinearRegression().fit(X, y)</span></span>
<span id="cb4-31"><a href="#cb4-31"></a><span class="at">```</span></span>
<span id="cb4-32"><a href="#cb4-32"></a></span>
<span id="cb4-33"><a href="#cb4-33"></a><span class="co">## Get some information</span></span>
<span id="cb4-34"><a href="#cb4-34"></a></span>
<span id="cb4-35"><a href="#cb4-35"></a><span class="at">```{python}</span></span>
<span id="cb4-36"><a href="#cb4-36"></a><span class="at">print(f"R^2 {model.score(X,y)}")</span></span>
<span id="cb4-37"><a href="#cb4-37"></a><span class="at">print(f"Intercept {model.intercept_}")</span></span>
<span id="cb4-38"><a href="#cb4-38"></a><span class="at">print(f"Columns {X.columns}")</span></span>
<span id="cb4-39"><a href="#cb4-39"></a><span class="at">print(f"Coefficients {model.coef_}")</span></span>
<span id="cb4-40"><a href="#cb4-40"></a><span class="at">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once you’re happy with how the page is working, capture your dependencies in a <code>requirements.txt</code> using <code>pip freeze &gt; requirements.txt</code> on the command line.</p>
</section>
</section>
<section id="cheat-renv-venv" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="cheat-renv-venv"><span class="header-section-number">1.8</span> Cheatsheet: Environments as Code</h2>
<section id="checking-library-repository-status" class="level3" data-number="1.8.1">
<h3 data-number="1.8.1" class="anchored" data-anchor-id="checking-library-repository-status"><span class="header-section-number">1.8.1</span> Checking library + repository status</h3>
<table class="table">
<colgroup>
<col style="width: 54%">
<col style="width: 22%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>R Command</th>
<th>Python Command</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Check whether library in sync with lockfile.</td>
<td><code>re nv::status()</code></td>
<td>None</td>
</tr>
</tbody>
</table>
</section>
<section id="creating-and-using-a-standalone-project-library" class="level3" data-number="1.8.2">
<h3 data-number="1.8.2" class="anchored" data-anchor-id="creating-and-using-a-standalone-project-library"><span class="header-section-number">1.8.2</span> Creating and Using a Standalone Project Library</h3>
<p>Make sure you’re in a standalone project library.</p>
<table class="table">
<colgroup>
<col style="width: 30%">
<col style="width: 30%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>R Command</th>
<th>Python Command</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Make sure you’ve got <code>{r  env}/{venv}</code>.</td>
<td><code>in s t a l l  .packages("renv")</code></td>
<td>Included w/ Python 3.5+</td>
</tr>
<tr class="even">
<td>Create a standalone library.</td>
<td><code>renv::init()</code></td>
<td><p><code>p y t  hon -m venv &lt;dir&gt;</code></p>
<p>Convention: <code>u s  e .venv for &lt;dir&gt;</code></p></td>
</tr>
<tr class="odd">
<td>Activate project library.</td>
<td><p><code>renv::activate()</code></p>
<p>Happens automatically if using projects.</p></td>
<td><code>sou r c e &lt; d  ir&gt; /bin/activate</code></td>
</tr>
<tr class="even">
<td>Install packages as normal.</td>
<td><code>ins t a l l .  packages("&lt;pkg&gt;")</code></td>
<td><code>pyth o n - m  pip install &lt;pkg&gt;</code></td>
</tr>
<tr class="odd">
<td>Snapshot package state.</td>
<td><code>renv::snapshot()</code></td>
<td><code>pip fr e e z e &gt;   requirements.txt</code></td>
</tr>
<tr class="even">
<td>Exit project environment.</td>
<td>Leave R project.</td>
<td><code>deactivate</code></td>
</tr>
</tbody>
</table>
</section>
<section id="collaborating-on-someone-elses-project" class="level3" data-number="1.8.3">
<h3 data-number="1.8.3" class="anchored" data-anchor-id="collaborating-on-someone-elses-project"><span class="header-section-number">1.8.3</span> Collaborating on someone else’s project</h3>
<p>Start by downloading the project into a directory on your machine.</p>
<table class="table">
<colgroup>
<col style="width: 30%">
<col style="width: 30%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>R Command</th>
<th>Python Command</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Move into project directory.</td>
<td><p><code>set wd  ("&lt;project-dir&gt;")</code></p>
<p>Or just open R project in RStudio.</p></td>
<td><code>cd &lt;project-dir&gt;</code></td>
</tr>
<tr class="even">
<td>Create project environment.</td>
<td><code>renv::init()</code></td>
<td><p><code>py thon -m venv &lt;dir&gt;</code></p>
<p>Recommend: <code>u se .venv for &lt;dir&gt;</code></p></td>
</tr>
<tr class="odd">
<td>Enter project environment.</td>
<td>Happens automatically or <code>renv::activate()</code></td>
<td><code>source &lt; dir&gt; /bin/activate</code></td>
</tr>
<tr class="even">
<td>Restore packages.</td>
<td>Happens automatically or <code>renv::restore()</code></td>
<td><code>pip install -r   requirements.txt</code></td>
</tr>
</tbody>
</table>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Credit for this analogy goes to my former colleague Sean Lopp – a fount of excellent analogies and overall wonderful co-worker.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Usually. Users of Apple’s M1 and M2 chips have run into many issues running containers due to differences in hardware architecture.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/sec1/1-0-sec-intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">DevOps Lessons for Data Science</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/sec1/1-2-proj-arch.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Project Architecture Guidelines</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, Alex K Gold</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/akgold/do4ds" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/alexkgold">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>