<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DevOps for Data Science - 17&nbsp; Compute at enterprise scale</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/sec3/3-4-ent-pm.html" rel="next">
<link href="../../chapters/sec3/3-2-auth.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EQR1RYSHQK"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EQR1RYSHQK', { 'anonymize_ip': true});
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/sec3/3-0-sec-intro.html">Enterprise-grade data science</a></li><li class="breadcrumb-item"><a href="../../chapters/sec3/3-3-ent-scale.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Compute at enterprise scale</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">DevOps for Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/akgold/do4ds" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec1/1-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DevOps Lessons for Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-1-env-as-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Environments as Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-2-proj-arch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Project Architecture Guidelines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-3-data-access.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Using databases and data APIs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-4-monitor-log.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Logging and Monitoring</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-5-deployments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Deployments and code promotion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-6-docker.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Demystifying Docker</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec2/2-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IT/Admin for Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-1-cloud.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Cloud</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-2-cmd-line.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Customizing the command line</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-3-linux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Intro to Linux Administration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-4-app-admin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Application administration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-5-scale.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Server Resources and Scaling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-6-networking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Intro to Computer Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-7-dns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">DNS allows for human-readable addresses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-8-ssl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">You should use SSL/HTTPS</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec3/3-0-sec-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Enterprise-grade data science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-1-ent-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Enterprise Networking</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-2-auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Auth in Enterprise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-3-ent-scale.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Compute at enterprise scale</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-4-ent-pm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Package Management in the Enterprise</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Auth Technologies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/lb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Load Balancers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/lab-map.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Lab Map</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/cheatsheets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Cheatsheets</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#devops-best-practices" id="toc-devops-best-practices" class="nav-link active" data-scroll-target="#devops-best-practices"><span class="header-section-number">17.1</span> DevOps best practices</a></li>
  <li><a href="#compute-for-many-users" id="toc-compute-for-many-users" class="nav-link" data-scroll-target="#compute-for-many-users"><span class="header-section-number">17.2</span> Compute for many users</a></li>
  <li><a href="#computing-in-clusters" id="toc-computing-in-clusters" class="nav-link" data-scroll-target="#computing-in-clusters"><span class="header-section-number">17.3</span> Computing in clusters</a></li>
  <li><a href="#docker-in-enterprise-kubernetes" id="toc-docker-in-enterprise-kubernetes" class="nav-link" data-scroll-target="#docker-in-enterprise-kubernetes"><span class="header-section-number">17.4</span> Docker in enterprise = Kubernetes</a></li>
  <li><a href="#consider-hpc-over-kubernetes" id="toc-consider-hpc-over-kubernetes" class="nav-link" data-scroll-target="#consider-hpc-over-kubernetes"><span class="header-section-number">17.5</span> Consider HPC over Kubernetes</a></li>
  <li><a href="#comprehension-questions" id="toc-comprehension-questions" class="nav-link" data-scroll-target="#comprehension-questions"><span class="header-section-number">17.6</span> Comprehension Questions</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/akgold/do4ds/edit/main/chapters/sec3/3-3-ent-scale.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-ent-scale" class="quarto-section-identifier"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Compute at enterprise scale</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Managing compute is no mean feat at enterprise scales. Patterns that might work at smaller scales start to break down when the environment needs to support 100 or 500 or even 1,000 data scientists working on the same platform.</p>
<p>Supporting that many users involves much more complexity and expense because you absolutely have to have multiple – perhaps many – servers. With so many users, you’re probably supporting a variety of different types of work, which adds complexity. Additionally, downtime becomes very expensive, so the stability of the system becomes paramount and overall expense can be quite high.</p>
<p>This chapter will help you understand how enterprise IT/Admins think about managing a lot of servers and how to communicate with them about your needs as a data scientist.</p>
<section id="devops-best-practices" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="devops-best-practices"><span class="header-section-number">17.1</span> DevOps best practices</h2>
<p>In an enterprise, the IT/Admin group is managing dozens or hundreds or thousands of servers. In order to keep that many servers manageable, the IT/Admin group tries to keep those servers very standardized and interchangeable. This idea is often encompassed in the adage that “servers should be cattle, not pets”. That means that you almost certainty won’t be allowed to SSH in and just make changes that you might want as a data scientist.</p>
<p>Indeed, in many organizations, <strong>no one</strong> is allowed to SSH in and make changes. Instead, all changes have to go through a robust change management process and are deployed via <em>Infrastructure as Code (IaC)</em> tools so the environment can always be torn down and replaced easily.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Avoiding this complexity is the major reason many organizations are moving away from directly managing servers at all. Instead, they’re outsourcing server patches and management by acquiring PaaS or SaaS software from cloud providers.</p>
</div>
</div>
<p>There are actually two parts to standing up an environment. First the servers and networking need to be stood up, called <em>provisioning</em>. Once that’s done, they need to be <em>configured</em>, which involves installing and activating applications like Python, R, JupyterHub, RStudio Server. In many enterprises, provisioning and configuration are actually done by separate groups, which server group and the application administration group.</p>
<p>There are many different IaC tools you may hear the IT/Admins at your organization talk about. These include Terraform, Ansible, CloudFormation (AWS’s IaC tool), Chef, Puppet, and Pulumi. Most of these tools can do both provisioning and configuration, but most specialize in one or the other, so many organizations use a pair of them together.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
No Code IaC
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some enterprises manage servers without IaC. These usually involve writing extensive <em>run books</em> to tell another person how to configure the servers. If your spidey sense is tingling that this probably isn’t nearly as good as code, you’re right. Finding that your enterprise IT/Admin organizations doesn’t use IaC tooling is definitely a red flag.</p>
</div>
</div>
<p>Along with making deployments via IaC, organizations that follow DevOps best practices use a Dev/Test/Prod setup for making changes to servers and applications. The Dev and Test environments, often called <em>lower environments</em> are solely for testing changes to the environment itself. In order to differentiate this environment from the data scientist’s Dev and Test environments, I often refer to this as <em>staging</em>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Generally, the you won’t have access to the staging environment at all, except for potentially doing user acceptance testing for changes there.</p>
<p>In this kind of setup, environment promotion is a two-dimensional grid, with IT/Admins working on changes to the environment in staging and data scientists working in Dev and Test within the Prod IT/Admin environment. The ultimate goal of all of this is to create an extremely reliable prod-prod environment.</p>
<p><img src="images/dev-test-prod.png" class="img-fluid" alt="The IT/Admin promotes the complete staging environment, then the data scientist or IT/Admin promote within Prod." width="600"></p>
<p>In enterprises, moves from staging to prod, including upgrades to applications or operating systems or adding system libraries often have rules around them. They may need to be validated or approved by security. In some highly-regulated environments, the IT/Admin group may only be able to make changes during certain windows of time. This can be a source of tension between a data scientist who wants a new library or version <strong>now</strong> and an IT/Admin who isn’t allowed to move fast.</p>
<p>In addition to changes that go from staging to prod, enterprises also sometimes undergo a complete rebuild of their environments. These days, many of those rebuilds are the result of a move to the cloud, which can be a multi-year affair.</p>
</section>
<section id="compute-for-many-users" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="compute-for-many-users"><span class="header-section-number">17.2</span> Compute for many users</h2>
<p>At some number of data scientists, you outstrip the ability of any one server – even a big one – to accommodate all of the work that needs to get done. How many data scientists it takes to overtax a single server depends entirely on what data scientists do at your organization. If you’re doing highly intensive simulation work or deep learning, you may hit it with only one person. On the other hand, I’ve seen organizations that mostly work on small data sets that can comfortably fit 50 concurrent users on a single server.</p>
<p>Once you need multiple servers to support the data science team(s), you have to <em>horizontally scale</em>. There is a simple way to horizontally scale, which is just to give every user or every group their own disconnected server. In some organizations this can work very well. The downside is that this either leaves a lot of hassle for the IT/Admin to manage or they just delegate server management to the individual teams.</p>
<p>Many enterprises don’t want to do things this way. Instead, they want to run one centralized service that everyone, or at least a lot of users, in the company tome to. Managing just one environment makes things simpler in some ways, but it drastically increases the cost of downtime. For example, one hour of downtime for a platform that supports 500 data scientists wastes over $25,000.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Measuring Uptime
</div>
</div>
<div class="callout-body-container callout-body">
<p>Organizations often introduce <em>Service Level Agreements (SLAs)</em> or <em>Operating Level Agreements (OLAs)</em> about how much downtime is allowed. These limits are often measured in <em>nines of uptime</em>, which refers to the proportion of the time that the service is guaranteed to be online. So a <em>one-nine</em> service is guaranteed to be up 90% of the time, allowing for 36 days of downtime a year. A <em>five-nine</em> service is guaranteed up for 99.999% of the time, allowing for only about 5 1/4 minutes of downtime a year.</p>
</div>
</div>
<p>For that reason, organizations that support enterprise data science platforms take avoiding downtime very seriously. Most have some sort of <em>disaster recovery</em> policy. Some maintain frequent (often nightly) snapshots of the state of the environment so they can roll back to a known good state in the event of a failure. Sometimes it means that there is actually a copy of the environment waiting on standby in the event of an issue with the main environment.</p>
<p>Other times, there are stiffer requirements such that nodes in the cluster could fail and the users wouldn’t be meaningfully affected. This requirement for limited cluster downtime is often called <em>high availability</em>. If you’re talking to an IT/Admin about high availability, it’s worth understanding that it’s a description of a desired outcome, not a particular technology or technical approach.</p>
</section>
<section id="computing-in-clusters" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="computing-in-clusters"><span class="header-section-number">17.3</span> Computing in clusters</h2>
<p>Whether it’s for horizontal scaling or high availability reasons, most enterprises run their data science environments in a <em>cluster</em>, which is a set of servers (<em>nodes</em>) that operate together as one unit. Ideally, working in a cluster feels the same as working in a single-server environment, but there are multiple servers to add computational power or provide resilience if one server were to fail.</p>
<p>In order to have a cluster operate as a single environment, you need to solve two problems. First, you want to provide a single front door that routes users to a node in the cluster, preferably without them being aware of it happening. This is accomplished with a <em>load-balancer</em>, which is a kind of proxy server.</p>
<p>Second, you need to make sure that the user is able to persist things (<em>state</em>) on the server even if they end up on a different node later. This is accomplished by setting up storage so that persistent data doesn’t actually live on any of the nodes. Instead, it lives in separate storage that is symmetrically accessible to all the nodes in the cluster.</p>
<p>This separate storage often takes the form of a database and/or <em>Network Attached Storage (NAS)</em> for things that get stored in a filesystem.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p><img src="images/lb-cluster.png" class="img-fluid" alt="Users come to the load balancer, which sends them to the nodes, which connect to the state."></p>
<p>If you are a solo data scientist reading this, please do not try to run your own load-balanced data science cluster. When you undertake load-balancing, you’ve taken on a distributed systems problem and those are <strong>inherently difficult</strong>.</p>
<p>High-availability is often phrased as “no single point of failure”. It’s worth noting that just load-balancing doesn’t eliminate single points of failure. In fact, it’s totally possible to make your system <strong>less stable</strong> by carelessly load-balancing a bunch of nodes. For example, what if your load-balancer were to fail? Or the place where the state is stored? What if your NAS has low performance relative to a non-networked drive? Sophisticated IT/Admin organizations have answers to these questions and standard ways they implement high availability.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For technical information on how load-balancers work and different types of configuration, see <a href="../append/lb.html">Appendix&nbsp;<span>B</span></a>.</p>
</div>
</div>
</section>
<section id="docker-in-enterprise-kubernetes" class="level2" data-number="17.4">
<h2 data-number="17.4" class="anchored" data-anchor-id="docker-in-enterprise-kubernetes"><span class="header-section-number">17.4</span> Docker in enterprise = Kubernetes</h2>
<p>Originally created at Google and released in 2014, the open source <em>Kubernetes (K8S, pronounced koo-ber-net-ees or kates for the abbreviation)</em> is the way to run production services out of Docker containers.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> Many organizations are moving towards running much or all of their production work in Kubernetes.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Apparently Kubernetes is an ancient Greek word for “helmsman”.</p>
</div>
</div>
<p>Relative to managing individual nodes in a load-balanced cluster, Kubernetes makes things easy because it completely separates provisioning and configuration. In Kubernetes, you create a cluster of worker nodes. Then, you separately tell the cluster’s <em>control plane</em> that you want it to run a certain set of Docker containers with a certain amount of computational power allocated to each one. These Docker Containers running in Kubernetes are called <em>pods</em>.</p>
<p>The elegance of Kubernetes is that you don’t have to think at all about where each pod goes. The control plane <em>schedules</em> the pods on the nodes without you having to think about where the nodes actually are or how networking will work.</p>
<p><img src="images/k8s.png" class="img-fluid" alt="Image of a Kubernetes cluster with 3 nodes and 6 pods of various sizes arranged across the nodes." width="600"></p>
<p>From the perspective of the IT/Admin, this is wonderful because you just make sure you’ve got enough horsepower in the cluster and then all the app requirements go in the container, which makes node configuration trivial.</p>
<p>In fact, almost everyone running Kubernetes can just add nodes with a few button clicks because they’re using a cloud provider’s managed service: AWS’s <em>EKS (Elastic Kubernetes Service</em>, Azure’s <em>AKS (Azure Kubernetes Service)</em>, or GCP’s <em>GKE (Google Kubernetes Engine)</em>.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>For production purposes, pod deployments are usually managed with <em>Helm charts</em>, which are the standard IaC way to declare what pods you want, how many of each you need, and what their relationship is.</p>
<p>Kubernetes is an extremely powerful tool and there are many reasons to like it. But like most powerful tools, it’s also complicated and becoming a proficient Kubernetes admin is a skill unto itself. These days, many IT/Admins are trying to add Kubernetes to their list of skills. If you have a competent Kubernetes admin, you should be in good shape, but you should be careful that setting up your data science environment doesn’t become someone else’s chance to learn Kubernetes.</p>
</section>
<section id="consider-hpc-over-kubernetes" class="level2" data-number="17.5">
<h2 data-number="17.5" class="anchored" data-anchor-id="consider-hpc-over-kubernetes"><span class="header-section-number">17.5</span> Consider HPC over Kubernetes</h2>
<p>As you add more people, you also are likely to add more variety in requirements. For example, you might want to be able to incorporate jobs that require very large nodes. Or maybe you want to run GPU-backed nodes. Or maybe you want to have “burst-able” capacity for particularly busy days or times.</p>
<p>It’s unlikely that your organization wants to be running all of these nodes all the time, especially expensive large or GPU-backed ones. By far the simplest way to manage this complexity is to run a “main” cluster for everyday kind of workloads and stand up additional special environments as needed. If the need is just for burst capacity over a relatively long time scales (e.g.&nbsp;a full day), manually adding or removing nodes from a cluster is easy.</p>
<p>Some organizations really want to run a single environment that contains different kinds of nodes or that can autoscale to accommodate quick bursts of needed capacity.</p>
<p>Often, the best option for doing these kinds of activities is a high-performance computing (HPC) framework. HPC is particularly appropriate when you need very large machines. For example, Slurm is an HPC framework that supports multiple <em>queues</em> for different sets of machines and allows you to treat an entire cluster as if it were one machine with many – even thousands – of CPU cores. AWS has a service called <em>ParallelCluster</em> that allows users to easily set up a Slurm cluster – and with no additional cost relative to the cost of the underlying AWS hardware.</p>
<p>Some organizations want to accomplish this kind of approach in Kubernetes. That is generally more difficult. It is not as easy to manage multiple kinds of nodes in one cluster with Kubernetes. Where HPC frameworks are designed to let you combine an arbitrary number of nodes into what acts like a single machine with thousands or tens of thousands of cores, it’s usually not possible to schedule pods larger than an actual node in your cluster.</p>
<p>Autoscaling is also easier in many HPC frameworks compared to Kubernetes. Regardless of the framework, scaling up is always easy. You just add more nodes and you can schedule more work. But it’s scaling down that’s hard.</p>
<p>Because of its history, Kubernetes assumes that pods can easily be moved from one node to another and it wouldn’t be a problem to shut down a node on someone and just move their pod to another node. That doesn’t work well when what’s in the pod is your Jupyter or RStudio session. Relative to Kubernetes, HPC is much more “session-aware” and often does a better job scaling down the kinds of workloads that happen in a data science environment.</p>
<p>The upshot is that most IT/Admins will reach for Kubernetes to solve the problem of multiple use cases in one cluster or to autoscale it, but HPC may actually be a better solution in a data science context.</p>
</section>
<section id="comprehension-questions" class="level2" data-number="17.6">
<h2 data-number="17.6" class="anchored" data-anchor-id="comprehension-questions"><span class="header-section-number">17.6</span> Comprehension Questions</h2>
<ol type="1">
<li>What is the difference between horizontal and vertical scaling? For each of the following examples, which one would be more appropriate?
<ol type="a">
<li><p>You’re the only person using your data science workbench and run out of RAM because you’re working with very large data sets in memory.</p></li>
<li><p>Your company doubles the size of the team that will be working in your data science workbench. Each person will be working with reasonably small data, but there’s going to be a lot more of them.</p></li>
<li><p>You have a big modeling project that’s too large for your existing machine. The modeling you’re doing is highly parallelizable.</p></li>
</ol></li>
<li>What is the role of the load-balancer in horizontal scaling? When do you really need a load-balancer and when can you go without?</li>
<li>What are the biggest strengths of Kubernetes as a scaling tool? What are some drawbacks? What are some alternatives?</li>
</ol>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>You’ll have to fight out who gets to claim the title Dev/Test/Prod for their environments with the IT/Admins at your organization. Be nice, they probably had the idea long before you did.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Assuming a (probably too low), fully-loaded cost of $100,000 and 2,000 working hours per year.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>If your NAS is exclusively for Linux, you it would use <em>NFS (Network File System)</em>. If Windows is involved, you’d use <em>SMB (Server Message Block)</em> or Samba to connect SMB to a Linux server.</p>
<p>There’s also an outdated Windows NAS called <em>CIFS (Common Internet File System)</em> that you might see in older systems.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>If you are pedantic, there are other tools for deploying Docker containers like Docker Swarm and Kubernetes is not limited to Docker containers. But for all practical purposes, <span class="math inline">\(\text{production Docker = Kubernetes}\)</span>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>It’s rare, but some organizations do run an on-prem Kubernetes cluster with Oracle’s OpenShift.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/sec3/3-2-auth.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Auth in Enterprise</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/sec3/3-4-ent-pm.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Package Management in the Enterprise</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, Alex K Gold</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/akgold/do4ds" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/alexkgold">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>