<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DevOps for Data Science - 11&nbsp; Basic Linux SysAdmin</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/sec3/3-3-networking.html" rel="next">
<link href="../../chapters/sec3/3-1-cloud.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BTSMMRMH08"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-BTSMMRMH08', { 'anonymize_ip': true});
</script>


</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Basic Linux SysAdmin</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">DevOps for Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/akgold/do4ds" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">Welcome!</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec1/1-0-sec-intro.html" class="sidebar-item-text sidebar-link">DevOps Lessons for Data Science</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-1-code-promotion.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Code promotion and integration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-2-env-as-code.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Environments as Code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-3-data-arch.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Pipeline Architecture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-4-apis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Designing Your Application Layers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec1/1-5-monitor-log.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Logging and Monitoring</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec2/2-0-sec-intro.html" class="sidebar-item-text sidebar-link">IT/Admin Tools</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-1-terminal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Terminal</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-2-ssh.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Connecting Securely with SSH</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-3-cmd-line.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Getting comfortable on the Command Line</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec2/2-4-docker.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Demystifying Docker</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec3/3-0-sec-intro.html" class="sidebar-item-text sidebar-link">IT/Admin for Data Science</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-1-cloud.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Getting Started with the Cloud</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-2-linux-admin.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Basic Linux SysAdmin</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-3-networking.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Intro to Computer Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-4-dns.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">DNS allows for human-readable addresses</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-5-ssl.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">You should use SSL/HTTPS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec3/3-6-servers.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Choosing the right server for you</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sec4/4-0-sec-intro.html" class="sidebar-item-text sidebar-link">Making it Enterprise-Grade</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-1-os-ds-in-ent.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Open Source Data Science in the Enterprise</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-2-ent-networks.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Enterprise Networking</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-3-auth.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Auth in Enterprise</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sec4/4-4-ent-servers.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Enterprise Server Management</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/auth.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Auth Technologies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/append/lab-map.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Lab Map</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#linux-is-an-operating-system-with-a-long-history" id="toc-linux-is-an-operating-system-with-a-long-history" class="nav-link active" data-scroll-target="#linux-is-an-operating-system-with-a-long-history"><span class="toc-section-number">11.1</span>  Linux is an operating system with a long history</a></li>
  <li><a href="#a-tiny-intro-to-linux-administration" id="toc-a-tiny-intro-to-linux-administration" class="nav-link" data-scroll-target="#a-tiny-intro-to-linux-administration"><span class="toc-section-number">11.2</span>  A tiny intro to Linux administration</a></li>
  <li><a href="#managing-who-can-do-what" id="toc-managing-who-can-do-what" class="nav-link" data-scroll-target="#managing-who-can-do-what"><span class="toc-section-number">11.3</span>  Managing who can do what</a>
  <ul class="collapse">
  <li><a href="#file-permissions" id="toc-file-permissions" class="nav-link" data-scroll-target="#file-permissions"><span class="toc-section-number">11.3.1</span>  File Permissions</a></li>
  </ul></li>
  <li><a href="#installing-stuff" id="toc-installing-stuff" class="nav-link" data-scroll-target="#installing-stuff"><span class="toc-section-number">11.4</span>  Installing Stuff</a>
  <ul class="collapse">
  <li><a href="#managing-r-and-python" id="toc-managing-r-and-python" class="nav-link" data-scroll-target="#managing-r-and-python"><span class="toc-section-number">11.4.1</span>  Managing R and Python</a></li>
  </ul></li>
  <li><a href="#debugging-and-troubleshooting" id="toc-debugging-and-troubleshooting" class="nav-link" data-scroll-target="#debugging-and-troubleshooting"><span class="toc-section-number">11.5</span>  Debugging and troubleshooting</a>
  <ul class="collapse">
  <li><a href="#storage" id="toc-storage" class="nav-link" data-scroll-target="#storage"><span class="toc-section-number">11.5.1</span>  Storage</a></li>
  <li><a href="#monitoring-processes" id="toc-monitoring-processes" class="nav-link" data-scroll-target="#monitoring-processes"><span class="toc-section-number">11.5.2</span>  Monitoring processes</a></li>
  <li><a href="#managing-networking" id="toc-managing-networking" class="nav-link" data-scroll-target="#managing-networking"><span class="toc-section-number">11.5.3</span>  Managing networking</a></li>
  <li><a href="#understanding-paths" id="toc-understanding-paths" class="nav-link" data-scroll-target="#understanding-paths"><span class="toc-section-number">11.5.4</span>  Understanding PATHs</a></li>
  </ul></li>
  <li><a href="#comprehension-questions" id="toc-comprehension-questions" class="nav-link" data-scroll-target="#comprehension-questions"><span class="toc-section-number">11.6</span>  Comprehension Questions</a></li>
  <li><a href="#lab-a-working-data-science-workbench" id="toc-lab-a-working-data-science-workbench" class="nav-link" data-scroll-target="#lab-a-working-data-science-workbench"><span class="toc-section-number">11.7</span>  Lab: A working Data Science Workbench</a>
  <ul class="collapse">
  <li><a href="#step-2-create-a-non-root-user" id="toc-step-2-create-a-non-root-user" class="nav-link" data-scroll-target="#step-2-create-a-non-root-user"><span class="toc-section-number">11.7.1</span>  Step 2: Create a non-root user</a></li>
  <li><a href="#step-3-add-an-ssh-key-for-your-user" id="toc-step-3-add-an-ssh-key-for-your-user" class="nav-link" data-scroll-target="#step-3-add-an-ssh-key-for-your-user"><span class="toc-section-number">11.7.2</span>  Step 3: Add an SSH Key for your user</a></li>
  <li><a href="#step-4-install-r" id="toc-step-4-install-r" class="nav-link" data-scroll-target="#step-4-install-r"><span class="toc-section-number">11.7.3</span>  Step 4: Install R</a></li>
  <li><a href="#step-5-install-python" id="toc-step-5-install-python" class="nav-link" data-scroll-target="#step-5-install-python"><span class="toc-section-number">11.7.4</span>  Step 5: Install Python</a></li>
  <li><a href="#step-5-installing-rstudio-server" id="toc-step-5-installing-rstudio-server" class="nav-link" data-scroll-target="#step-5-installing-rstudio-server"><span class="toc-section-number">11.7.5</span>  Step 5: Installing RStudio Server</a></li>
  <li><a href="#step-6-installing-jupyerhub-jupyterlab" id="toc-step-6-installing-jupyerhub-jupyterlab" class="nav-link" data-scroll-target="#step-6-installing-jupyerhub-jupyterlab"><span class="toc-section-number">11.7.6</span>  Step 6: Installing JupyerHub + JupyterLab</a></li>
  <li><a href="#step-7-running-a-plumber-api-in-a-container" id="toc-step-7-running-a-plumber-api-in-a-container" class="nav-link" data-scroll-target="#step-7-running-a-plumber-api-in-a-container"><span class="toc-section-number">11.7.7</span>  Step 7: Running a Plumber API in a Container</a></li>
  <li><a href="#step-8-putting-up-the-shiny-app" id="toc-step-8-putting-up-the-shiny-app" class="nav-link" data-scroll-target="#step-8-putting-up-the-shiny-app"><span class="toc-section-number">11.7.8</span>  Step 8: Putting up the Shiny app</a></li>
  <li><a href="#step-8-check-it-all-out" id="toc-step-8-check-it-all-out" class="nav-link" data-scroll-target="#step-8-check-it-all-out"><span class="toc-section-number">11.7.9</span>  Step 8: Check it all out</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/akgold/do4ds/edit/main/chapters/sec3/3-2-linux-admin.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-linux-admin" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Basic Linux SysAdmin</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Administering a personal computer is something you’re probably already used to. You know how to access files and folders on your computer and install software.</p>
<p>There are three additional wrinkles that come up when you’re administering a server. First, you don’t have a graphical interface. Unlike the administration on your personal computer, where you work through pointing-and-clicking, a server has no such interface.</p>
<p>Second, a server is almost always a multi-user environment. This means from the ground up, the server needs to be designed to serve the needs of several people at once.</p>
<p>You should already know some basics of how to use the Command line from <a href="../sec2/2-3-cmd-line.html">Chapter&nbsp;<span>8</span></a>. In this chapter, we’ll get into what to do to make your server run smoothly.</p>
<p>It’s worth saying that you can make a whole career out of Linux System Administration, so this chapter is going to be really focused on the things you need to know to successfully run a data science environment (and fun asides I feel like sharing).</p>
<p>In the lab for this chapter, we’re going to finally get started with something that is recognizably about data science – we’re going to configure R and Python on our EC2 instance and configure both RStudio Server and JupyterHub. By the end of the chapter you’ll have a running – though still inaccessible – data science workbench.</p>
<section id="linux-is-an-operating-system-with-a-long-history" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="linux-is-an-operating-system-with-a-long-history"><span class="header-section-number">11.1</span> Linux is an operating system with a long history</h2>
<p>A computer’s operating system (OS) defines how applications – like Microsoft Word, RStudio, and Minecraft – interact with the underlying hardware to actually do computation. OSes define how files are stored and accessed, how applications are installed and can connect to networks, and more.</p>
<p>These days, basically all computers run on one of a few different operating systems – Windows, MacOS, or Linux for laptops and desktops; Windows or Linux for servers, Android (a flavor of Linux) or iOS for phones and tablets, and Linux for other kinds of embedded systems (like ATMs and the chips in your car).</p>
<p>When you stand up a server, you’re going to be choosing from one of a few versions of Linux. If you’re unfamiliar with Linux, the number of choices can seem overwhelming, so here’s a quick primer on the history of operating systems. Hopefully it’ll help it all make sense.</p>
<p>Before the early 1970s, the market for computer hardware and software looked nothing like it does now. Computers released in that era had extremely tight linking between hardware and software. There were no standard interfaces between hardware and software, so each hardware manufacturer also had to release the software to use with their machine.</p>
<p>In the early 1970s, Bell Labs released Unix – the first operating system.</p>
<p>Once there was an operating system, the computer market started looking a lot more familiar to 2020s eyes. Hardware manufacturers would build machines that ran Unix and software companies could write applications that ran on Unix. The fact that those applications would run on <em>any</em> Unix machine was a game-changer.</p>
<p>In the 1980s, programmers wanted to be able to work with Unix themselves, but didn’t necessarily want to pay Bell Labs for Unix, so they started writing <em>Unix-like</em> operating systems. Unix-like OSes or Unix clones behaved just like Unix, but didn’t actually include any code from Unix itself.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>In 1991, Linus Torvalds – then a 21 year-old Finnish grad student – released Linux, an open source Unix clone via a amusingly nonchalant newsgroup posting.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>Since then, Linux has seen tremendous adoption. A large majority of the world’s servers run on Linux.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> Along with most of the world’s servers, almost all of the world’s embedded computers – in ATMs, cars and planes, TVs, and most other gadgets and gizmos – run on Linux. If you have an Android phone or a Chromebook – that’s Linux. Basically all of the world’s supercomputers use Linux.</p>
<p>As you might imagine, running Linux in so many different places has necessitated the creation of many different kinds of Linux. For example, a full-featured Linux server is going to require a very different operating system than the barebones operating system running on an ATM with extremely modest computational power.</p>
<p>These different versions are called distributions (<em>distros</em> for short) of Linux. They have a variety of technical attributes and also different licensing models.</p>
<p>Some versions of Linux, like Ubuntu, are completely open source. Others, like Red Hat Enterprise Linux (RHEL), are paid. Most paid Linux OSes have closely-related free and open source versions – like CentOS and Fedora for RHEL.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>Many organizations have a standard Linux distro they use – most often RHEL/CentOS or Ubuntu. Increasingly, organizations deploying in AWS are using Amazon Linux, which is independently maintained by Amazon but was originally a RHEL derivative. There are also some organizations that use SUSE (<a href="https://www.youtube.com/watch?v=nLdexZlVkAY">pronunced soo-suh</a>), which has both open source and enterprise versions.</p>
</section>
<section id="a-tiny-intro-to-linux-administration" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="a-tiny-intro-to-linux-administration"><span class="header-section-number">11.2</span> A tiny intro to Linux administration</h2>
<p>We’ll get into <em>how</em> to administer a Linux server just below, but before we get there, let’s introduce <em>what</em> you’ll be doing as a Linux server admin. There are three main things you’ll manage as a Linux server admin:</p>
<ul>
<li><p><strong>System resources</strong> Each server has a certain amount of resources available. In particular, you’ve got CPU, RAM, and storage. Keeping track of how much you’ve got of these things and how they’re being used – and making sure no one is gobbling up all the resources – is an important part of system administration.</p></li>
<li><p><strong>Networking</strong> Your server is only valuable if you and others can connect to it, so managing how your server can connect to the environment around it is an important part of Linux administration.</p></li>
<li><p><strong>Permissions</strong> Servers generally exist to allow a number of people to access the same machine. Creating users and groups – and managing what they’re allowed to do – is a huge part of server administration.</p></li>
<li><p><strong>Applications</strong> Generally you want to <em>do</em> something with your server, so being able to interact with applications that are running, debug issues, and fix things that aren’t going well is an essential Linux admin skill.</p></li>
</ul>
<p>When you log into a Linux server, you’ll be interacting exclusively via the command line, so all of the commands in this chapter are going to be terminal commands. If you haven’t yet figured out how to open the terminal on your laptop (and gotten it themed and customized so it’s perfect), I’d advise going back to <a href="../sec2/2-3-cmd-line.html">Chapter&nbsp;<span>8</span></a> to get it all configured.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Windows, Mac, and Linux
</div>
</div>
<div class="callout-body-container callout-body">
<p>MacOS is based on BSD, a Unix clone, so any terminal commands you’ve used before on Mac will be very similar to Linux commands.</p>
<p>Windows, on the other hand, is basically the only popular operating system that <em>isn’t</em> a Unix clone. Over time, the Windows command line has gotten more Unix-like, so the differences aren’t as big as they used to be, but there will be some differences in the exact commands that work on Windows vs Linux.</p>
<p>The most obvious difference is the types of slashes used in file paths. Unix-like systems use forward slashes <code>/</code> to denote file hierarchies, while Windows historically uses back slashes <code>\</code>. These days Windows deals just fine with either.</p>
</div>
</div>
</section>
<section id="managing-who-can-do-what" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="managing-who-can-do-what"><span class="header-section-number">11.3</span> Managing who can do what</h2>
<p>Whenever you’re doing something in Linux, you’re doing that thing <em>as</em> a particular user.</p>
<p>On any Unix-like system, you can check your active user at any time with the <code>whoami</code> command. For example, here’s what it looks like on my MacBook.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="ex">❯</span> whoami                                                       </span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="ex">alexkgold</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>whoami</code> returns the <em>username</em> of my user.</p>
<p>Usernames have to be unique on the system – but they’re not the true identifier for a Linux user. A user is uniquely (and permanently) identified by their <em>user id (<code>uid</code>)</em>. All other attributes (including username, password, home directory, groups, and more) are malleable, but <code>uid</code> is forever.</p>
<p>Many of the users on a Linux server correspond to actual humans, but there are more users than that. Most programs that run on a Linux server run as a <em>service account</em> that represent the set of permissions allowed to that program.</p>
<p>For example, installing RStudio Server will create a user with username <code>rstudio-server</code>. Then, when <code>rstudio-server</code> goes to do something – start an <code>R</code> session for example – it will do so <em>as</em> <code>rstudio-server</code>.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
A few details on UIDs
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>uid</code>s are just numbers from 0 to over 2,000,000,000. <code>uid</code>s are assigned by the system at the time the user is created. You should probably keep <code>uid</code>s below 2,000,000 or so if you are ever assigning <code>uid</code>s manually – some programs can’t deal with <code>uid</code>s any bigger.</p>
<p>10,000 is the the lowest <code>uid</code> that’s available for use by a user account. Everything below that is reserved for predefined system accounts or application accounts.</p>
</div>
</div>
<p>In addition to users, Linux has a notion of groups. A group is a collection of users. Each user has exactly one <em>primary</em> group and can be a member of secondary groups.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> By default, each user’s primary group is the same as their username.</p>
<p>Like a user has a <code>uid</code> a group has a <code>gid</code>. User <code>gid</code>s start at 100.</p>
<p>You can see a user’s username, <code>uid</code>, groups, and <code>gid</code> with the <code>id</code> command.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a> <span class="ex">❯</span> id                                                                </span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="va">uid</span><span class="op">=</span>501<span class="kw">(</span><span class="ex">alexkgold</span><span class="kw">)</span> <span class="va">gid</span><span class="op">=</span>20<span class="kw">(</span><span class="ex">staff</span><span class="kw">)</span> <span class="va">groups</span><span class="op">=</span>20<span class="kw">(</span><span class="ex">staff</span><span class="kw">)</span><span class="ex">,12</span><span class="er">(</span><span class="ex">everyone</span><span class="kw">)</span><span class="ex">,61</span><span class="er">(</span><span class="ex">localaccounts</span><span class="kw">)</span><span class="ex">,79</span><span class="er">(</span><span class="ex">_appserverusr</span><span class="kw">)</span><span class="ex">,80</span><span class="er">(</span><span class="ex">admin</span><span class="kw">)</span><span class="ex">,81</span><span class="er">(</span><span class="ex">_appserveradm</span><span class="kw">)</span><span class="ex">,98</span><span class="er">(</span><span class="ex">_lpadmin</span><span class="kw">)</span><span class="ex">,701</span><span class="er">(</span><span class="ex">com.apple.sharepoint.group.1</span><span class="kw">)</span><span class="ex">,33</span><span class="er">(</span><span class="ex">_appstore</span><span class="kw">)</span><span class="ex">,100</span><span class="er">(</span><span class="ex">_lpoperator</span><span class="kw">)</span><span class="ex">,204</span><span class="er">(</span><span class="ex">_developer</span><span class="kw">)</span><span class="ex">,250</span><span class="er">(</span><span class="ex">_analyticsusers</span><span class="kw">)</span><span class="ex">,395</span><span class="er">(</span><span class="ex">com.apple.access_ftp</span><span class="kw">)</span><span class="ex">,398</span><span class="er">(</span><span class="ex">com.apple.access_screensharing</span><span class="kw">)</span><span class="ex">,400</span><span class="er">(</span><span class="ex">com.apple.access_remote_ae</span><span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>On my laptop, I’m a member of a number of different groups.</p>
<p>There’s one extra special user – called the admin, root, sudo, or super user. They get the ultra-cool <code>uid</code> 0. That user has permission to do <em>anything</em> on the system. You almost never want to actually log in as the <code>root</code> user. Instead, you make users and add them to the <code>admin</code> or <code>sudo</code> group so that they have the ability to temporarily assume those admin powers.</p>
<p>The easiest way to make users is with the <code>useradd</code> command. Once you have a user, you may need to change the password, which you can do at any time with the <code>passwd</code> command. Both <code>useradd</code> and <code>passwd</code> start interactive prompts, so you don’t need to do much more than run those commands.</p>
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>What it does</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>su &lt;username&gt;</code></td>
<td>Change to be a different user.</td>
</tr>
<tr class="even">
<td><code>whoami</code></td>
<td>Get username of current user.</td>
</tr>
<tr class="odd">
<td><code>id</code></td>
<td>Get full user + group info on current user.</td>
</tr>
<tr class="even">
<td><code>passwd</code></td>
<td>Change password.</td>
</tr>
<tr class="odd">
<td><code>useradd</code></td>
<td>Add a new user.</td>
</tr>
</tbody>
</table>
<section id="file-permissions" class="level3" data-number="11.3.1">
<h3 data-number="11.3.1" class="anchored" data-anchor-id="file-permissions"><span class="header-section-number">11.3.1</span> File Permissions</h3>
<p>Every object in Linux is just a file. Every log – file. Every picture – file. Every program – file. Every system setting – file.</p>
<p>So determining whether a user can take a particular action is really a question of whether they have the right permissions on a particular file.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The question of who’s allowed to do what – authorization – is an extremely deep one. There’s a chapter all about authorization, how it differs from authentication, and the different ways your IT/Admins might want to manage it <a href="sec4/4-3auth">later in the book</a>.</p>
<p>This is just going to be a high-level overview of basic Linux authorization.</p>
</div>
</div>
<p>There are three permissions you can have: read, write, and execute. Read means you’re allowed to see the contents of a file, write means you can save a changed version of a file, and execute means you’re allowed to run the file as a program.</p>
<p>The execute permission really only makes sense for some kinds of files - what would it mean to execute a csv file? But Linux doesn’t care – you can assign any combination of these three permissions for any file.</p>
<p>How are these permissions assigned? Every file has an owner and an owning group.</p>
<p>So you can think of permissions in Linux as being assigned in a 3x3 grid. The owner, the owning group, and everyone else can have permissions to read, write, or execute the file.</p>
<p>TODO: change to graphic</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>Owner</th>
<th>Group</th>
<th>Everyone Else</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Read</strong></td>
<td>✅/❌</td>
<td>✅/❌</td>
<td>✅/❌</td>
</tr>
<tr class="even">
<td><strong>Write</strong></td>
<td>✅/❌</td>
<td>✅/❌</td>
<td>✅/❌</td>
</tr>
<tr class="odd">
<td><strong>Execute</strong></td>
<td>✅/❌</td>
<td>✅/❌</td>
<td>✅/❌</td>
</tr>
</tbody>
</table>
<p>To understand better, let’s look at the permissions on an actual file.</p>
<p>Running <code>ls -l</code> on a directory gives you the list of files in that directory, along with their permissions. The first few columns of the list give you the full set of file permissions – though they can be a little tricky to read.</p>
<p>So, for example, here’s a few lines of the output of running <code>ls -l</code> on a python project I have.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="ex">❯</span> ls <span class="at">-l</span>                                                           </span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="ex">-rw-r--r--</span>  1 alexkgold  staff     28 Oct 30 11:05 config.py</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="ex">-rw-r--r--</span>  1 alexkgold  staff   2330 May  8  2017 credentials.json</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="ex">-rw-r--r--</span>  1 alexkgold  staff   1083 May  8  2017 main.py</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="ex">drwxr-xr-x</span> 33 alexkgold  staff   1056 May 24 13:08 tests</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This readout has the file permissions (a series of ten characters), followed by a number<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>, then the file’s owner, and the file’s group. Let’s learn how to read these.</p>
<p>The file’s owner and group are the easiest to understand. In this case, I <code>alexkgold</code> own all the files, and the group of all the files is <code>staff</code>.</p>
<p>The ten-character file permissions are relative to that user and group.</p>
<p>The first character indicates the type of file: <code>-</code> for normal and <code>d</code> for a directory.</p>
<p>The next nine characters are indicators for the three permissions – <code>r</code> for read, <code>w</code> for write, and <code>x</code> for execute (or <code>-</code> for in place of any of those for not) – first for the user, then for the group, then for any other user on the system.</p>
<p>So, for example, my <code>config.py</code> file with permissions of <code>rw-r-r--</code> indicates the user (<code>alexkgold</code>) can read and write the file, and everyone else – including in the file’s group <code>staff</code> – has read-only permission.</p>
<p>In the course of administering a server, you will probably need to change a file’s permissions. You can do so using the <code>chmod</code> command.</p>
<p>For <code>chmod</code>, permissions are indicated with only three numbers – one for the user, one for the group, and one for everyone else. The way this works is pretty clever – you just sum up the permissions as follows: 4 for read, 2 for write, and 1 for execute. You can check for yourself, but any set of permissions can be uniquely identified by a number between 1 and 7.<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></p>
<p>So <code>chmod 765 &lt;filename&gt;</code> would give the user full permissions (4 + 2 + 1), read and write (4 + 2) to the group, and read and execute (4 + 1) to everyone else. This would be a strange set of permissions to give a file, but it’s a perfectly valid <code>chmod</code> command.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you spend any time administering a Linux server, you almost certainly will at some point find yourself running into a problem and applying <code>chmod 777</code> out of frustration to rule out a permissions issue.</p>
<p>I can’t in good faith tell you not to do this – we’ve all been there. But if it’s something important, be sure you change it back once you’re finished figuring out what’s going on.</p>
</div>
</div>
<p>In some cases you might actually want to <strong>ch</strong>ange the <strong>own</strong>er or group of a file. You can change users or groups with either names or ids. You can do so using the <code>chown</code> command. If you’re changing the group, the group name gets prefixed with a colon.</p>
<p>In some cases, you might not be the correct user to take a particular action. You might not want to change the file permissions, but instead to change who <em>you</em> are. In that case, you can <strong>s</strong>witch <strong>u</strong>sers with the <code>su</code> command.</p>
<p>Some actions are also reserved for the admin user. For example, let’s take a look at this configuration file:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a> <span class="ex">❯</span> ls <span class="at">-l</span> /etc/config/my-config                      </span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="ex">-rw-r--r--</span>  1 root  system  4954 Dec  2 06:37 config.conf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As you can see, all users can read this file to check the configuration settings. But this file is owned by <code>root</code>, and only the owner has <code>write</code> permissions. So I could run <code>cat config.conf</code> to see it. Or I could go into it with <code>vim config.conf</code>, but I’d find myself stuck if I wanted to make changes.</p>
<p>So if I want to change this configuration file, I’d need to temporarily assume my root powers to make changes. Instead of switching to be the root user, I would run <code>sudo vim config.conf</code> and open the file for editing with root permissions.</p>
<table class="table">
<colgroup>
<col style="width: 31%">
<col style="width: 23%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>What it does</th>
<th>Helpful options + notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>c h m o d &lt; permissions&gt; &lt;file&gt;</code></td>
<td>Modifies permissions on a file.</td>
<td>Number indicates permissions for user, group, others: add 4 for read, 2 for write, 1 for execute, 0 for nothing.</td>
</tr>
<tr class="even">
<td><code>c h o w n &lt;user/group&gt; &lt;file&gt;</code></td>
<td>Change the owner of a file.</td>
<td>Can be used for user or group, e.g. <code>:my-group</code>.</td>
</tr>
<tr class="odd">
<td><code>su &lt;username&gt;</code></td>
<td>Change active user.</td>
<td></td>
</tr>
<tr class="even">
<td><code>sudo &lt;command&gt;</code></td>
<td>Adopt super user permissions for the following command.</td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="installing-stuff" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="installing-stuff"><span class="header-section-number">11.4</span> Installing Stuff</h2>
<p>There are several different ways to install programs for Linux, and you’ll see a few of them throughout this book.</p>
<p>Just as CRAN and PyPI are repositories for R and Python packages, Linux distros also have their own repositories. For Ubuntu, the <code>apt</code> command is used for accessing and installing <code>.deb</code> files from the Ubuntu repositories. For CentOS and RedHat, the <code>yum</code> command is used for installing <code>.rpm</code> files.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The examples below are all for Ubuntu, since that’s what we use in the lab for this book. Conceptually, using <code>yum</code> is very similar, though the exact commands differ somewhat.</p>
</div>
</div>
<p>When you’re installing packages in Ubuntu, you’ll often see commands prefixed with <code>apt-get update &amp;&amp; apt-get upgrade y</code>. This command makes your machine update the list of available packages it knows about on the server and upgrade everything to the latest version.</p>
<p>Packages are installed with <code>apt-get install &lt;package&gt;</code>. Depending on which user you are, you may need to prefix the command with <code>sudo</code>.</p>
<p>You can also install packages that aren’t from the central package repository. Doing that will generally involve downloading a file directly from a URL – usually with <code>wget</code> and then installing it from the file you’ve downloaded – often with the <code>gdebi</code> command.</p>
<table class="table">
<colgroup>
<col style="width: 45%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>What it does</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>a p t - g e t  update  &amp;&amp; apt-get upgrade y</code></td>
<td>Fetch and install upgrades to system packages</td>
</tr>
<tr class="even">
<td><code>apt-get install &lt;package&gt;</code></td>
<td>Install a system package.</td>
</tr>
<tr class="odd">
<td><code>wget</code></td>
<td>Download a file from a URL.</td>
</tr>
<tr class="even">
<td><code>gdebi</code></td>
<td>Install local <code>.deb</code> file.</td>
</tr>
</tbody>
</table>
<section id="managing-r-and-python" class="level3" data-number="11.4.1">
<h3 data-number="11.4.1" class="anchored" data-anchor-id="managing-r-and-python"><span class="header-section-number">11.4.1</span> Managing R and Python</h3>
<p>As the admin of a data science server, managing R and Python installations is a central task you’ll have to do, as well as installing software on top of that like RStudio Server, JupyterHub, and/or Shiny Server. While R and Python are both open source data science languages, the way you’ll have to administer them are pretty different.</p>
<p>People pretty much only ever install R to do data science. In contrast, Python is one of the world’s most popular programming languages for general purpose computing. Contrary to what you might think, this actually makes configuring Python <em>harder</em> than configuring R.</p>
<p>The reason is that your system comes with a version of Python installed, but we don’t want to use that version. Given the centrality of that version to normal server operations, we want to leave it alone. It turns out that installing one or more other versions of Python and then ignoring the system version of Python isn’t totally trivial to do. Then we’re going to want to create a standalone virtual environment that’s just for running JupyterHub so it doesn’t get messed up later.</p>
<p>RStudio and R are system libraries. So when RStudio runs, it calls and owns the R process that you’ll use inside RStudio Server. In contrast, JupyterHub and JupyterLab <em>are</em> Python programs, so we install them inside a Python installation.</p>
<p>TODO: diagram of relationships of system python, DS python, Jupyter Python.</p>
</section>
</section>
<section id="debugging-and-troubleshooting" class="level2" data-number="11.5">
<h2 data-number="11.5" class="anchored" data-anchor-id="debugging-and-troubleshooting"><span class="header-section-number">11.5</span> Debugging and troubleshooting</h2>
<p>There are three main resources you’ll need to manage as the server admin – CPU, RAM, and storage space. There’s more on all three of these and how to make sure you’ve got enough in <a href="3-6-servers.html">Chapter&nbsp;<span>15</span></a>.</p>
<p>For now, we’re just going to go over how to check how much you’ve got, how much you’re using, and getting rid of stuff that’s misbehaving.</p>
<section id="storage" class="level3" data-number="11.5.1">
<h3 data-number="11.5.1" class="anchored" data-anchor-id="storage"><span class="header-section-number">11.5.1</span> Storage</h3>
<p>A common culprit for weird server behavior is running out of storage space. There are two handy commands for monitoring the amount of storage you’ve got – <code>du</code> and <code>df</code>. These commands are almost always used with the <code>-h</code> flag to put file sizes in human-readable formats.</p>
<p><code>du</code>, short for <strong>d</strong>isk <strong>u</strong>sage, gives you the size of individual files inside a directory. This can be helpful for finding your largest files or directories if you think you might need to clean up things. It’s particularly useful in combination with the <code>sort</code> command.</p>
<p>For example, here’s the result of running <code>du</code> on the <code>chapters</code> directory where the text files for this book live.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a> <span class="ex">❯</span> du <span class="at">-h</span> chapters <span class="kw">|</span> <span class="fu">sort</span> <span class="at">-h</span>                                      </span>
<span id="cb5-2"><a href="#cb5-2"></a> <span class="ex">44K</span>    chapters/sec2/images-servers</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="ex">124K</span>    chapters/sec3/images-scaling</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="ex">156K</span>    chapters/sec2/images</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="ex">428K</span>    chapters/sec2/images-traffic</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="ex">656K</span>    chapters/sec1/images-code-promotion</span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="ex">664K</span>    chapters/sec1/images-docker</span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="ex">1.9M</span>    chapters/sec1/images-repro</span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="ex">3.4M</span>    chapters/sec1</span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="ex">3.9M</span>    chapters/sec3/images-auth</span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="ex">4.1M</span>    chapters/sec3</span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="ex">4.5M</span>    chapters/sec2/images-networking</span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="ex">5.3M</span>    chapters/sec2</span>
<span id="cb5-14"><a href="#cb5-14"></a> <span class="ex">13M</span>    chapters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So if I were thinking about cleaning up this directory, I could see that my <code>images-networking</code> directory in <code>sec2</code> is the biggest single bottom-level directory. If you find yourself needing to find big files on your Linux server, it’s worth spending some time with the help pages for <code>du</code>. There are lots of really useful options.</p>
<p><code>du</code> is useful for identifying large files and directories on a server. <code>df</code>, for <strong>d</strong>isk <strong>f</strong>ree, is useful for diagnosing issues that might be a problem for a directory. If you’re struggling to write into a directory – perhaps getting out of space errors, <code>df</code> can help you diagnose.</p>
<p><code>df</code> answers the question – given a file or directory, what device is it mounted on and how full is that device?</p>
<p>So here’s the result of running the <code>df</code> command on that same <code>chapters</code> directory.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a> <span class="ex">❯</span> df <span class="at">-h</span> chapters                                                    </span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="ex">Filesystem</span>     Size   Used  Avail Capacity iused      ifree %iused  Mounted on</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="ex">/dev/disk3s5</span>  926Gi  163Gi  750Gi    18% 1205880 7863468480    0%   /System/Volumes/Data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So you can see that the chapters folder lives on a disk called <code>/dev/disk3s5</code> that’s a little less than 1Tb and is 18% full – no problem. On a server this can be really useful to know, because it’s quite easy to switch a disk out for a bigger one in the same spot.</p>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>C ommand</th>
<th>What it does</th>
<th>H elpful o ptions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>du</code></td>
<td>Check size of files.</td>
<td><p>Most likely to be used <code>d u  -h &lt;d  i r &gt;  | s o rt -h</code> [^3 -2-l in u x - a d m in-9]</p>
<p>Also useful to c ombine with <code>head</code>.</p></td>
</tr>
<tr class="even">
<td><code>df</code></td>
<td>Check s torage space on d evice.</td>
<td><code>-h</code></td>
</tr>
</tbody>
</table>
</section>
<section id="monitoring-processes" class="level3" data-number="11.5.2">
<h3 data-number="11.5.2" class="anchored" data-anchor-id="monitoring-processes"><span class="header-section-number">11.5.2</span> Monitoring processes</h3>
<p>Every program your computer runs is a process. For example, when you type <code>python</code> on the command line to open a REPL, that’s a process. Running more complicated programs usually involves more than one process.</p>
<p>For example, running RStudio involves (at minimum) one process for the IDE itself and one for the R session that it uses in the background. The relationships between these different processes is mostly hidden from you – the end user.</p>
<p>As a server admin, finding runaway processes, killing them, and figuring out how to prevent the them from happening again is a pretty common task. Runaway processes usually misbehave by using up the entire CPU, filling up the entire machine’s RAM.</p>
<p>Like users and groups have ids, each process has a numeric <strong>p</strong>rocess <strong>id</strong> (<code>pid</code>). Each process also has an owner – this can be either a service account or a real user. If you’ve got a rogue process, the pattern is to try to find the process and make note of its <code>pid</code>. Then you can immediately end the process by <code>pid</code> with the <code>kill</code> command.</p>
<p>So, how do you find a troublesome process?</p>
<p>The <code>top</code> command is a good first stop. <code>top</code> shows the top CPU-consuming processes in real time. Here’s the <code>top</code> output from my machine as I write this sentence.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a><span class="ex">PID</span>    COMMAND      %CPU TIME     <span class="co">#TH    #WQ  #PORT MEM    PURG   CMPRS PGRP</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="ex">0</span>      kernel_task  16.1 03:56:53 530/10 0    0     2272K  0B     0B    0</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="ex">16329</span>  WindowServer 16.0 01:53:20 23     6    3717  941M-  16M+   124M  16329</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="ex">24484</span>  iTerm2       11.3 00:38.20 5      2    266-  71M-   128K   18M-  24484</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="ex">29519</span>  top          9.7  00:04.30 1/1    0    36    9729K  0B     0B    29519</span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="ex">16795</span>  Magnet       3.1  00:39.16 3      1    206   82M    0B     39M   16795</span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="ex">16934</span>  Arc          1.8  18:18.49 45     6    938   310M   144K   61M   16934</span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="ex">16456</span>  Messages     1.7  06:58.27 4      1    603   138M   2752K  63M   16456</span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="ex">1</span>      launchd      1.7  13:41.03 4/1    3/1  3394+ 29M    0B     6080K 1</span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="ex">573</span>    diagnosticd  1.4  04:31.97 3      2    49    2417K  0B     816K  573</span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="ex">16459</span>  zoom.us      1.3  66:38.37 30     3    2148  214M   384K   125M  16459</span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="ex">16575</span>  UniversalCon 1.3  01:15.89 2      1    131   12M    0B     2704K 16575</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In most instances, the first three columns are the most useful. You’ve got the name of the command and how much CPU they’re using. Right now, nothing is using very much CPU. If I were to find something concerning – perhaps an R process that is using 500% of CPU – I would want to take notice of its <code>pid</code> to kill it with <code>kill</code>.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
So much CPU?
</div>
</div>
<div class="callout-body-container callout-body">
<p>For <code>top</code> (and most other commands), CPU is expressed as a percent of <em>single core</em> availability. So, on a modern machine (with multiple cores), it’s very common to see CPU totals well over 100%. Seeing a single process using over 100% of CPU is rarer.</p>
</div>
</div>
<p>The <code>top</code> command takes over your whole terminal. You can exit with <code>Ctrl + c</code>.</p>
<p>Another useful command for finding runaway processes is <code>ps aux</code>.<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a> It lists all processes currently running on the system, along with how much CPU and RAM they’re using. You can sort the output with the <code>--sort</code> flag and specify sorting by cpu with <code>--sort -%cpu</code> or by memory with <code>--sort -%mem</code>.</p>
<p>Because <code>ps aux</code> returns <em>every</em> running process on the system, you’ll probably want to pipe the output into <code>head</code>.</p>
<p>Another useful way to use <code>ps aux</code> is in combination with <code>grep</code>. If you pretty much know what the problem is – often this might be a runaway R or Python process – <code>ps aux | grep &lt;name&gt;</code> can be super useful to get the <code>pid</code>.</p>
<p>For example, here are the RStudio processes currently running on my system.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1"></a> <span class="op">&gt;</span> ps <span class="ex">aux</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">"RStudio\|USER"</span>                                                                                      [10:21:18]</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="ex">USER</span>               PID  %CPU %MEM      VSZ    RSS   TT  STAT STARTED      TIME COMMAND</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="ex">alexkgold</span>        23583   0.9  1.7 37513368 564880   <span class="pp">??</span>  S    Sat09AM  17:15.27 /Applications/RStudio.app/Contents/MacOS/RStudio</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="ex">alexkgold</span>        23605   0.5  0.4 36134976 150828   <span class="pp">??</span>  S    Sat09AM   1:58.16 /Applications/RStudio.app/Contents/MacOS/rsession <span class="at">--config-file</span> none <span class="at">--program-mode</span> desktop </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>grep</code> command above looks a little weird because I used a little trick. I wanted to keep the header in the output, so the regex I used matches both the header line (<code>USER</code>) and the thing I actually care about (<code>RStudio</code>).</p>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 23%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>What it does</th>
<th>Helpful options</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>top</code></td>
<td>See what’s running on the system.</td>
<td></td>
</tr>
<tr class="even">
<td><code>ps aux</code></td>
<td>See all system processes.</td>
<td>Consider using <code>--sort</code> and pipe into <code>head</code> or <code>grep</code></td>
</tr>
<tr class="odd">
<td><code>kill</code></td>
<td>Kill a system process.</td>
<td><code>-9</code> to force kill immediately</td>
</tr>
</tbody>
</table>
</section>
<section id="managing-networking" class="level3" data-number="11.5.3">
<h3 data-number="11.5.3" class="anchored" data-anchor-id="managing-networking"><span class="header-section-number">11.5.3</span> Managing networking</h3>
<p>Networking is a complicated topic, which we’ll approach with great detail in <a href="3-3-networking.html">Chapter&nbsp;<span>12</span></a>. For now, it’s important to be able to see what’s running on your server that is accessible from the outside world on a particular port.</p>
<p>The main command to help you see what ports are being used and by what services is the <code>netstat</code> command. <code>netstat</code> returns the services that are running and their associated ports. <code>netstat</code> is generally most useful with the <code>-tlp</code> flags to show programs that are listening and the programs associated.</p>
<p>TODO: get netstat example</p>
<table class="table">
<colgroup>
<col style="width: 22%">
<col style="width: 22%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>What it does</th>
<th>Helpful options</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>netstat</code></td>
<td>See ports and services using them.</td>
<td>Usually used with <code>-tlp</code></td>
</tr>
</tbody>
</table>
<p>Sometimes you <em>know</em> you’ve got a service running on your machine, but you just can’t seem to get the networking working. It can be useful to access the service directly without having to deal with networking. You can do this with port forwarding, also called tunneling.</p>
<p>SSH port forwarding allows you to take the output of a port on a remote server, route it through SSH, and display it <em>as if</em> it were on a local port. For example, let’s say I’ve got RStudio Server running on my server. Maybe I don’t have networking set up yet, or I just can’t get it working. If I’ve got SSH to my server working properly, I can double check that the service is working as I expect and the issue really is somewhere in the network.</p>
<p>I find that the syntax for port forwarding completely defies my memory and I have to google it every time I use it. For the kind of port forwarding you’ll use most often in debugging, you’ll use the <code>-L</code> flag.</p>
<p><code>ssh -L &lt;local port&gt;:&lt;remote ip&gt;:&lt;remote port&gt; &lt;ssh hostname&gt;</code></p>
<p>When you’re doing ssh forwarding, <code>local</code> is the place you’re ssh-ed into (aka your server) and the <code>remote</code> is another location – usually your laptop.</p>
<p>Since the “remote” is my laptop, I almost always want to use <code>localhost</code> as the remote IP, and I usually want to use the same port remotely and locally – unless the local service is on a reserved port.</p>
<p>So let’s say I’ve got RStudio Server running on my server at my-ds-workbench.com on port <code>3939</code>. Then I could run <code>ssh -L 3939:localhost:3939 my-user@my-ds-workbench.com</code>. With this command, I can bypass networking and just access whatever is at port 3939 on my server (hopefully RStudio Workbench!) by just going to <code>localhost:3939</code> in my laptop’s browser.</p>
</section>
<section id="understanding-paths" class="level3" data-number="11.5.4">
<h3 data-number="11.5.4" class="anchored" data-anchor-id="understanding-paths"><span class="header-section-number">11.5.4</span> Understanding PATHs</h3>
<p>Let’s say you want to open R on your command line. Once you’ve got everything properly configured, you can just type <code>R</code> and have it open right up.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1"></a> <span class="ex">❯</span> R                                                       </span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="ex">R</span> version 4.2.0 <span class="er">(</span><span class="ex">2022-04-22</span><span class="kw">)</span> <span class="ex">--</span> <span class="st">"Vigorous Calisthenics"</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="ex">Copyright</span> <span class="er">(</span><span class="ex">C</span><span class="kw">)</span> <span class="ex">2022</span> The R Foundation for Statistical Computing</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="ex">Platform:</span> x86_64-apple-darwin17.0 <span class="er">(</span><span class="ex">64-bit</span><span class="kw">)</span></span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="ex">R</span> is free software and comes with ABSOLUTELY NO WARRANTY.</span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="ex">You</span> are welcome to redistribute it under certain conditions.</span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="ex">Type</span> <span class="st">'license()'</span> or <span class="st">'licence()'</span> for distribution details.</span>
<span id="cb9-10"><a href="#cb9-10"></a></span>
<span id="cb9-11"><a href="#cb9-11"></a>  <span class="ex">Natural</span> language support but running in an English locale</span>
<span id="cb9-12"><a href="#cb9-12"></a></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="ex">R</span> is a collaborative project with many contributors.</span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="ex">Type</span> <span class="st">'contributors()'</span> for more information and</span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="st">'citation()'</span> on how to cite R or R packages in publications.</span>
<span id="cb9-16"><a href="#cb9-16"></a></span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="ex">Type</span> <span class="st">'demo()'</span> for some demos, <span class="st">'help()'</span> for on-line help, or</span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="st">'help.start()'</span> for an HTML browser interface to help.</span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="ex">Type</span> <span class="st">'q()'</span> to quit R.</span>
<span id="cb9-20"><a href="#cb9-20"></a></span>
<span id="cb9-21"><a href="#cb9-21"></a><span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>But how does the operating system know what you mean when you type <code>R</code>? If you’ve been reading carefully, you’ve realized that running the command means opening a particular runnable file, and <code>R</code> isn’t a file path on my system.</p>
<p>You can actually just type the complete filename of a runnable binary into your command line. For example, on my MacBook, my version of R is at <code>/usr/bin/local/R</code>, so I could open an R session by typing that full path. Sometimes it can be handy to be precise about exactly which executable you’re opening (I’m looking at you, multiple versions of Python), so you may want to use full paths to executables.</p>
<p>If you ever want to check which actual executable is being used by a command, you can use the <code>which</code> command. For example, on my system this is the result of <code>which R</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1"></a> <span class="ex">❯</span> which R                                                    </span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="ex">/usr/local/bin/R</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Most of the time you don’t want to have to bother with full paths for executables. You want to just type <code>R</code> on the command line and have R open. Moreover, there are cases where functionality relies on another executable being able to find R and run it – think of running RStudio Server, which starts a version of R under the hood.</p>
<p>The operating system knows how to find the actual runnable programs on your system via something called the <em>path</em>. When you type <code>R</code> into the command line, it searches along the path to find a version of R it can run.</p>
<p>You can check your path at any time by echoing the <code>PATH</code> environment variable with <code>echo $PATH</code>. On my MacBook, this is what the path looks like.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1"></a> <span class="ex">❯</span> echo <span class="va">$PATH</span>                                                      </span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="ex">/opt/homebrew/bin:/opt/homebrew/sbin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Later, when we get into running versions of programs that aren’t the system versions, we may have to append locations to the path so that we can run them easily.</p>
</section>
</section>
<section id="comprehension-questions" class="level2" data-number="11.6">
<h2 data-number="11.6" class="anchored" data-anchor-id="comprehension-questions"><span class="header-section-number">11.6</span> Comprehension Questions</h2>
<ol type="1">
<li>Create a mind map of the following terms: Operating System, Windows, MacOS, Unix, Linux, Distro, Ubuntu</li>
<li>When you initially SSH-ed into your server using <code>ubuntu@$SERVER_ADDRESS</code>, what user were you and what directory did you enter? What about when you used <code>test_user@$SERVER_ADDRESS</code>?</li>
<li>What are the 3x3 options for Linux file permissions? How are they indicated in an <code>ls -l</code> command?</li>
<li>How would you do the following?
<ol type="1">
<li><p>Find and kill the process IDs for all running <code>rstudio-server</code> processes.</p></li>
<li><p>Figure out which port <code>JupyterHub</code> is running on.</p></li>
<li><p>Create a file called <code>secrets.txt</code>, open it with vim, write something in, close and save it, and make it so that only you can read it.</p></li>
</ol></li>
</ol>
</section>
<section id="lab-a-working-data-science-workbench" class="level2" data-number="11.7">
<h2 data-number="11.7" class="anchored" data-anchor-id="lab-a-working-data-science-workbench"><span class="header-section-number">11.7</span> Lab: A working Data Science Workbench</h2>
<p>In the last chapter’s lab, we set up a bare Ubuntu server in AWS. In this chapter, we’re going to make that server into a data science workbench. By the end of this chapter, you’ll have a functional data science workbench - though it won’t yet be accessible to the outside world.</p>
<section id="step-1-log-on-with-the-.pem-key" class="level4" data-number="11.7.0.1">
<h4 data-number="11.7.0.1" class="anchored" data-anchor-id="step-1-log-on-with-the-.pem-key"><span class="header-section-number">11.7.0.1</span> Step 1: Log on with the <code>.pem</code> key</h4>
<p>The <code>.pem</code> key you downloaded when you set up the server is the skeleton key – it will automatically let you in with complete admin privileges. We’re going to use the <code>.pem</code> key to get started on the server, but be extremely careful with the power of the <code>.pem</code> key.</p>
<p>Because the keypair is so powerful, AWS requires that you restrict the access pretty severely. If you try to use the keypair without first changing the permissions, you’ll be unable to, and you’ll get a warning that looks something like this:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1"></a></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="ex">\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@</span></span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="ex">\@</span> WARNING: UNPROTECTED PRIVATE KEY FILE! <span class="dt">\@</span></span>
<span id="cb12-5"><a href="#cb12-5"></a></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="ex">\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@\@</span></span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="ex">Permissions</span> 0644 for <span class="st">'do4ds-lab-key.pem'</span> are too open.</span>
<span id="cb12-9"><a href="#cb12-9"></a></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="ex">It</span> is required that your private key files are NOT accessible by others.</span>
<span id="cb12-11"><a href="#cb12-11"></a></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="ex">This</span> private key will be ignored.</span>
<span id="cb12-13"><a href="#cb12-13"></a></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="ex">Load</span> key <span class="st">"do4ds-lab-key.pem"</span>: bad permissions</span>
<span id="cb12-15"><a href="#cb12-15"></a></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="ex">ubuntu\@ec2-54-159-134-39.compute-1.amazonaws.com:</span> Permission denied <span class="er">(</span><span class="ex">publickey</span><span class="kw">)</span><span class="bu">.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Before we can use it to open the server, we’ll need to change the permissions so that only the user can use it. We’re going to give the key <code>600</code> permissions. If you recall from above, that means that the user can read and write the file and no one else can access.</p>
<p>On my machine, changing the key goes like this:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1"></a><span class="bu">cd</span> ~/Documents/do4ds-lab</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="fu">chmod</span> 600 do4ds-lab-key.pem</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In your terminal type the following</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">ssh</span> <span class="at">-i</span> do4ds-lab-key.pem <span class="dt">\</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  ubuntu@<span class="va">$SERVER_ADDRESS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Type <code>yes</code> when prompted, and you’re now logged in to your server!</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
SSH on Windows
</div>
</div>
<div class="callout-body-container callout-body">
<p>For a long time, Windows didn’t come with a built in SSH client, so you had to use PuTTY to do SSH from a Windows machine. Microsoft brought a native SSH client to Windows 10 in 2015, and it has been enabled by default since 2018.</p>
<p>If you run into any trouble using SSH commands on Windows, double check that you’ve enabled the <code>OpenSSH Client</code>.</p>
</div>
</div>
</section>
<section id="step-2-create-a-non-root-user" class="level3" data-number="11.7.1">
<h3 data-number="11.7.1" class="anchored" data-anchor-id="step-2-create-a-non-root-user"><span class="header-section-number">11.7.1</span> Step 2: Create a non-root user</h3>
<p>The first thing we’re going to do is create a user so that you can login without running as root all the time. In general, if you’ve got a multitenant server, you’re going to want users for each actual human who’s accessing the system.</p>
<p>I’m going to use the username <code>test-user</code>. If you want to be able to copy/paste commands from the online book, I’d advise doing the same. If you were creating users based on real humans, I’d advise using their names.</p>
<p>Let’s create a user using the <code>adduser</code> command. This will walk us through a set of prompts to create a new user with a home directory and a password. Feel free to add any information you want – or to leave it blank – when prompted.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">sudo</span> adduser test-user</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We want this new user to be able to adopt root privileges. Remember that the way that is determined is whether the user is part of the <code>sudo</code> group. Here’s the command you’ll need to make it so.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">sudo</span> usermod <span class="at">-aG</span> sudo test-user</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-3-add-an-ssh-key-for-your-user" class="level3" data-number="11.7.2">
<h3 data-number="11.7.2" class="anchored" data-anchor-id="step-3-add-an-ssh-key-for-your-user"><span class="header-section-number">11.7.2</span> Step 3: Add an SSH Key for your user</h3>
<p>The first thing you should do is check if you have an SSH key on your laptop. You’ll need to open a different terminal window or tab than the one that’s SSH-ed into your server and try <code>ls ~/.ssh</code>.</p>
<p>If you’ve got one already, I’d recommend just using that key so you don’t have to mess around with multiple keys. If you don’t have one, google how to create an SSH key and do it on your laptop. If you’re not really sure what an SSH key is, I’d recommend re-reading <a href="../sec2/2-2-ssh.html">Chapter&nbsp;<span>7</span></a>.</p>
<p>Once you’ve got an SSH key, we’re going to add it to the <code>authorized_users</code> for our user on the server.</p>
<p>First, you need to get your public key to the server. I recommend using <code>scp</code>.<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a></p>
<p>You’ll need to check that your <code>SERVER_ADDRESS</code> variable is still set using <code>echo $SERVER_ADDRESS</code>. If it’s not set, you’ll have to re-set it to be the public IPv4 from your server.</p>
<p>For me, the command looks like this</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">scp</span> <span class="at">-i</span> ~/Documents/do4ds-lab/do4ds-lab-key.pem ~/.ssh/id_ed25519.pub ubuntu@<span class="va">$SERVER_ADDRESS</span>:/home/ubuntu </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You may need to change the file paths to either your server’s <code>pem</code> key or your SSH key if they’re not in the same locations as mine.</p>
<p>Now our public key is on the server, but it’s in the <code>ubuntu</code> user’s home directory. We’re going to add it as an authorized key for the <code>test-user</code> so that we can SSH in as that user.</p>
<p>Let’s go back to the tab that’s open to the SSH connection to our server.</p>
<p>Here are the commands to do so:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">su</span> test-user <span class="co">#change user</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="bu">cd</span> ~ <span class="co"># move to home directory</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="fu">mkdir</span> <span class="at">-p</span> .ssh <span class="co"># create .ssh directory</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="fu">sudo</span> mv /home/ubuntu/id_ed25519.pub ./.ssh <span class="co"># move key into .ssh </span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="fu">sudo</span> chown test-user:test-user ~/.ssh/id_ed25519.pub <span class="co"># take ownership of key</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="fu">chmod</span> 700 .ssh <span class="co"># Lock directory from other users</span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="fu">cat</span> .ssh/id_ed25519.pub <span class="op">&gt;</span> .ssh/authorized_keys <span class="co">#add public key to end of authorized_keys file</span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="fu">chmod</span> 600 .ssh/authorized_keys <span class="co">#set permissions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we’re all set up with SSH, and you can log in as a normal user from your laptop just using <code>ssh test-user@$SERVER_ADDRESS</code>.</p>
<p>If you want to set up an SSH config for this server, I’d advise waiting until we’ve got a permanent URL for it in the next chapter.</p>
<p>Now that we’re all set up, you should store the <code>pem</code> key somewhere safe and never use it to log in again.</p>
<p>When you ever want to exit SSH and get back to your machine, you can just type <code>exit</code>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you run into trouble assuming <code>sudo</code> with your new user, try exiting SSH and coming back. Sometimes these changes aren’t picked up until you restart the shell.</p>
</div>
</div>
</section>
<section id="step-4-install-r" class="level3" data-number="11.7.3">
<h3 data-number="11.7.3" class="anchored" data-anchor-id="step-4-install-r"><span class="header-section-number">11.7.3</span> Step 4: Install R</h3>
<p>Everything until now has been generic server administration. Now let’s get into some data-science-specific work – setting up R and Python.</p>
<p>There are a number of ways to install R on your server including installing it from source, from the system repository, or using R-specific tooling.</p>
<p>You can use the system repository version of R, but then you just get whatever version of R happens to be current when you run <code>sudo apt-get install R</code>. My preferred option is to use <code>rig</code>, which is an R-specific installation manager.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>As of this writing, <code>rig</code> only supports Ubuntu. If you want to install on a different Linux distro, you will have to install R a different way.</p>
</div>
</div>
<p>There are good instructions on downloading <code>rig</code> and using it to install R on the <a href="https://github.com/r-lib/rig"><code>rlib/rig</code> GitHub repo</a>. Use those instructions to install the current R release on your AWS server.</p>
<p>Once you’ve installed R on your server, you can check that it’s running by just typing <code>R</code> into the command line. If that works, you’re good to move on to the next step.</p>
</section>
<section id="step-5-install-python" class="level3" data-number="11.7.4">
<h3 data-number="11.7.4" class="anchored" data-anchor-id="step-5-install-python"><span class="header-section-number">11.7.4</span> Step 5: Install Python</h3>
<p>It’s very likely that the version of Python on your system is old. Generally we’re going to want to install a newer Python for doing data science work, so let’s start there. As of this writing, Python 3.10 is a relatively new version of Python, so we’ll install that one.</p>
<p>Let’s start by actually installing Python 3.10 on our system. We can do that with apt.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">sudo</span> apt-get install python3.10-venv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once you’ve installed Python, you can check that you’ve got the right version by running</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1"></a><span class="ex">python3</span> <span class="at">--version</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-5-installing-rstudio-server" class="level3" data-number="11.7.5">
<h3 data-number="11.7.5" class="anchored" data-anchor-id="step-5-installing-rstudio-server"><span class="header-section-number">11.7.5</span> Step 5: Installing RStudio Server</h3>
<p>Once R is installed, let’s download and install RStudio Server.</p>
<p>I’m not going to reproduce the commands here because the RStudio Server version numbers change frequently and you probably want the most recent one.</p>
<p>You can find the exact commands on the <a href="https://posit.co/download/rstudio-server/">Posit website</a>. Make sure to pick the version that matches your operating system. Since you’ve already installed R, you can skip down to the “Install RStudio Server” step.</p>
<p>Once you’ve installed, you can check the status with <code>sudo systemctl status rstudio-server</code>. If there’s a line that says <code>Active: active (running)</code>, you’re good to go!</p>
</section>
<section id="step-6-installing-jupyerhub-jupyterlab" class="level3" data-number="11.7.6">
<h3 data-number="11.7.6" class="anchored" data-anchor-id="step-6-installing-jupyerhub-jupyterlab"><span class="header-section-number">11.7.6</span> Step 6: Installing JupyerHub + JupyterLab</h3>
<p>Because python is so crucial to the operation of your system <em>are</em> python programs, we’re going to want to create a standalone virtual environment for running JupyterHub.</p>
<p>Here are the commands to create and activate a <code>jupyterhub</code> virtual environment</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">sudo</span> python3 <span class="at">-m</span> venv /opt/jupyterhub</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="bu">source</span> /opt/jupyterhub/bin/activate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we’re going to actually get JupyterHub up and running inside the virtual environment we just created. JupyterHub produces <a href="https://jupyterhub.readthedocs.io/en/stable/quickstart.html">docs that you can use</a> to get up and running very quickly. If you have to stop for any reason, make sure to come back, assume sudo, and start the JupyterHub virtual environment we created.</p>
<p>Here were the installation steps that worked for me:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">sudo</span> su</span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="ex">apt</span> install npm nodejs</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="ex">npm</span> install <span class="at">-g</span> configurable-http-proxy</span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="ex">python3</span> <span class="at">-m</span> pip install jupyterhub jupyterlab notebook</span>
<span id="cb22-5"><a href="#cb22-5"></a></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="fu">ln</span> <span class="at">-s</span> /opt/jupyterhub/bin/jupyterhub-singleuser /usr/local/bin/jupyterhub-singleuser <span class="co"># symlink in singleuser server, necessary because we're using virtual environment</span></span>
<span id="cb22-7"><a href="#cb22-7"></a></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="ex">jupyterhub</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If all went well, you’ll now have JupyterHub up and running on port <code>8000</code>!</p>
<section id="running-jupyterhub-as-a-service" class="level4" data-number="11.7.6.1">
<h4 data-number="11.7.6.1" class="anchored" data-anchor-id="running-jupyterhub-as-a-service"><span class="header-section-number">11.7.6.1</span> Running JupyterHub as a service</h4>
<p>As I mentioned above, JupyterHub is a Python process, not a system process. This is ok, but it means that we’ve got to remember the command to start it if we have to restart it, and that it won’t auto restart if it were to fail for any reason.</p>
<p>A program that runs in the background on a machine, starting automatically, and controlled by <code>systemctl</code> is called a <em>daemon</em>. Since we want JupyterHub to be a daemon, we’re got to add it as a system daemon, which isn’t hard.</p>
<p>We don’t need it right now, but it’ll be easier to manage JupyterHub later on from a config file that’s in <code>/etc/jupyterhub</code>.</p>
<p>Let’s create a default config file and move it into the right place using</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">sudo</span> su</span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="bu">source</span> /opt/jupyterhub/bin/activate</span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="ex">jupyterhub</span> <span class="at">--generate-config</span></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="fu">mkdir</span> <span class="at">-p</span> /etc/jupyterhub</span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="fu">mv</span> jupyterhub_config.py /etc/jupyterhub</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we’ve got to daemon-ize JupterHub. There are two steps – create a file describing the service for the server’s daemon, and then start the service.</p>
<p>To start with, end the existing JupyterHub process. If you’ve still got that terminal open, you can do so with <code>ctrl</code> + <code>c</code>. If not, you can use your <code>ps aux</code> and <code>grep</code> skills to find and kill the JupyterHub processes.</p>
<p>On Ubuntu, adding a daemon file uses a tool called <code>systemd</code> and is really straightforward.</p>
<p>First, add the following to <code>/etc/systemd/system/jupyterhub.service</code>. If you’re reading this book in hard copy, you can go to the online version to copy/paste or get this file on the book’s Git repo at TODO.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>/etc/systemd/system/jupyterhub.service</strong></pre>
</div>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">[</span><span class="at">Unit</span><span class="kw">]</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="at">Description=Jupyterhub</span></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="at">After=syslog.target network.target</span></span>
<span id="cb24-4"><a href="#cb24-4"></a></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="kw">[</span><span class="at">Service</span><span class="kw">]</span></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="at">User=root</span></span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="at">Environment="PATH=/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/opt/jupyterhub/bin"</span></span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="at">ExecStart=/opt/jupyterhub/bin/jupyterhub -f /etc/jupyterhub/jupyterhub_config.py</span></span>
<span id="cb24-9"><a href="#cb24-9"></a></span>
<span id="cb24-10"><a href="#cb24-10"></a><span class="kw">[</span><span class="at">Install</span><span class="kw">]</span></span>
<span id="cb24-11"><a href="#cb24-11"></a><span class="at">WantedBy=multi-user.target</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hopefully this file is pretty easy to parse. Two things to notice – the <code>Environment</code> line adds <code>/opt/jupyterhub/bin</code> to the path – that’s where our virtual environment is.</p>
<p>Second, the <code>ExecStart</code> line is the startup command and includes our <code>-f /etc/jupyterhub/jupyterhub_config.py</code> – this is the command to start JupyterHub with the config we created a few seconds ago.</p>
<p>Now we just need to reload the daemon tool so it picks up the new service it has available and start JupyterHub!</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1"></a><span class="ex">systemctl</span> daemon-reload</span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="ex">systemctl</span> start jupyterhub</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should now be able to see that JupyterHub is running using <code>systemctl status jupyterhub</code> and can see it again by tunneling to it.</p>
<p>To set JupyterHub to automatically restart when the server restarts, run <code>systemctl enable jupyterhub</code>.</p>
</section>
</section>
<section id="step-7-running-a-plumber-api-in-a-container" class="level3" data-number="11.7.7">
<h3 data-number="11.7.7" class="anchored" data-anchor-id="step-7-running-a-plumber-api-in-a-container"><span class="header-section-number">11.7.7</span> Step 7: Running a Plumber API in a Container</h3>
<p>In addition to running a development workbench on your server, you might want to run a data science project. If you’re running a Shiny app, Shiny Server is easy to configure along the lines of RStudio Server.</p>
<p>However, if you put an API in a container like we did in <a href="../sec2/2-4-docker.html">Chapter&nbsp;<span>9</span></a>, you might want to deploy that somewhere on your server as a running container.</p>
<p>The first step is to install docker on your system with <code>sudo apt-get install docker.io</code>. You can check that you can run docker with <code>docker ps</code>. You may need to adopt <code>sudo</code> privileges to do so.</p>
<p>Once we have docker installed, getting the API running is almost trivially easy using the command we used back in <a href="../sec2/2-4-docker.html">Chapter&nbsp;<span>9</span></a> to run our container.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">sudo</span> docker run <span class="at">--rm</span> <span class="at">-d</span> <span class="dt">\</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="at">-p</span> 8080:8080 <span class="dt">\</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="at">--name</span> penguin-model <span class="dt">\</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>  alexkgold/penguin-model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The one change you might note is that I’ve changed the port on the server to be 8080, since we already have JupyterHub running on 8000.</p>
<p>Once it’s up, you can check that it’s running with <code>docker ps</code>.</p>
<p>This is why people love docker – it’s wildly easy to get something simple running. But getting Docker hardened for production takes a bit more work.</p>
<p>The first thing to notice is that there’s no auth on our API. Anyone can hit this API as much as they want if they have the URL. Needless to say, this is not a security best practice unless you intend to host a public service.</p>
<p>The other issue is that we haven’t daemonized the API. If we restart the server or the container dies for any reason, it won’t auto-restart.</p>
<p>It’s not generally a best practice to daemon-ize a docker container by just putting the <code>run</code> command into <code>systemd</code>. Instead, you should use a container management system that is designed specifically to manage running containers, like Docker Compose or Kubernetes. Getting deeper into those systems is beyond the scope of this book.</p>
</section>
<section id="step-8-putting-up-the-shiny-app" class="level3" data-number="11.7.8">
<h3 data-number="11.7.8" class="anchored" data-anchor-id="step-8-putting-up-the-shiny-app"><span class="header-section-number">11.7.8</span> Step 8: Putting up the Shiny app</h3>
<p>Install Shiny Server using the instructions from the <a href="https://docs.posit.co/shiny-server/#getting-started">Admin Guide</a>. Note that you don’t need to install R, as we’ve already done that, and you don’t need to install <code>{shiny}</code>, as we’re going to use <code>{renv}</code>.</p>
<p>TODO</p>
<p>Edit <code>/etc/shiny-server/shiny-server.conf</code> to run the right app – may have to edit user.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>/etc/shiny-server/shiny-server.conf</strong></pre>
</div>
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Instruct Shiny Server to run applications as the user "shiny"</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="ex">run_as</span> test-user<span class="kw">;</span></span>
<span id="cb27-3"><a href="#cb27-3"></a></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="co"># Define a server that listens on port 3838</span></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="ex">server</span> {</span>
<span id="cb27-6"><a href="#cb27-6"></a>  <span class="ex">listen</span> 3838<span class="kw">;</span></span>
<span id="cb27-7"><a href="#cb27-7"></a></span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="co"># Define a location at the base URL</span></span>
<span id="cb27-9"><a href="#cb27-9"></a>  <span class="ex">location</span> / {</span>
<span id="cb27-10"><a href="#cb27-10"></a></span>
<span id="cb27-11"><a href="#cb27-11"></a>    <span class="co"># Host the directory of Shiny Apps stored in this directory</span></span>
<span id="cb27-12"><a href="#cb27-12"></a>    <span class="ex">site_dir</span> /home/test-user/do4ds-lab/app<span class="kw">;</span></span>
<span id="cb27-13"><a href="#cb27-13"></a></span>
<span id="cb27-14"><a href="#cb27-14"></a>    <span class="co"># Log all Shiny output to files in this directory</span></span>
<span id="cb27-15"><a href="#cb27-15"></a>    <span class="ex">log_dir</span> /var/log/shiny-server<span class="kw">;</span></span>
<span id="cb27-16"><a href="#cb27-16"></a></span>
<span id="cb27-17"><a href="#cb27-17"></a>    <span class="co"># When a user visits the base URL rather than a particular application,</span></span>
<span id="cb27-18"><a href="#cb27-18"></a>    <span class="co"># an index of the applications available in this directory will be shown.</span></span>
<span id="cb27-19"><a href="#cb27-19"></a>    <span class="ex">directory_index</span> off<span class="kw">;</span></span>
<span id="cb27-20"><a href="#cb27-20"></a>  <span class="er">}</span></span>
<span id="cb27-21"><a href="#cb27-21"></a><span class="er">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Start Shiny Server</p>
</section>
<section id="step-8-check-it-all-out" class="level3" data-number="11.7.9">
<h3 data-number="11.7.9" class="anchored" data-anchor-id="step-8-check-it-all-out"><span class="header-section-number">11.7.9</span> Step 8: Check it all out</h3>
<p>Just knowing that all of our services are running isn’t nearly as fun as actually trying them out.</p>
<p>We don’t have a stable public URL for the server yet, so we can’t just access it from our browser. This is a perfect use case for an SSH tunnel.</p>
<p>TODO: picture of server w/ RStudio on 8787, JupyterHub on 8000, and Palmer Penguin container on 8080.</p>
<p>If you recall, the command for an SSH tunnel from a remote server to <code>localhost</code> is to do <code>ssh -L &lt;remote port&gt;:localhost:&lt;local port&gt; &lt;user&gt;@&lt;server&gt;</code>.</p>
<p>We’ve got three services running on our server, RStudio Server at <code>8787</code>, JupyterHub on <code>8000</code>, and our Plumber API on <code>8080</code>. You can try each of them out by subbing those in for the remote port and putting them at a local port. I’d recommend just using the same one.</p>
<p>For example, by running <code>ssh -L 8787:localhost:8787 test-user@$SERVER_ADDRESS</code>, I can visit RStudio Server in my browser at <code>localhost:8787</code> and login with the username <code>test-user</code> and password I set on the server.</p>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Or at least they weren’t supposed to. There’s an interesting history of lawsuits around the BSD operating system including Unix code. BSD is a Unix clone that was the predecessor of MacOS.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Check out the <a href="https://en.wikipedia.org/wiki/History_of_Linux">History of Linux Wikipedia article</a> for the posting.</p>
<p>Pedants will scream that the original release of Linux was just the operating system <em>kernel</em>, not a full operating system like Unix. Duly noted, now go away.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>The remainder are almost entirely Windows servers. There are a few other Unix-like systems that you might encounter, like Oracle Solaris. There is no MacOS server. There is a product called <em>Mac Server</em>, but it’s just a program for managing Mac desktops and iOS devices.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>CentOS (short for Community ENTerprise Operating System) is an open source operating system maintained by Red Hat. The relationship between RHEL and CentOS is changing. The details are somewhat complicated, but most people expect less adoption of CentOS in enterprise settings going forward.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>My goal here is to be useful not precise, so I’m intermingling <code>bash</code> commands and Linux system commands because they’re useful. If you know the difference and are pedantic enough to care, this list isn’t for you anyway.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Depending on your version of Linux, there <em>may</em> be a limit of 16 groups per user.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>You can generally ignore the number, which is the number of links to the file.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>Clever eyes may realize that this is just the base-10 representation of a three-digit binary number.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>This is another one where you’ll almost never use <code>ps</code> without <code>aux</code>.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>Alternatively, you could open a file of the right name and just copy/paste the contents of your public key in there. Either way works.<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/sec3/3-1-cloud.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Getting Started with the Cloud</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/sec3/3-3-networking.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Intro to Computer Networks</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, Alex K Gold</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/akgold/do4ds" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/alexkgold">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>